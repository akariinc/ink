(self.webpackChunk=self.webpackChunk||[]).push([[36],{"./.src/storybook/storybook_admin/environment/settings.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{E:()=>OKRA_SETTINGS});const OKRA_SETTINGS={SITE_TITLE:"OKRA",I18N:!0,USE_EMAIL:!0,USE_PERSON_PAGE:!0,API_PATH:"p",AUTH_API_PATH:"auth",AMP_PATH:"__amp",EMAIL_PATH:"__email",WEBSOCKET_PATH:"__ws",PREVIEW_PATH:"preview",MYPAGE_PATH:"mypage",PERSON_PAGE_PATH:"persons",TAG_PATH:"tags",OG_DEFAULT_IMAGE_PATH:"/assets/img/og.png",CDN_SERVICE:"CLOUDFRONT",ENABLE_FACEBOOK_ARTICLES:!0,ENABLE_GOOGLE_AMP:!0,ENABLE_SMART_FORMAT:!1,ENABLE_GNOSY:!1,TWITTER_ACCOUNT:null,ENABLE_GOOGLE_AUTH:!0,ENABLE_FACEBOOK_AUTH:!0,GOOGLE_MAP_API_KEY:null,SOCIAL_AUTH_FACEBOOK_KEY:null,SOCIAL_AUTH_FACEBOOK_SECRET:null,GOOGLE_OAUTH2_CLIENT_ID:null,GOOGLE_OAUTH2_CLIENT_SECRET:null,USE_DASHBOARD:!0,USE_ANALYTICS:!0,SAAS:!1,CACHEMANAGER_CONCURRENCY:2,APP_BASE_HREF:"/",ADMIN_API_PATH:"admin",GOOGLE_SNIPPET_HIDE:!0,API_PORT:8e3,CATEGORY_COMPONENT_SELECTORS:["information-category","person-detail-category","persons-category"],POST_COMPONENT_SELECTORS:["article-post","information-post","screening-detail-post","screening-post"],IS_AMP:!1,IS_EMAIL:!1,MODULE:"admin",TARGET_ENV:"storybook",PRODUCTION_MODE:!0,SERVICE_WORKER_DEV_MODE:!1}},"./.src/storybook/storybook_admin/lib/modules/ui/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{r:()=>UIModule});var tslib_es6=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),tooltip=__webpack_require__("./node_modules/@akariinc/material/fesm2022/tooltip.mjs"),core=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),common=__webpack_require__("./node_modules/@angular/common/fesm2022/common.mjs"),map=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/map.js"),of=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/of.js"),ReplaySubject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/ReplaySubject.js"),env_service=__webpack_require__("./.src/storybook/storybook_admin/lib/services/env.service.ts");let IconSvgLoaderService=class IconSvgLoaderService{constructor(env,_document,_baseHref){this.env=env,this._document=_document,this._baseHref=_baseHref,this.svgStock$=new Map,this.stockElement=this._document.createElementNS("http://www.w3.org/2000/svg","svg"),this.stockElement.style.display="none",this._document.body.appendChild(this.stockElement)}loadStrokeIcon(icon,size=void 0,color="fg"){return this._loadIcon(icon,"stroke").pipe((0,map.T)((svgString=>`<div class="${color} ${size||""} stroke-icon">${svgString}</div>`)))}loadPaintIcon(icon){return this._loadIcon(icon,"paint")}_loadIcon(icon,type){if(this.env.isServer)return(0,of.of)("");const typedIconName=`${type}-${icon}`;if(this.svgStock$.has(typedIconName))return this.svgStock$.get(typedIconName).asObservable();const svg$=new ReplaySubject.m;this.svgStock$.set(typedIconName,svg$);const svgFile=`${this._baseHref.replace(/\/$/,"")}/assets/core/svg/${type}-icon/${icon}.svg`;return fetch(svgFile).then((res=>res.text())).then((svgString=>{svg$.next(svgString)})),svg$.asObservable()}static{this.ctorParameters=()=>[{type:env_service._},{type:Document,decorators:[{type:core.Inject,args:[common.DOCUMENT]}]},{type:String,decorators:[{type:core.Inject,args:[common.APP_BASE_HREF]}]}]}};IconSvgLoaderService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[env_service._,Document,String])],IconSvgLoaderService);let PaintIconComponent=class PaintIconComponent{constructor(el,renderer,iconSvgLoaderService,baseHref){this.el=el,this.renderer=renderer,this.iconSvgLoaderService=iconSvgLoaderService,this.baseHref=baseHref,this.icon="",this.paintIcon=!0}ngOnInit(){""!==this.icon&&this.iconSvgLoaderService.loadPaintIcon(this.icon).subscribe((svgString=>{this.renderer.setProperty(this.el.nativeElement,"innerHTML",svgString)}))}static{this.ctorParameters=()=>[{type:core.ElementRef},{type:core.Renderer2},{type:IconSvgLoaderService},{type:String,decorators:[{type:core.Inject,args:[common.APP_BASE_HREF]}]}]}static{this.propDecorators={icon:[{type:core.Input}],paintIcon:[{type:core.HostBinding,args:["class.paint-icon"]}]}}};PaintIconComponent=(0,tslib_es6.Cg)([(0,core.Component)({selector:"[paint-icon]",changeDetection:core.ChangeDetectionStrategy.OnPush,template:""}),(0,tslib_es6.Sn)("design:paramtypes",[core.ElementRef,core.Renderer2,IconSvgLoaderService,String])],PaintIconComponent);let StrokeIconComponent=class StrokeIconComponent{constructor(el,renderer,iconSvgLoaderService,baseHref){this.el=el,this.renderer=renderer,this.iconSvgLoaderService=iconSvgLoaderService,this.baseHref=baseHref,this.icon="",this.size=void 0,this.strokeIcon=!0}ngOnInit(){""!==this.icon&&this.iconSvgLoaderService.loadStrokeIcon(this.icon,this.size).subscribe((svgString=>{this.renderer.setProperty(this.el.nativeElement,"innerHTML",svgString)}))}static{this.ctorParameters=()=>[{type:core.ElementRef},{type:core.Renderer2},{type:IconSvgLoaderService},{type:String,decorators:[{type:core.Inject,args:[common.APP_BASE_HREF]}]}]}static{this.propDecorators={icon:[{type:core.Input}],size:[{type:core.Input}],strokeIcon:[{type:core.HostBinding,args:["class.stroke-icon"]}]}}};StrokeIconComponent=(0,tslib_es6.Cg)([(0,core.Component)({selector:"[stroke-icon]",changeDetection:core.ChangeDetectionStrategy.OnPush,template:""}),(0,tslib_es6.Sn)("design:paramtypes",[core.ElementRef,core.Renderer2,IconSvgLoaderService,String])],StrokeIconComponent);const UI_COMPONENTS=[PaintIconComponent,StrokeIconComponent];var UIModule_1;let UIModule=UIModule_1=class UIModule{static forRoot(){return{ngModule:UIModule_1,providers:[IconSvgLoaderService]}}};UIModule=UIModule_1=(0,tslib_es6.Cg)([(0,core.NgModule)({imports:[tooltip.uc],declarations:[...UI_COMPONENTS],exports:[...UI_COMPONENTS,tooltip.oV],providers:[IconSvgLoaderService]})],UIModule)},"./.src/storybook/storybook_admin/lib/services/electron-ipc.service.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{l:()=>OkraElectronIpcService});var tslib__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),ts_utils_errors__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../ts-utils/dist/errors.js"),_angular_core__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),ts_utils_electron__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../ts-utils/dist/electron.js"),rxjs__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/ReplaySubject.js"),rxjs__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/fromEvent.js"),rxjs__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/take.js"),rxjs__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/mergeMap.js"),rxjs__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subject.js"),rxjs__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/lastValueFrom.js"),_environment_settings__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./.src/storybook/storybook_admin/environment/settings.ts"),_lib_utils_functions__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./.src/storybook/storybook_admin/lib/utils/functions.ts"),_lib_services_window_service__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./.src/storybook/storybook_admin/lib/services/window.service.ts");const windowId=self.crypto.randomUUID?self.crypto.randomUUID():`${(new Date).getTime()}`;let requestId=0;let OkraElectronIpcService=class OkraElectronIpcService{get api(){return this._api}get api$(){return this._api$.asObservable()}constructor(window){this.window=window,this._api$=new rxjs__WEBPACK_IMPORTED_MODULE_5__.m(1);const isIframe=window.top&&window!==window.top;isIframe?this.windowId=window.top.windowId:(window.windowId=self.crypto.randomUUID?self.crypto.randomUUID():`${(new Date).getTime()}`,this.windowId=window.windowId),window&&window.api||window.top&&window.top.api?(this._api=isIframe?window.top.api:window.api,(0,rxjs__WEBPACK_IMPORTED_MODULE_6__.R)(window,"beforeunload").subscribe((event=>{this.api.send(ts_utils_electron__WEBPACK_IMPORTED_MODULE_1__.Q2.WINDOW_RELOAD,[this.windowId,0])})),_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.API_URL=(0,_lib_utils_functions__WEBPACK_IMPORTED_MODULE_3__.y0)("/",this.window),this.api.send(ts_utils_electron__WEBPACK_IMPORTED_MODULE_1__.Q2.INIT,[this.windowId,requestId,_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E]),requestId++,this.api.receive((0,ts_utils_electron__WEBPACK_IMPORTED_MODULE_1__.IO)(this.windowId,ts_utils_electron__WEBPACK_IMPORTED_MODULE_1__.Q2.INIT,0),(res=>{console.log("OkraElectronIpcService INIT:",res),this._api$.next(this.api)})),console.log("OkraElectronIpcService Window ID:",windowId),console.log("OkraElectronIpcService Preloader API has been loaded successfully")):console.warn("OkraElectronIpcService Preloader API is not loaded")}request$(channel,...args){return this.api$.pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_7__.s)(1),(0,rxjs__WEBPACK_IMPORTED_MODULE_8__.Z)((api=>{api.send(channel,[this.windowId,requestId,...args]);const req=(0,ts_utils_electron__WEBPACK_IMPORTED_MODULE_1__.IO)(this.windowId,channel,requestId),subject=new rxjs__WEBPACK_IMPORTED_MODULE_9__.B;return api.receive(req,(res=>{console.log("OkraElectronIpcService Response:",res),"next"===res.phase?subject.next(res.output):"error"===res.phase?subject.error((0,ts_utils_errors__WEBPACK_IMPORTED_MODULE_0__.cy)(res.output)):"complete"===res.phase&&subject.complete()})),requestId++,subject.asObservable()})))}observe$(channel){return this.api$.pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_7__.s)(1),(0,rxjs__WEBPACK_IMPORTED_MODULE_8__.Z)((api=>{api.send(channel,[this.windowId,-1]);const req=(0,ts_utils_electron__WEBPACK_IMPORTED_MODULE_1__.IO)(this.windowId,channel,-1),subject=new rxjs__WEBPACK_IMPORTED_MODULE_9__.B;return api.receive(req,(res=>{console.log("OkraElectronIpcService received:",res),"next"===res.phase?subject.next(res.output):"error"===res.phase?subject.error(res.output):"complete"===res.phase&&subject.complete()})),subject.asObservable()})))}promise$(channel,...args){return(0,rxjs__WEBPACK_IMPORTED_MODULE_10__.s)(this.request$(channel,...args))}static{this.ctorParameters=()=>[{type:void 0,decorators:[{type:_angular_core__WEBPACK_IMPORTED_MODULE_11__.Inject,args:[_lib_services_window_service__WEBPACK_IMPORTED_MODULE_4__.jf]}]}]}};OkraElectronIpcService=(0,tslib__WEBPACK_IMPORTED_MODULE_12__.Cg)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_11__.Injectable)({providedIn:"root"}),(0,tslib__WEBPACK_IMPORTED_MODULE_12__.Sn)("design:paramtypes",[Object])],OkraElectronIpcService)},"./.src/storybook/storybook_admin/lib/services/env.service.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{_:()=>OkraEnvService});var tslib__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),_angular_core__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),_angular_common__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@angular/common/fesm2022/common.mjs"),_lib_utils_functions__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./.src/storybook/storybook_admin/lib/utils/functions.ts"),_lib_services_transfer_state__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./.src/storybook/storybook_admin/lib/services/transfer-state.ts"),_environment_settings__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./.src/storybook/storybook_admin/environment/settings.ts"),_electron_ipc_service__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./.src/storybook/storybook_admin/lib/services/electron-ipc.service.ts"),rxjs__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/map.js");let OkraEnvService=class OkraEnvService{get isElectron(){return!!this.electronIpc.api}get isElectron$(){return this.electronIpc.api$.pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_4__.T)((api=>!!api)))}get browser(){return this._browser}get display(){return this._display}get targetEnv(){return _environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.TARGET_ENV}get rtlLanguages(){return["ar","ug","ur","ks","sd","ps","fa","yi","he","dv"]}constructor(state,electronIpc,platformId,document){if(this.state=state,this.electronIpc=electronIpc,this.platformId=platformId,this.document=document,this.isPuppeteer=Boolean(this.document.isPuppeteer),this.isBrowser=!this.isPuppeteer&&(0,_angular_common__WEBPACK_IMPORTED_MODULE_5__.isPlatformBrowser)(this.platformId),this.isServer=!!this.isPuppeteer||(0,_angular_common__WEBPACK_IMPORTED_MODULE_5__.isPlatformServer)(this.platformId),this.isPreviewMode=!1,this.isAdmin="admin"===_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.MODULE,this.isClient="client"===_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.MODULE,this.isSSR=this.isPuppeteer,this.isIframe=this.isAdmin&&window!==window.top,this.isAmp=_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.IS_AMP,this.isEmail=_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.IS_EMAIL,this.isEmailSSR=_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.IS_EMAIL&&this.isPuppeteer,this.isSaaS=_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.SAAS,this.isPortal=_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.SAAS&&_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.PORTAL,this.isTenant=_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.SAAS&&_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.TENANT,this.isSW=this.isBrowser&&!this.isPreviewMode&&_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.SAAS&&(_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.PRODUCTION_MODE||_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.SERVICE_WORKER_DEV_MODE),this.isSupportWebp=!1,this._browser={},this._display={},this.isLocal="local"===_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.TARGET_ENV||"dev"===_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.TARGET_ENV,this.isDevServer=this.isLocal&&(this.isEmail?_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.hasOwnProperty("EMAIL_PORT")&&this.document.location.origin.endsWith(`:${_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.EMAIL_PORT}`):_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.hasOwnProperty("SITE_PORT")&&this.document.location.origin.endsWith(`:${_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.SITE_PORT}`)),this.isBrowserAfterSSR=!1,this.isI18N=_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.I18N,this.useEmail=_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.USE_EMAIL,this.useContentProtection=_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.USE_CONTENT_PROTECTION,this.usePayment=_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.USE_PAYMENT,this.siteTitle=_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.SITE_TITLE,this.siteUrl=_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.SITE_URL,this.translations=_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.TRANSLATIONS,this.leaveEvent=this.browser.ios?"pagehide":"beforeunload",this.inAppsComponent=!1,this.isAdmin?this.inAppsComponent=!location.pathname.startsWith("/posts"):this.isBrowser&&(this.inAppsComponent=!0),this.isBrowser){if(this.isPreviewMode=this.document.location.pathname.startsWith((0,_lib_utils_functions__WEBPACK_IMPORTED_MODULE_0__.uJ)("/",_environment_settings__WEBPACK_IMPORTED_MODULE_2__.E.PREVIEW_PATH)),this.isBrowserAfterSSR=!this.isDevServer&&!this.isSSR&&!this.isPreviewMode&&!this.isAdmin&&this.state.stateTransferred,this.isBrowserAfterSSR){const parameters=location.search?(0,_lib_utils_functions__WEBPACK_IMPORTED_MODULE_0__._A)(location.search.replace(/^\?/,"")):{},isPrivateLink=!!parameters.preview&&/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/.test(parameters.preview);this.isBrowserAfterSSR=!isPrivateLink}this._browser.ua=navigator.userAgent.toLowerCase(),this._browser.ie=/msie|trident/.test(this.browser.ua),this._browser.ie6=/msie\s6\./.test(this.browser.ua),this._browser.ie7=/msie\s7\./.test(this.browser.ua),this._browser.ie8=/msie\s8\./.test(this.browser.ua),this._browser.ie9=/msie\s9\./.test(this.browser.ua),this._browser.ie10=/msie\s10\./.test(this.browser.ua),this._browser.ie11=this.browser.ie&&/rv:11|rv\s11/.test(this.browser.ua),this._browser.edge=/edg/.test(this.browser.ua),this._browser.opera=/opr/.test(this.browser.ua),this._browser.firefox=/firefox/.test(this.browser.ua),this.browser.edge&&(/edge/.test(this.browser.ua)?this._browser.edgeVersion=parseFloat(this.browser.ua.slice(this.browser.ua.indexOf("edge")+5)):this._browser.edgeVersion=parseFloat(this.browser.ua.slice(this.browser.ua.indexOf("edg")+4))),this.browser.opera||this.browser.edge?(this._browser.chrome=!1,this._browser.safari=!1):(this._browser.chrome=/chrome/.test(this.browser.ua),this.browser.chrome?this.browser.safari=!1:(this._browser.chrome=!1,this._browser.safari=/safari/.test(this.browser.ua))),this.browser.prest=/opera/.test(this.browser.ua),this.browser.ie?this.browser.legacy=/msie\s6\.|msie\s7\.|msie\s8\./.test(this.browser.ua):this._browser.legacy=!1,this._browser.animationSupported=!/msie\s6\.|msie\s7\.|msie\s8\.|msie\s9\./.test(this.browser.ua),this.browser.android=/android/.test(this.browser.ua),this.browser.iphone=/iphone/.test(this.browser.ua),this.browser.ipod=/ipod/.test(this.browser.ua),this.browser.ipad=/ipad/.test(this.browser.ua),this.browser.ios=/iphone|ipod|ipad/.test(this.browser.ua),this.browser.android?this.browser.sp=/mobile/.test(this.browser.ua):this._browser.sp=/iphone|ipod|blackberry/.test(this.browser.ua),this.browser.android?this.browser.tablet=!/mobile/.test(this.browser.ua):this._browser.tablet=/ipad/.test(this.browser.ua),this.browser.android&&(this.browser.androidVersion=parseFloat(this.browser.ua.slice(this.browser.ua.indexOf("android")+8))),this.browser.sp||this.browser.tablet?this.browser.pc=!1:this._browser.pc=!0,this._display.retina=window.devicePixelRatio>1,(0,_lib_utils_functions__WEBPACK_IMPORTED_MODULE_0__.mS)().then((bool=>this.isSupportWebp=bool))}}static{this.ctorParameters=()=>[{type:_lib_services_transfer_state__WEBPACK_IMPORTED_MODULE_1__.WL},{type:_electron_ipc_service__WEBPACK_IMPORTED_MODULE_3__.l},{type:Object,decorators:[{type:_angular_core__WEBPACK_IMPORTED_MODULE_6__.Inject,args:[_angular_core__WEBPACK_IMPORTED_MODULE_6__.PLATFORM_ID]}]},{type:void 0,decorators:[{type:_angular_core__WEBPACK_IMPORTED_MODULE_6__.Inject,args:[_angular_common__WEBPACK_IMPORTED_MODULE_5__.DOCUMENT]}]}]}};OkraEnvService=(0,tslib__WEBPACK_IMPORTED_MODULE_7__.Cg)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_6__.Injectable)({providedIn:"root"}),(0,tslib__WEBPACK_IMPORTED_MODULE_7__.Sn)("design:paramtypes",[_lib_services_transfer_state__WEBPACK_IMPORTED_MODULE_1__.WL,_electron_ipc_service__WEBPACK_IMPORTED_MODULE_3__.l,Object,Object])],OkraEnvService)},"./.src/storybook/storybook_admin/lib/services/transfer-state.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{WL:()=>OkraTransferState,zw:()=>makeStateKey});var OkraTransferState_1,tslib__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),_angular_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),_angular_common__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@angular/common/fesm2022/common.mjs"),lodash__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash/lodash.js"),_utils_functions__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./.src/storybook/storybook_admin/lib/utils/functions.ts");function makeStateKey(key){return key}let OkraTransferState=class OkraTransferState{static{OkraTransferState_1=this}get stateTransferred(){return this._stateTransferred}static init(okraState,stateTransferred){const transferState=new OkraTransferState_1;return transferState._stateTransferred=stateTransferred,transferState.store=okraState,transferState}constructor(){this.store={},this.onSerializeCallbacks={},this._stateTransferred=!1}get(key,defaultValue){return void 0!==this.store[key]?this.store[key]:defaultValue}set(key,value){this.store[key]=value}remove(key){delete this.store[key]}hasKey(key){return this.store.hasOwnProperty(key)}onSerialize(key,callback){this.onSerializeCallbacks[key]=callback}toJson(){for(const key in this.onSerializeCallbacks){const onSerializeCallbacks=this.onSerializeCallbacks.hasOwnProperty(key)?this.onSerializeCallbacks[key]:void 0;if(onSerializeCallbacks)try{this.store[key]=onSerializeCallbacks()}catch(e){console.warn("Exception in onSerialize callback: ",e)}}return(0,_utils_functions__WEBPACK_IMPORTED_MODULE_1__.sX)(this.store)}toText(){return function escapeHtml(text){const escapedText={"&":"&a;",'"':"&q;","'":"&s;","<":"&l;",">":"&g;"};return text.replace(/[&"'<>]/g,(s=>escapedText[s]||""))}(this.toJson())}static{this.ctorParameters=()=>[]}};OkraTransferState=OkraTransferState_1=(0,tslib__WEBPACK_IMPORTED_MODULE_2__.Cg)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_3__.Injectable)({providedIn:"root",useFactory:function initTransferState(doc,appId){const okraState=window.hasOwnProperty("okraState")?window.okraState:{},stateTransferred=window.hasOwnProperty("okraState")&&null!==okraState&&!(0,lodash__WEBPACK_IMPORTED_MODULE_0__.isEmpty)(okraState);return OkraTransferState.init(okraState,stateTransferred)},deps:[_angular_common__WEBPACK_IMPORTED_MODULE_4__.DOCUMENT,_angular_core__WEBPACK_IMPORTED_MODULE_3__.APP_ID]}),(0,tslib__WEBPACK_IMPORTED_MODULE_2__.Sn)("design:paramtypes",[])],OkraTransferState)},"./.src/storybook/storybook_admin/lib/services/window.service.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{GG:()=>WINDOW_PROVIDERS,jf:()=>WINDOW});var _angular_core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs");const WINDOW=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.InjectionToken("WindowToken");class WindowRef{get nativeWindow(){throw new Error("Not implemented.")}}const WINDOW_PROVIDERS=[{provide:WindowRef,useClass:class BrowserWindowRef extends WindowRef{constructor(){super()}get nativeWindow(){return window}}},{provide:WINDOW,useFactory:function windowFactory(browserWindowRef,platformId,responseResolver){return browserWindowRef.nativeWindow},deps:[WindowRef,_angular_core__WEBPACK_IMPORTED_MODULE_0__.PLATFORM_ID]}]},"./.src/storybook/storybook_admin/lib/storybook/shared/storybook-shared.module.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{c:()=>StorybookSharedModule});var tslib_es6=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),core=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),window_service=__webpack_require__("./.src/storybook/storybook_admin/lib/services/window.service.ts");let OkraBindCheckerDirective=class OkraBindCheckerDirective{constructor(el){this.el=el}check(){console.log(`okraBindChecker@${this.place} : ${this.text}`)}static{this.ctorParameters=()=>[{type:core.ElementRef}]}static{this.propDecorators={text:[{type:core.Input}],place:[{type:core.Input}]}}};OkraBindCheckerDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraBindChecker]",exportAs:"okraBindChecker"}),(0,tslib_es6.Sn)("design:paramtypes",[core.ElementRef])],OkraBindCheckerDirective);var map=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/map.js"),throwError=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/throwError.js"),switchMap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/switchMap.js"),catchError=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/catchError.js"),environment_settings=__webpack_require__("./.src/storybook/storybook_admin/environment/settings.ts"),env_service=__webpack_require__("./.src/storybook/storybook_admin/lib/services/env.service.ts"),fesm2022_forms=__webpack_require__("./node_modules/@angular/forms/fesm2022/forms.mjs"),Subject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subject.js"),of=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/of.js"),delay=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/delay.js"),v4=__webpack_require__("./node_modules/uuid/dist/esm-browser/v4.js");const deformatFundamentalElement=_element=>{if(!_element)return _element;let element,items;switch("<br>"===_element.caption&&(_element.caption=null),_element.kind){case"okra-text":element=_element,element.text&&(element.text=element.text.replace(/\u200B|\u0323|\u2029|\u202A|\u0008/g,"")),null===element.text||""===element.text||"<br>"===element.text?element.is_empty=!0:delete element.is_empty;break;case"okra-html":element=_element,element.html?delete element.is_empty:element.is_empty=!0;break;case"okra-image":case"okra-youtube":case"okra-vimeo":element=_element,element.id?delete element.is_empty:element.is_empty=!0;break;case"okra-carousel":element=_element,element.items=element.items.filter((item=>!!item.element&&!!item.element.id)),items=element.items.map((item=>item.element.id)).filter((i=>i)),0===items.length?element.is_empty=!0:delete element.is_empty;break;case"okra-list":element=_element,element.items=element.items.map((item=>(item.text&&"<br>"!==item.text&&""!==item.text||(item.is_empty=!0),item))),items=element.items.filter((item=>!item.is_empty)),0===items.length?element.is_empty=!0:delete element.is_empty;break;case"okra-link-list":element=_element,element.items=element.items.map((el=>deformatFundamentalElement(el))),items=element.items.filter((item=>!item.is_empty)),0===items.length?element.is_empty=!0:delete element.is_empty;break;case"okra-media":element=_element,element.element=deformatFundamentalElement(element.element),element.element.is_empty?element.is_empty=!0:delete element.is_empty;break;case"okra-fundamental-array":element=_element,element.elements=element.elements.map((el=>deformatFundamentalElement(el))),element.elements.some((el=>!el.is_empty))?delete element.is_empty:element.is_empty=!0;break;case"okra-extendable-collection":element=_element,element.items=element.items.map((item=>(item.elements=item.elements.map((el=>deformatFundamentalElement(el))),item))),element.items=element.items.filter((item=>item.elements.some((el=>Array.isArray(el)?el.some((e=>!e.is_empty)):!el.is_empty)))),0===element.items.length?element.is_empty=!0:delete element.is_empty;break;case"okra-pickable-model":element=_element,element.modelId?delete element.is_empty:element.is_empty=!0;break;case"okra-markdown":element=_element,element.text?delete element.is_empty:element.is_empty=!0;break;case"okra-collection":element=_element,element.items=element.items.map((item=>(item.elements=item.elements.map((el=>Array.isArray(el)?el.map((e=>deformatFundamentalElement(e))):deformatFundamentalElement(el))),item))),element.items=element.items.filter((item=>item.elements.some((el=>Array.isArray(el)?el.some((e=>!e.is_empty)):!el.is_empty))||item.attributes.some((attr=>"value"in attr&&attr?.value||"items"in attr&&attr.items.length>0)))),0===element.items.length?element.is_empty=!0:delete element.is_empty}return _element};var ReplaySubject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/ReplaySubject.js");const mapStringToSelectOption=selectOptions=>(selectOptions=>!selectOptions.every((v=>"string"==typeof v)))(selectOptions)?selectOptions:selectOptions.map((s=>({name:s,value:s})));class OkraAttrText{constructor(kind,label,value,options){if(this.kind=kind,this.label=label,this._valueChanges$=new ReplaySubject.m(1),this.defaultValue=null!=options?.defaultValue?String(options.defaultValue):null,this.value=null!=value?String(value):this.defaultValue,this.name=options?.adminDisplayName||label,this.order=options?.adminDisplayOrder||null,this.isFormatted=!0,options?.valueChanges){const valueChanges=options.valueChanges;this.valueChangeCallBack=function(value){valueChanges(value)}}else this.valueChangeCallBack=function(){};return this._valueChanges$.next(this.value),new Proxy(this,{set:(obj,prop,val)=>{if("value"===prop)return obj[prop]=val,this._valueChanges$.next(val),this.valueChangeCallBack(val),!0;throw Object.prototype.hasOwnProperty.call(obj,prop)?new Error(`"${String(prop)}" is read-only"`):new Error(`"${String(prop)}" does not exist"`)}})}valueChanges(){return"admin"===environment_settings.E.MODULE?this._valueChanges$.asObservable():(0,of.of)(this.value)}}class OkraAttrBool{constructor(kind,label,value,options,isSaved=!1){this.kind=kind,this.label=label,this._valueChanges$=new ReplaySubject.m(1),this.defaultValue="boolean"==typeof options?.defaultValue?options?.defaultValue:null;const _value=!1===isSaved?this.defaultValue:value;if(null==_value?void 0===this.defaultValue||null===this.defaultValue?this.value=!1:this.value=this.defaultValue:this.value=_value,this.name=options?.adminDisplayName||label,this.order=options?.adminDisplayOrder||null,this.isFormatted=!0,options?.valueChanges){const valueChanges=options.valueChanges;this.valueChangeCallBack=function(value){valueChanges(value)}}else this.valueChangeCallBack=function(){};return this._valueChanges$.next(this.value),new Proxy(this,{set:(obj,prop,val)=>{if("value"===prop)return obj[prop]=val,this._valueChanges$.next(val),this.valueChangeCallBack(val),!0;throw Object.prototype.hasOwnProperty.call(obj,prop)?new Error(`"${String(prop)}" is read-only"`):new Error(`"${String(prop)}" does not exist"`)}})}valueChanges(){return"admin"===environment_settings.E.MODULE?this._valueChanges$.asObservable():(0,of.of)(this.value)}}class OkraAttrNum{constructor(kind,label,value,options){if(this.kind=kind,this.label=label,this._valueChanges$=new ReplaySubject.m(1),this.defaultValue=Number(options?.defaultValue)||null,this.value="number"==typeof value?Number(value):this.defaultValue,this.name=options?.adminDisplayName||label,this.order=options?.adminDisplayOrder||null,this.isFormatted=!0,this.min="number"==typeof options?.min?options.min:null,this.max="number"==typeof options?.max?options.max:null,options?.valueChanges){const valueChanges=options.valueChanges;this.valueChangeCallBack=function(value){valueChanges(value)}}else this.valueChangeCallBack=function(){};return this._valueChanges$.next(this.value),new Proxy(this,{set:(obj,prop,val)=>{if("value"===prop)return obj[prop]=val,this._valueChanges$.next(val),this.valueChangeCallBack(val),!0;throw Object.prototype.hasOwnProperty.call(obj,prop)?new Error(`"${String(prop)}" is read-only"`):new Error(`"${String(prop)}" does not exist"`)}})}valueChanges(){return"admin"===environment_settings.E.MODULE?this._valueChanges$.asObservable():(0,of.of)(this.value)}}class OkraAttrSelect{constructor(kind,label,value,options,isSaved=!1){if(this.kind=kind,this.label=label,this._valueChanges$=new ReplaySubject.m(1),this.defaultValue=options.defaultValue||null,this.value=isSaved&&value||this.defaultValue,this.name=options?.adminDisplayName||label,this.order=options?.adminDisplayOrder||null,this.isFormatted=!0,this.list=mapStringToSelectOption(options.selectOptions||[]),this.type="radio"===options.adminDisplayType?"radio":"select",options?.valueChanges){const valueChanges=options.valueChanges;this.valueChangeCallBack=function(value){valueChanges(value)}}else this.valueChangeCallBack=function(){};return this._valueChanges$.next(this.value),new Proxy(this,{set:(obj,prop,val)=>{if("value"===prop)return obj[prop]=val,this._valueChanges$.next(val),this.valueChangeCallBack(val),!0;throw Object.prototype.hasOwnProperty.call(obj,prop)?new Error(`"${String(prop)}" is read-only"`):new Error(`"${String(prop)}" does not exist"`)}})}valueChanges(){return"admin"===environment_settings.E.MODULE?this._valueChanges$.asObservable():(0,of.of)(this.value)}}class OkraAttrSelectOrInput{constructor(kind,label,value,options){if(this.kind=kind,this.label=label,this._valueChanges$=new ReplaySubject.m(1),this.defaultValue=null!=options?.defaultValue?String(options.defaultValue):null,this.value=null!=value?String(value):this.defaultValue,this.name=options?.adminDisplayName||label,this.order=options?.adminDisplayOrder||null,this.isFormatted=!0,this.list=mapStringToSelectOption(options.selectOptions||[]),this.isInput=!this.list.some((item=>item.value===this.value)),options?.valueChanges){const valueChanges=options.valueChanges;this.valueChangeCallBack=function(value){valueChanges(value)}}else this.valueChangeCallBack=function(){};return this._valueChanges$.next(this.value),new Proxy(this,{set:(obj,prop,val)=>{if("value"===prop)return obj[prop]=val,this._valueChanges$.next(val),this.valueChangeCallBack(val),!0;if("isInput"===prop)return obj[prop]=val,!0;throw Object.prototype.hasOwnProperty.call(obj,prop)?new Error(`"${String(prop)}" is read-only"`):new Error(`"${String(prop)}" does not exist"`)}})}valueChanges(){return"admin"===environment_settings.E.MODULE?this._valueChanges$.asObservable():(0,of.of)(this.value)}}class OkraAttrColor{static{this.REGEXP_HEX=/^#([\da-fA-F]{3}|[\da-fA-F]{6})$/}static{this.REGEXP_RGBA=/^rgba?\(\d{1,3},\s*\d{1,3},\s*\d{1,3},*\s*[01]*\.*\d*\)$/}static{this.REGEXP_HSLA=/^hsla?\(\d{1,3},\s*\d{1,3}%,\s*\d{1,3}%,*\s*[01]*\.*\d*\)$/}constructor(kind,label,value,options){if(this.kind=kind,this.label=label,this._valueChanges$=new ReplaySubject.m(1),this.defaultValue=null!=options?.defaultValue&&OkraAttrColor.checkColorFormat(String(options.defaultValue))?String(options.defaultValue):null,this.value=null!=value&&OkraAttrColor.checkColorFormat(String(value))?String(value):this.defaultValue,this.name=options?.adminDisplayName||label,this.order=options?.adminDisplayOrder||null,this.isFormatted=!0,this.presets=OkraAttrColor.setPreset([...null==this.defaultValue?[]:[this.defaultValue],...options.colorPresets||[]]),options?.valueChanges){const valueChanges=options.valueChanges;this.valueChangeCallBack=function(value){valueChanges(value)}}else this.valueChangeCallBack=function(){};return this._valueChanges$.next(this.value),new Proxy(this,{set:(obj,prop,val)=>{if("value"===prop)return obj[prop]=val,this._valueChanges$.next(val),this.valueChangeCallBack(val),!0;throw Object.prototype.hasOwnProperty.call(obj,prop)?new Error(`"${String(prop)}" is read-only"`):new Error(`"${String(prop)}" does not exist"`)}})}valueChanges(){return"admin"===environment_settings.E.MODULE?this._valueChanges$.asObservable():(0,of.of)(this.value)}static setPreset(presets){return presets?presets.filter(((preset,i,self)=>this.checkColorFormat(preset)&&self.indexOf(preset)===i)):[]}static checkColorFormat(color){return!!(OkraAttrColor.REGEXP_HEX.test(color)||OkraAttrColor.REGEXP_RGBA.test(color)||OkraAttrColor.REGEXP_HSLA.test(color))}}class OkraAttrFile{constructor(kind,label,value,options){if(this.kind=kind,this.label=label,this._valueChanges$=new ReplaySubject.m(1),this.defaultValue=Number(options?.defaultValue)||null,this.value=Number(value)||this.defaultValue,this.extensions=options.accept?options.accept:[],this.name=options?.adminDisplayName||label,this.order=options?.adminDisplayOrder||null,this.isFormatted=!0,options?.valueChanges){const valueChanges=options.valueChanges;this.valueChangeCallBack=function(value){valueChanges(value)}}else this.valueChangeCallBack=function(){};return this._valueChanges$.next(this.value),new Proxy(this,{set:(obj,prop,val)=>{if("value"===prop)return obj[prop]=val,this._valueChanges$.next(val),this.valueChangeCallBack(val),!0;throw Object.prototype.hasOwnProperty.call(obj,prop)?new Error(`"${String(prop)}" is read-only"`):new Error(`"${String(prop)}" does not exist"`)}})}valueChanges(){return"admin"===environment_settings.E.MODULE?this._valueChanges$.asObservable():(0,of.of)(this.value)}}class OkraAttrImage{constructor(kind,label,value,options){if(this.kind=kind,this.label=label,this._valueChanges$=new ReplaySubject.m(1),this.defaultValue=Number(options?.defaultValue)||null,this.value=Number(value)||this.defaultValue,this.extensions=options.accept?options.accept:["jpeg","jpg","png","gif","svg"],this.name=options?.adminDisplayName||label,this.order=options?.adminDisplayOrder||null,this.isFormatted=!0,options?.valueChanges){const valueChanges=options.valueChanges;this.valueChangeCallBack=function(value){valueChanges(value)}}else this.valueChangeCallBack=function(){};return this._valueChanges$.next(this.value),new Proxy(this,{set:(obj,prop,val)=>{if("value"===prop)return obj[prop]=val,this._valueChanges$.next(val),this.valueChangeCallBack(val),!0;throw Object.prototype.hasOwnProperty.call(obj,prop)?new Error(`"${String(prop)}" is read-only"`):new Error(`"${String(prop)}" does not exist"`)}})}valueChanges(){return"admin"===environment_settings.E.MODULE?this._valueChanges$.asObservable():(0,of.of)(this.value)}}class OkraAttrPicker{constructor(kind,label,value,options){if(this.kind=kind,this.label=label,this._valueChanges$=new ReplaySubject.m(1),!options.pickerKind)throw new Error("Enter pickerKind for options");if(this.pickerKind=options.pickerKind,this.multiple=null==options.multiple||options.multiple,this.filter=options.filter||{},this.multiple?(this.defaultValue=this.valuesToArray(options.defaultValue),this.value=null!=value?this.valuesToArray(value):this.defaultValue):(this.defaultValue=this.valuesToValue(options.defaultValue),this.value=null!=value?this.valuesToValue(value):this.defaultValue),this.name=options?.adminDisplayName||label,this.order=options?.adminDisplayOrder||null,this.isFormatted=!0,options?.valueChanges){const valueChanges=options.valueChanges;this.valueChangeCallBack=function(value){valueChanges(value)}}else this.valueChangeCallBack=function(){};return this._valueChanges$.next(this.value),new Proxy(this,{set:(obj,prop,val)=>{if("value"===prop)return obj[prop]=val,this._valueChanges$.next(val),this.valueChangeCallBack(val),!0;throw Object.prototype.hasOwnProperty.call(obj,prop)?new Error(`"${String(prop)}" is read-only"`):new Error(`"${String(prop)}" does not exist"`)}})}valueChanges(){return"admin"===environment_settings.E.MODULE?this._valueChanges$.asObservable():(0,of.of)(this.value)}valuesToArray(values){if(Array.isArray(values))return 0===values.length?[]:(values[0],values);{if(null===values)return[];if("string"==typeof values)return[values];if("number"==typeof values)return[values];const v=Number(values);return isNaN(v)?[]:[String(v)]}}valuesToValue(values){let v=null;if(Array.isArray(values))for(const value in values){const _v=Number(value);if(!isNaN(_v)){v=_v;break}}else{const _v=Number(values);isNaN(_v)||(v=_v)}return v}}class OkraAttrCollection{constructor(kind,label,items,options){this.kind=kind,this.label=label,this.items=[],this._valueChanges$=new ReplaySubject.m(1);const arrayChangeHandler={get:(obj,prop)=>obj[prop],set:(obj,prop,val)=>{obj[prop]=val;const index=parseInt(prop,10);return("length"===prop||0<=index&&index<obj.length)&&(this._valueChanges$.next(obj),this.valueChangeCallBack(obj)),!0}};if(this.items=items||[],this.items=new Proxy(this.items,arrayChangeHandler),this.value=void 0,this.defaultValue=null!=options.defaultValue&&Array.isArray(options.defaultValue)?options.defaultValue:null,0===this.items?.length&&this.defaultValue&&(this.items=this.defaultValue),this.name=options?.adminDisplayName||label,this.order=options?.adminDisplayOrder||null,this.isFormatted=!0,options?.valueChanges){const valueChanges=options.valueChanges;this.valueChangeCallBack=function(value){valueChanges(value)}}else this.valueChangeCallBack=function(){};return this._valueChanges$.next(this.items),new Proxy(this,{set:(obj,prop)=>{throw Object.prototype.hasOwnProperty.call(obj,prop)?new Error(`"${String(prop)}" is read-only"`):new Error(`"${String(prop)}" does not exist"`)}})}valueChanges(){return"admin"===environment_settings.E.MODULE?this._valueChanges$.asObservable():(0,of.of)(this.items)}}const getDefaultOkraText=(label=null,defaultValue=null)=>{const text={kind:"okra-text",blank:!1,fragment:null,text:null,uuid:(0,v4.A)()};return label&&(text.label=label),defaultValue&&(text.text=defaultValue),text},getDefaultOkraList=(label=null)=>{const list={kind:"okra-list",items:[{text:null}],link:null,blank:!1,uuid:(0,v4.A)()};return label&&(list.label=label),list},getDefaultOkraImage=(label=null,defaultValue=null)=>{const image={kind:"okra-image",id:null,url:null,alt:"",width:null,height:null,link:null,blank:!1,uuid:(0,v4.A)()};return label&&(image.label=label),defaultValue&&(image.default_url=defaultValue),image},getDefaultOkraEmbed=(kind=null,label=null,defaultValue=null)=>{const embed={kind:null,id:null,autoplay:!1,loop:!1,mute:!1,controls:!1,uuid:(0,v4.A)()};return embed.kind=kind,label&&(embed.label=label),defaultValue&&(embed.id=defaultValue),embed},getDefaultOkraMedia=(label=null,defaultValue=null)=>{const media={kind:"okra-media",link:null,blank:null,caption:null,element:null,uuid:(0,v4.A)()};return label&&(media.label=label),defaultValue&&(media.element=getDefaultOkraImage(null,defaultValue)),media},getDefaultOkraCarousel=(label=null,defaultValue=null)=>{const carousel={kind:"okra-carousel",items:[],uuid:(0,v4.A)()};return label&&(carousel.label=label),defaultValue&&defaultValue.length>0&&defaultValue.forEach((value=>{const item=getDefaultOkraCarouselItem();item.element=getDefaultOkraImage(null,value),carousel.items.push(item)})),carousel},getDefaultOkraInput=(label=null)=>{const inputElement={kind:"okra-input",error_message:{},input_label:null,hint:null,placeholder:null,uuid:(0,v4.A)()};return label&&(inputElement.label=label),inputElement},getDefaultOkraCarouselItem=()=>({kind:"okra-carouselItem",link:null,blank:null,caption:null,element:null}),getDefaultOkraFundamentalElementArray=(label=null)=>{const fundamentalElementArray={kind:"okra-fundamental-array",elements:[getDefaultOkraText()],link:null,blank:!1,uuid:(0,v4.A)()};return label&&(fundamentalElementArray.label=label),fundamentalElementArray},getDefaultOkraTableCell=(x,y,w,h,width=null)=>({type:"array",is_th:!1,visible:!0,x,y,w,h,width,data:getDefaultOkraFundamentalElementArray(),uuid:(0,v4.A)(),align:null,background_color:null}),getDefaultOkraSelect=(label=null)=>{const selectElement={kind:"okra-select",label:null,selectItems:[{value:null,display:null}],hint:null,placeholder:null,uuid:(0,v4.A)()};return label&&(selectElement.label=label),selectElement},getDefaultOkraButton=(label=null)=>{const button={kind:"okra-button",blank:!1,fragment:null,text:null,linkTarget:"1",link:null,place:null,microCopy:null,style:null,color:null,size:null,sendEvent:!1,eventCategory:"Button",eventAction:"Click",eventLabel:null,eventValue:null,sendGA4Event:!1,eventName:void 0,uuid:(0,v4.A)()};return label&&(button.label=label),button};class ElementClass{constructor(data,force=!1){this.listeners={},this.isLocked=!1,Object.assign(this,data),"admin"===environment_settings.E.MODULE&&(this.addEvent=new Event("addArray")),this.elements=this.elements?this.elements:[],this.is_default_empty=0===this.elements.length||void 0,this.initElements(),this.attributes=this.attributes?this.attributes:[],this.uuid&&!0!==force||(this.uuid=(0,v4.A)()),this.hasOwnProperty("fragment")||(this.fragment=null),this._onChanges$=new Subject.B}onChanges(){return this._onChanges$.pipe((0,delay.c)(0))}isEmptyObj(obj){return 0===Object.keys(obj).length}initElements(){this.elements.forEach((el=>{if(!Array.isArray(el)&&"okra-collection"===el.kind)el.items=el.items.reduce(((acc,cur)=>cur?acc.concat(new ElementClass({kind:cur.kind,elements:cur.elements,attributes:cur.attributes})):acc),[])||[]}))}get(kind,label=null,defaultValue=null,isSpecialPost=!1){delete this.is_default_empty;let data=this.elements.find((el=>!Array.isArray(el)&&(label?el.kind===kind&&el.label===label:el.kind===kind)));if(!data&&"client"===environment_settings.E.MODULE&&isSpecialPost){switch(kind){case"okra-text":data=this.is_saved?getDefaultOkraText(label):getDefaultOkraText(label,defaultValue);break;case"okra-input":data=getDefaultOkraInput(label),this.is_saved||(data.hint=defaultValue?.hint,data.placeholder=defaultValue?.placeholder,data.input_label=defaultValue?.input_label,data.error_message=defaultValue?.error_message?defaultValue?.error_message:{});break;case"okra-button":data=getDefaultOkraButton(label),this.is_saved||(data.text=defaultValue?.text,data.microCopy=defaultValue?.microCopy);break;case"okra-select":data=getDefaultOkraSelect(label),this.is_saved||(data.selectItems=defaultValue?.selectItems,data.hint=defaultValue?.hint,data.input_label=defaultValue?.input_label,data.placeholder=defaultValue?.placeholder,data.label=defaultValue?.label);break;case"okra-image":data=this.is_saved?getDefaultOkraImage(label):getDefaultOkraImage(label,defaultValue)}this.elements.push(data)}if("admin"!==environment_settings.E.MODULE||!data||Array.isArray(data)||data.uuid)if(data||"admin"!==environment_settings.E.MODULE)data||(data=null);else{switch(kind){case"okra-text":data=this.is_saved?getDefaultOkraText(label):getDefaultOkraText(label,defaultValue);break;case"okra-html":data=((label=null)=>{const htmlElement={kind:"okra-html",html:null,uuid:(0,v4.A)()};return label&&(htmlElement.label=label),htmlElement})(label);break;case"okra-list":data=getDefaultOkraList(label);break;case"okra-link-list":data=((label=null)=>{const linkList={kind:"okra-link-list",items:[getDefaultOkraButton()],link:null,blank:!1,uuid:(0,v4.A)()};return label&&(linkList.label=label),linkList})(label);break;case"okra-markdown":data=((label=null)=>{const markDown={kind:"okra-markdown",uuid:(0,v4.A)(),text:""};return label&&(markDown.label=label),markDown})(label);break;case"okra-image":data=this.is_saved?getDefaultOkraImage(label):getDefaultOkraImage(label,defaultValue);break;case"okra-video-streaming":data=((label=null)=>{const videoStreaming={kind:"okra-video-streaming",id:null,width:null,height:null,duration:null,s3_file_path:null,s3_manifest_file_path:null,transcode_status:null,uuid:(0,v4.A)()};return label&&(videoStreaming.label=label),videoStreaming})(label);break;case"okra-youtube":data=this.is_saved?getDefaultOkraEmbed("okra-youtube",label):getDefaultOkraEmbed("okra-youtube",label,defaultValue);break;case"okra-vimeo":data=this.is_saved?getDefaultOkraEmbed("okra-vimeo",label):getDefaultOkraEmbed("okra-vimeo",label,defaultValue);break;case"okra-media":data=this.is_saved?getDefaultOkraMedia(label):getDefaultOkraMedia(label,defaultValue);break;case"okra-carousel":data=this.is_saved?getDefaultOkraCarousel(label):getDefaultOkraCarousel(label,defaultValue);break;case"okra-google-maps":data=((label=null)=>{const googleMap={kind:"okra-google-maps",center:{lat:null,lng:null},marker:{lat:null,lng:null},zoom:null,place:null,contents:null,uuid:(0,v4.A)()};return label&&(googleMap.label=label),googleMap})(label);break;case"okra-fundamental-array":data=getDefaultOkraFundamentalElementArray(label);break;case"okra-table":data=((label=null)=>{const tableData={kind:"okra-table",w:2,h:3,head_h:0,matrix:[[getDefaultOkraTableCell(0,0,1,1),getDefaultOkraTableCell(1,0,1,1)],[getDefaultOkraTableCell(0,1,1,1),getDefaultOkraTableCell(1,1,1,1)],[getDefaultOkraTableCell(0,2,1,1),getDefaultOkraTableCell(1,2,1,1)]],width_unit:null,uuid:(0,v4.A)()};return label&&(tableData.label=label),tableData})(label);break;case"okra-collection":data=((label=null)=>{const collection={kind:"okra-collection",items:[new ElementClass({kind:"okra-collection-item"})],uuid:(0,v4.A)()};return label&&(collection.label=label),collection})(label);break;case"okra-pickable-model":data=((label=null)=>{const pickableModel={kind:"okra-pickable-model",modelKind:null,modelId:null,uuid:(0,v4.A)(),label:null};return label&&(pickableModel.label=label),pickableModel})(label);break;case"okra-input":data=getDefaultOkraInput(label),this.is_saved||(data.hint=defaultValue?.hint,data.placeholder=defaultValue?.placeholder,data.input_label=defaultValue?.input_label,data.error_message=defaultValue?.error_message?defaultValue?.error_message:{});break;case"okra-select":data=getDefaultOkraSelect(label),this.is_saved||(data.selectItems=defaultValue?.selectItems,data.hint=defaultValue?.hint,data.placeholder=defaultValue?.placeholder,data.input_label=defaultValue?.input_label,data.label=defaultValue?.label);break;case"okra-button":data=getDefaultOkraButton(label),this.is_saved||(data.text=defaultValue?.text,data.microCopy=defaultValue?.microCopy,data.color=defaultValue?.color,data.size=defaultValue?.size,data.style=defaultValue?.style)}this.elements.push(data)}else data.uuid=(0,v4.A)();return this._onChanges$.next({type:"add",key:"elements",value:this.elements,detail:data}),data}getList(kind,label=null){delete this.is_default_empty;let data=this.elements.find((el=>!!(Array.isArray(el)&&el.length>0)&&(label?el[0].kind===kind&&el[0].label===label:el[0].kind===kind)));if(!data||0===data.length&&"admin"===environment_settings.E.MODULE){switch(kind){case"okra-text":data=[getDefaultOkraText(label)];break;case"okra-list":data=[getDefaultOkraList(label)];break;case"okra-image":data=[getDefaultOkraImage(label)];break;case"okra-youtube":data=[getDefaultOkraEmbed("okra-youtube",label)];break;case"okra-media":data=[getDefaultOkraMedia(label)];break;case"okra-carousel":data=[getDefaultOkraCarousel(label)]}this.elements.push(data)}else data&&0!==data.length||(data=null);return this._onChanges$.next({type:"add",key:"elements",value:this.elements,detail:data}),data}deleteElement(kind,label=null){const index=this.elements.findIndex((el=>!Array.isArray(el)&&el.kind===kind&&el.label===label));if(index>=0){const deletedElement=this.elements.splice(index,1);this._onChanges$.next({type:"delete",key:"elements",value:this.elements,detail:deletedElement})}}getAttr(kind,label,options){const data=this.getAttrInstance(kind,label,options);if(null==data)return null;switch(data.kind){case"okra-attr-text":case"okra-attr-boolean":case"okra-attr-number":case"okra-attr-select":case"okra-attr-select-or-input":case"okra-attr-color":case"okra-attr-file":case"okra-attr-image":case"okra-attr-picker":return data.value;case"okra-attr-collection":return data.items;default:return data}}getAttr$(kind,label,options){const data=this.getAttrInstance(kind,label,options);return null==data?(0,of.of)(null):data.valueChanges()}getAttrInstance(kind,label,options){const index=this.attributes.findIndex((attr=>attr.kind&&attr.kind===kind&&attr.label&&attr.label===label));let data=index>=0?this.attributes[index]:null;const msgPre=`[Okra Element Attribute | kind ${kind} | label ${label}] :: `,warnMsgDefVal=(k,v)=>`${k}'s defaultValue is a ${"okra-attr-text"===k||"okra-attr-select"===k||"okra-attr-color"===k?"string":"okra-attr-boolean"===k?"boolean":"okra-attr-number"===k?"number":null} type, but the input is ${typeof v}.`;if(!data||!data.isFormatted||!data.valueChanges){const insert=!data,value=data&&"okra-attr-collection"!==data.kind?data.value:void 0;let formValue=options?.defaultValue;switch(kind){case"okra-attr-text":{const attrOptions={...options};data=new OkraAttrText(kind,label,value,attrOptions),formValue=data.value||formValue;break}case"okra-attr-boolean":{"boolean"!=typeof options?.defaultValue&&console.warn(`${msgPre}${warnMsgDefVal(kind,options?.defaultValue)} defaultValue is set to false.`);const attrOptions={...options,defaultValue:"boolean"==typeof options?.defaultValue&&options.defaultValue};data=new OkraAttrBool(kind,label,value,attrOptions,this.is_saved),formValue=data.value||formValue;break}case"okra-attr-number":{"number"!=typeof options?.defaultValue&&console.warn(msgPre,warnMsgDefVal(kind,options?.defaultValue));const attrOptions={...options};data=new OkraAttrNum(kind,label,value,attrOptions),formValue=data.value||formValue;break}case"okra-attr-select":{if(Object.prototype.hasOwnProperty.call(options,"defaultValue")||console.error(`${msgPre}Enter defaultValue for options`),!options?.selectOptions){console.error(`${msgPre}Enter list for options`),data=null;break}const attrOptions={...options};data=new OkraAttrSelect(kind,label,value,attrOptions,this.is_saved),formValue=data.value||formValue;break}case"okra-attr-select-or-input":{if(Object.prototype.hasOwnProperty.call(options,"defaultValue")||console.error(`${msgPre}Enter defaultValue for options`),!options?.selectOptions){console.error(`${msgPre}Enter list for options`),data=null;break}const attrOptions={...options};data=new OkraAttrSelectOrInput(kind,label,value,attrOptions),formValue=data.value||formValue;break}case"okra-attr-color":{const attrOptions={...options};data=new OkraAttrColor(kind,label,value,attrOptions),formValue=data.value||formValue;break}case"okra-attr-file":{const attrOptions={...options};data=new OkraAttrFile(kind,label,value,attrOptions),formValue=data.value||formValue;break}case"okra-attr-image":{const attrOptions={...options};data=new OkraAttrImage(kind,label,value,attrOptions),formValue=data.value||formValue;break}case"okra-attr-picker":{if(!options?.pickerKind){console.error(`${msgPre}Enter pickerKind for options`),data=null;break}const attrOptions={...options};data=new OkraAttrPicker(kind,label,value,attrOptions),formValue=data.value||formValue;break}case"okra-attr-collection":{const items=data&&data.items&&data.items||[],length=items.length||0;for(let i=0;i<length;i++){const el=items[i];el instanceof ElementClass||(items[i]=new ElementClass(el))}const defaultValue=options?.defaultValue;let defaultValues;if(0===length&&null!=defaultValue){const defaultValueLength=defaultValue.length;defaultValues=[];for(let i=0;i<defaultValueLength;i++){const el=defaultValue[i];defaultValues[i]=el instanceof ElementClass?el:new ElementClass(el)}}const attrOptions={...options,defaultValue:defaultValues};data=new OkraAttrCollection(kind,label,items,attrOptions);break}}data&&(insert?this.attributes.push(data):this.attributes.splice(index,1,data))}return this._onChanges$.next({type:"add",key:"attributes",value:this.attributes,detail:data}),data}deleteAttr(kind,label){const index=this.attributes.findIndex((attr=>attr.kind===kind&&attr.label===label));if(index>=0){const deletedAttr=this.attributes.splice(index,1);this._onChanges$.next({type:"delete",key:"attributes",value:this.elements,detail:deletedAttr})}}addEventListener(state,callback){this.listeners[state]||(this.listeners[state]=[]),this.listeners[state].push(callback),this.listeners[state]=this.listeners[state].filter((s=>s))}removeEventListener(state,callback){this.listeners[state]&&(this.listeners[state]=this.listeners[state].filter((v=>v!==callback)))}dispatchEvent(e,data=null){const observers=this.listeners[e.type];for(let i=0;i<observers.length;++i)observers[i](data)}isEmpty(){const elementLength=this.elements.length;for(let i=0;i<elementLength;i++)if(!Array.isArray(this.elements[i])){const el=this.elements[i];if(this.elements[i]=deformatFundamentalElement(el),!this.elements[i].is_empty)return!1}return!0}getAttrFormGroup(){return"admin"!==environment_settings.E.MODULE?null:(this.attrFormGroup||(this.attrFormGroup=new fesm2022_forms.gE({})),this.attrFormGroup)}getExtendableCollection(label){this.is_default_empty&&delete this.is_default_empty;let data=this.elements.find((el=>!Array.isArray(el)&&("okra-extendable-collection"===el.kind&&el.label===label)));data||"admin"!==environment_settings.E.MODULE||(data=((label=null)=>{const extendableCollection={kind:"okra-extendable-collection",items:[new ElementClass({kind:"okra-extendable-collection-item"})],uuid:(0,v4.A)()};return label&&(extendableCollection.label=label),extendableCollection})(label),this.elements.push(data));const itemLength=data.items.length,emptyNumbers=[];for(let i=0;i<itemLength;i++){const el=data.items[i];el instanceof ElementClass||(data.items[i]=new ElementClass(el)),"admin"===environment_settings.E.MODULE&&(i!==itemLength-1?data.items[i].isEmpty()&&emptyNumbers.push(i):data.items[i].isEmpty()||data.items.push(new ElementClass({kind:"okra-extendable-collection-item",elements:[]})))}return data.items=data.items.filter(((item,i)=>!emptyNumbers.some((n=>n===i)))),"admin"===environment_settings.E.MODULE&&setTimeout((()=>{this.dispatchEvent(this.addEvent)}),0),data.items}}var functions=__webpack_require__("./.src/storybook/storybook_admin/lib/utils/functions.ts"),lodash=__webpack_require__("./node_modules/lodash/lodash.js");const prefixByField={app:["",0],email:["email-",.1]};let OkraFormatterService=class OkraFormatterService{get adminToken(){return null!==localStorage.getItem("admin-access-token")?localStorage.getItem("admin-access-token"):""}get clientToken(){return null!==localStorage.getItem("access-token")?localStorage.getItem("access-token"):""}get token(){return this.env.isAdmin?this.adminToken:this.clientToken}constructor(env){this.env=env,this.formatEmailPost=(post,categories)=>{const prefix=prefixByField.email,localeSlug=post.locale?.slug||"",_categories=post.category_ids?post.category_ids.reduce(((acc,cur)=>{const cat=categories.get(cur);return cat?acc.concat(cat):acc}),[]):void 0;post.categories=post.category_ids?_categories:void 0,post.main_category_id?post.main_category=categories.get(post.main_category_id):post.main_category=void 0,post.images=(post.images||[]).map((p=>p)),post.imageMap=new Map((post.images||[]).filter((p=>!!p.id)).map((p=>[p.id,p]))),post.files=(post.files||[]).map((f=>this.formatFile(f))),post.thumbnail||(post.thumbnail=void 0),post.og_image||(post.og_image=void 0),post.elements=(post.elements||[]).map((el=>new ElementClass(el))),post.product_assignment_sets=(post.product_assignment_sets||[]).map((product_assignment_set=>(product_assignment_set.product_assignments=(0,lodash.sortBy)((product_assignment_set.product_assignments||[]).map((product_assignment=>(product_assignment.selectable_attribute_options=(0,lodash.sortBy)(product_assignment.selectable_attribute_options||[],["order"]),product_assignment.thumbnail||(product_assignment.thumbnail=null),product_assignment.images=(product_assignment.images||[]).map((p=>p)),product_assignment))),["combination_order","order"]),product_assignment_set))),post.acf_values||(post.acf_values={});for(const key in post.acf_values)" "===post.acf_values[key]&&(post.acf_values[key]=null);if(post.main_category){if((0,lodash.isString)(post.main_category.url)&&(post.url=environment_settings.E.USE_SLUG?`${post.main_category.url}/${post.slug}`.toLowerCase():`${post.main_category.url}/${post.id}`),post.component_name)return post._component_name=post.component_name,post;if(post._component_name=`${prefix[0]}post-default`,environment_settings.E.POST_COMPONENT_SELECTORS.includes(`${prefix[0]}${post.main_category.name_url}-post`))post._component_name=`${prefix[0]}${post.main_category.name_url}-post`;else if(post.main_category.url){let routeSlugs=post.main_category.url.split("/").filter((slug=>""!==slug));environment_settings.E.I18N&&(routeSlugs=routeSlugs.slice(1));for(let i=routeSlugs.length-1;i>=0;i--){const name_url=routeSlugs[i];if(environment_settings.E.POST_COMPONENT_SELECTORS.includes(`${prefix[0]}${name_url}-post-child`)){post._component_name=`${prefix[0]}${name_url}-post-child`;break}if(environment_settings.E.POST_COMPONENT_SELECTORS.includes(`${prefix[0]}${name_url}-post`)){post._component_name=`${prefix[0]}${name_url}-post`;break}}}}else null!==localeSlug&&environment_settings.E.I18N?post.url=environment_settings.E.USE_SLUG?`/${localeSlug}/${post.slug}`.toLowerCase():`/${localeSlug}/${post.id}`:post.url=environment_settings.E.USE_SLUG?`/${post.slug}`.toLowerCase():`/${post.id}`;return post}}formatFile(file){const paths=file.url_key.split("/"),directory=paths.slice(0,paths.length-1).join("/"),ext=file.file_name.split(".").pop();if(!file.is_public&&(this.env.isPreviewMode||this.env.isAdmin)||file.is_public&&file.is_locked){const prefix=(0,functions.uJ)("file",environment_settings.E.FILE_UPLOAD_PATH,file.url_key);return file.url=(0,functions.ok)(`${prefix}.${ext}?token=${this.token}`,this.env.isAdmin),file.original=(0,functions.ok)(`${prefix}.${ext}?token=${this.token}`,this.env.isAdmin),file}{file.original=(0,functions.uJ)(environment_settings.E.ASSET_UPLOAD_URL,environment_settings.E.FILE_UPLOAD_PATH,directory,file.file_name);const prefix=(0,functions.uJ)(environment_settings.E.ASSET_UPLOAD_URL,environment_settings.E.FILE_UPLOAD_PATH,file.url_key);return file.url=`${prefix}.${ext}`,file}}formatCategory(category,categories,routeIds=[]){category.publish_date=new Date(category.publish_date),category.images=(category.images||[]).map((p=>p)),category.thumbnail=category.thumbnail?category.thumbnail:null,category.og_image=category.og_image?category.og_image:null,category.files=(category.files||[]).map((f=>this.formatFile(f)));const routes=routeIds.find((ids=>ids[ids.length-1]===category.id));if(category.is_route=!!routes,category.name_url&&(category.name_url=category.name_url.toLowerCase()),category.is_tag)return environment_settings.E.TAG_PATH?category.url=(0,functions.uJ)(environment_settings.E.TAG_PATH,String(category.name_url||"")).toLowerCase():category.url=null,category.component_name?(category._component_name=category.component_name,category):environment_settings.E.CATEGORY_COMPONENT_SELECTORS.includes(`${category.name_url}-category`)?(category._component_name=`${category.name_url}-tag`,category):(category._component_name="tag-default",category);if(category.is_project)return category.url=null,category;if(void 0!==routes){const routeSlugs=routes.map((id=>categories.find((c=>c.id===id))?.name_url));if(category.url=(0,functions.uJ)(...routeSlugs.filter((item=>!!item))).toLowerCase(),category.component_name)return category._component_name=category.component_name,category;if(category._component_name="category-default",environment_settings.E.CATEGORY_COMPONENT_SELECTORS.includes(`${category.name_url}-category`))category._component_name=`${category.name_url}-category`;else for(let i=routeSlugs.length-1;i>=0;i--){const name_url=routeSlugs[i];if(environment_settings.E.CATEGORY_COMPONENT_SELECTORS.includes(`${name_url}-category-child`)){category._component_name=`${name_url}-category-child`;break}if(environment_settings.E.CATEGORY_COMPONENT_SELECTORS.includes(`${name_url}-category`)){category._component_name=`${name_url}-category`;break}}}return category}formatPerson(person){return person.images=(person.images||[]).map((p=>p)),person.files=(person.files||[]).map((f=>this.formatFile(f))),person}formatCmsUser(adminUser,locales,isMine=!1){if(this.env.isI18N||!isMine&&0!==adminUser.locales.length||(adminUser.locales=Array.from(locales.values()).filter((locale=>locale.is_default)).map((locale=>locale.id))),locales&&(adminUser.locales=(0,lodash.sortBy)(adminUser.locales),adminUser.locales_info=adminUser.locales.reduce(((acc,cur)=>{const l=locales.get(cur);return l?acc.concat(l):acc}),[]),adminUser.is_global=adminUser.locales_info.some((locale=>locale.is_default))),environment_settings.E.USE_PERSON_PAGE&&environment_settings.E.PERSON_PAGE_PATH){const url=environment_settings.E.PERSON_PAGE_PATH;adminUser.url=(0,functions.uJ)("/",url,String(adminUser.user.id))}return adminUser}formatPost(post,categories,force=!1){const prefix=prefixByField[environment_settings.E.IS_EMAIL?"email":"app"],localeSlug=post.locale?.slug||"",{_categories,_project}=post.category_ids&&post.category_ids.length>0?post.category_ids.reduce(((acc,id)=>{const c=categories.get(id);return c&&(c.is_project?acc._project=this.formatCategory(c,[],[]):c.is_tag||acc._categories.push(categories.get(c.id))),acc}),{_categories:[],_project:null}):{_categories:[],_project:null};if(post.categories=_categories,post.tags=post.tags?.map((tag=>this.formatTag(tag)))||[],post.project=_project,post.main_category=post.main_category_id?categories.get(post.main_category_id):void 0,post.block_category=post.block_category_id?categories.get(post.block_category_id):void 0,post.locale&&null!=post.locale.time_difference&&!post.locale.timezone){const textAbsTimeDifference=("0000"+String(Math.abs(post.locale.time_difference))).slice(-4),diff=post.locale.time_difference<0?"-":"+";post.locale.timezone=diff+textAbsTimeDifference}post.images=(post.images||[]).map((p=>p)),post.imageMap=new Map((post.images||[]).filter((p=>!!p.id)).map((p=>[p.id,p]))),post.files=(post.files||[]).map((f=>this.formatFile(f))),post.thumbnail||(post.thumbnail=null),post.og_image||(post.og_image=null);const elements=(post.elements||[]).map((el=>new ElementClass(el,force))),locked_elements=(post.locked_elements||[]).map((el=>new ElementClass(el,force)));post.elements=elements.concat(locked_elements),post.related_posts=(post.related_posts||[]).map((relatedPost=>(relatedPost.target_post=this.formatPost(relatedPost.target_post,categories),relatedPost))),post.persons=(post.persons||[]).map((person=>this.formatPerson(person))),post.acf_values||(post.acf_values={});for(const key in post.acf_values)" "===post.acf_values[key]&&(post.acf_values[key]=null);const post_id=this.env.isAdmin&&post.origin_id?post.origin_id:post.id;if(post.main_category){if((0,lodash.isString)(post.main_category.url)&&(environment_settings.E.I18N?post.url=environment_settings.E.USE_SLUG?(0,functions.uJ)("/",localeSlug,post.main_category.url,post.slug).toLowerCase():(0,functions.uJ)("/",localeSlug,post.main_category.url,String(post_id)):post.url=environment_settings.E.USE_SLUG?(0,functions.uJ)("/",post.main_category.url,post.slug).toLowerCase():(0,functions.uJ)("/",post.main_category.url,String(post_id))),post.component_name)return post._component_name=post.component_name,post;if(post._component_name=`${prefix[0]}post-default`,environment_settings.E.POST_COMPONENT_SELECTORS.includes(`${prefix[0]}${post.main_category.name_url}-post`))post._component_name=`${prefix[0]}${post.main_category.name_url}-post`;else if(post.main_category.url){let routeSlugs=post.main_category.url.split("/").filter((slug=>""!==slug));environment_settings.E.I18N&&(routeSlugs=routeSlugs.slice(1));for(let i=routeSlugs.length-1;i>=0;i--){const name_url=routeSlugs[i];if(environment_settings.E.POST_COMPONENT_SELECTORS.includes(`${prefix[0]}${name_url}-post-child`)){post._component_name=`${prefix[0]}${name_url}-post-child`;break}if(environment_settings.E.POST_COMPONENT_SELECTORS.includes(`${prefix[0]}${name_url}-post`)){post._component_name=`${prefix[0]}${name_url}-post`;break}}}}else""!==localeSlug&&environment_settings.E.I18N?post.url=environment_settings.E.USE_SLUG?(0,functions.uJ)("/",localeSlug,post.slug).toLowerCase():(0,functions.uJ)("/",localeSlug,String(post_id)):post.url=environment_settings.E.USE_SLUG?(0,functions.uJ)("/",post.slug).toLowerCase():(0,functions.uJ)("/",String(post_id));return post}formatTag(tag){return tag.publish_date=new Date(tag.publish_date),tag.images=(tag.images||[]).map((p=>p)),tag.thumbnail=tag.thumbnail?tag.thumbnail:void 0,tag.og_image=tag.og_image?tag.og_image:null,tag.files=(tag.files||[]).map((f=>this.formatFile(f))),tag.is_tag=!0,tag.name_url&&(tag.name_url=tag.name_url.toLowerCase()),environment_settings.E.TAG_PATH?tag.url=`/${environment_settings.E.TAG_PATH}/${tag.name_url}`.toLowerCase():tag.url=void 0,tag.component_name?(tag._component_name=tag.component_name,tag):environment_settings.E.CATEGORY_COMPONENT_SELECTORS.includes(`${tag.name_url}-category`)?(tag._component_name=`${tag.name_url}-tag`,tag):(tag._component_name="tag-default",tag)}formatMenu(menu,categories){const formatMenuItem=(item,_categories)=>{let _item;return _item=item.is_post?this.formatPost(item,_categories):item.is_custom_data?item:(0,lodash.cloneDeep)(categories.get(item.id)),_item.order||(_item.order=item.order),item.children&&(_item.children=(0,lodash.sortBy)(item.children.map((c=>formatMenuItem(c,categories))),["order"])),_item};return menu.tree=menu.tree.map((item=>formatMenuItem(item,categories))),menu}formatLocale(locale){locale.country&&(locale.country.code=locale.country.code.toLowerCase()),locale.language&&(locale.language.code=locale.language.code.toLowerCase());const countryCode=locale&&null!==locale.country&&void 0!==locale.country?`-${locale.country.code}`:"";return locale.code=`${locale.language.code}${countryCode}`,locale}formatEmailCategory(emailCategory){const prefix=prefixByField.email;return emailCategory.publish_date=new Date(emailCategory.publish_date),emailCategory.url=`/${environment_settings.E.EMAIL_PATH}/${emailCategory.name_url}`.toLowerCase(),emailCategory.component_name?(emailCategory._component_name=`${prefix[0]}${emailCategory.component_name}`,emailCategory):(emailCategory._component_name=`${prefix[0]}category-default`,environment_settings.E.CATEGORY_COMPONENT_SELECTORS.includes(`${prefix[0]}${emailCategory.name_url}-category`)&&(emailCategory._component_name=`${prefix[0]}${emailCategory.name_url}-category`),emailCategory)}static{this.ctorParameters=()=>[{type:env_service._}]}};OkraFormatterService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[env_service._])],OkraFormatterService);var fesm2022_router=__webpack_require__("./node_modules/@angular/router/fesm2022/router.mjs"),transfer_state=__webpack_require__("./.src/storybook/storybook_admin/lib/services/transfer-state.ts"),Observable=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Observable.js"),Subscription=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subscription.js"),from=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/from.js"),filter=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/filter.js"),concatMap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/concatMap.js"),bufferCount=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/bufferCount.js"),reduce=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/reduce.js"),tap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/tap.js"),finalize=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/finalize.js"),shareReplay=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/shareReplay.js"),mergeMap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/mergeMap.js"),http=__webpack_require__("./node_modules/@angular/common/fesm2022/http.mjs");let OkraHttpService=class OkraHttpService{constructor(http,env){this.http=http,this.env=env}delete(url,options){return options?this.http.delete(url,options):this.http.delete(url)}get(url,options){return(0,of.of)(void 0).pipe((0,mergeMap.Z)((()=>(console.warn("HTTP GET SERVICE URL:",url),options?this.http.get(url,options):this.http.get(url)))),(0,catchError.W)((e=>(this.env.isPuppeteer&&console.error(`http get error: ${url}`,e),(0,throwError.$)((()=>e))))))}patch(url,body,options){const BODY=body instanceof Object?JSON.stringify(body):body;return options?this.http.patch(url,BODY,options):this.http.patch(url,BODY)}post(url,body,options){const BODY=body instanceof Object?JSON.stringify(body):body;return options?this.http.post(url,BODY,options):this.http.post(url,BODY)}put(url,body,options){const BODY=body instanceof Object?JSON.stringify(body):body;return options?this.http.put(url,BODY,options):this.http.put(url,BODY)}formPost(url,body,options){return options?this.http.post(url,this.toMultipartData(body),options):this.http.post(url,this.toMultipartData(body))}formPut(url,body,options){return options?this.http.put(url,this.toMultipartData(body),options):this.http.put(url,this.toMultipartData(body))}request(type,url,body,options){const TYPE=type.toUpperCase(),request=new http.Kd(TYPE,url,body,options);return this.http.request(request)}formRequest(type,url,body,options){const TYPE=type.toUpperCase(),request=new http.Kd(TYPE,url,this.toMultipartData(body),options);return this.http.request(request)}removeFiles(obj,namespace=""){let path,_obj;_obj=""===namespace?(0,lodash.cloneDeep)(obj):obj;for(const prop in _obj)if(_obj.hasOwnProperty(prop)){let value=_obj[prop];path=""!==namespace?(0,lodash.isArray)(_obj)?`${namespace}[${prop}]`:`${namespace}.${prop}`:prop,((0,lodash.isArray)(value)||value instanceof Object&&!(value instanceof File))&&(value=this.removeFiles(value,path)),value instanceof File&&(0,lodash.unset)(_obj,path)}return _obj}toMultipartData(obj,form=null,namespace=""){let formData,formKey;null===form?(formData=new FormData,formData.append("json-serialized-data",JSON.stringify(this.removeFiles(obj))),formKey="file"):formData=form;for(const prop in obj)if(obj.hasOwnProperty(prop)){const value=obj[prop];formKey=""!==namespace?(0,lodash.isArray)(obj)?`${namespace}-${prop}`:`${namespace}.${prop}`:prop,(0,lodash.isArray)(value)||value instanceof Object&&!(value instanceof File)?this.toMultipartData(value,formData,formKey):value instanceof File&&formData.append(formKey,value,value.name)}return formData}static{this.ctorParameters=()=>[{type:http.Qq},{type:env_service._}]}};OkraHttpService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[http.Qq,env_service._])],OkraHttpService);let OkraApiCacheService=class OkraApiCacheService{get pageApiChainEnded(){return this._pageApiChainEnded.asObservable()}get requestedApiCount(){return this.urls.size}constructor(http,router,state,env){this.http=http,this.router=router,this.state=state,this.env=env,this.paginationResponseCaches={},this.responseObservables={},this.formattedData={},this._pageApiChainEnded=new Subject.B,this.urls=new Set,this._stateKeys={},this.arrayBufferUnit=100,this.timeStart=(new Date).getTime(),this.router.events.pipe((0,filter.p)((event=>this.env.isBrowser&&event instanceof fesm2022_router.Z))).subscribe((()=>{this.urls.clear()}))}urlKey(url,request=null){const _url=/^https?:\/\//.test(url)?url:encodeURI(url);let key=_url;return(0,lodash.isEmpty)(request)||(key=`${_url}?${(0,functions.uT)(request)}`),key}stateKey(urlKey){return this._stateKeys.hasOwnProperty(urlKey)||(this._stateKeys[urlKey]=(0,transfer_state.zw)(urlKey)),this._stateKeys[urlKey]}hasCache(url,request=null){const stateKey=this.stateKey(this.urlKey(url,request));return!!stateKey&&this.state.hasKey(stateKey)}format(urlKey,formatter){return source=>new Observable.c((subscriber=>{const subscription=new Subscription.yU;return subscription.add(source.pipe((0,concatMap.H)((input=>null===formatter?(0,of.of)(input):(0,lodash.isArray)(input)?(0,from.H)(input).pipe((0,bufferCount.S)(this.arrayBufferUnit),(0,map.T)((items=>items.map((item=>formatter(item,input))))),(0,reduce.T)(((acc,items)=>[...acc,...items]),[])):(0,of.of)(formatter(input,null)))),(0,tap.M)((formatted=>{this.formattedData[urlKey]=formatted}))).subscribe(subscriber)),subscription}))}get(url,request=null,formatter=null){const urlKey=this.urlKey(url,request),stateKey=this.stateKey(urlKey);let subject;const responseObservable=this.responseObservables.hasOwnProperty(urlKey)?this.responseObservables[urlKey]:void 0;if(stateKey&&this.state.hasKey(stateKey))return this.formattedData.hasOwnProperty(urlKey)?(0,of.of)(this.formattedData[urlKey]):(0,of.of)((0,lodash.cloneDeep)(this.state.get(stateKey,null))).pipe(this.format(urlKey,formatter));if(responseObservable)subject=responseObservable;else{let resultReceived=!1;subject=this.http.get(decodeURIComponent(urlKey)).pipe((0,concatMap.H)((res=>(!this.env.isAdmin&&stateKey&&this.state.set(stateKey,(0,lodash.cloneDeep)(res)),(0,of.of)(res).pipe(this.format(urlKey,formatter),(0,tap.M)((_=>resultReceived=!0)))))),(0,catchError.W)((err=>(resultReceived||delete this.responseObservables[urlKey],(0,throwError.$)((()=>({message:`API ${urlKey} error: ${err.name} : ${err.message} (${err})`,error:err})))))),(0,finalize.j)((()=>{resultReceived||delete this.responseObservables[urlKey]})),(0,shareReplay.t)()),this.responseObservables[urlKey]=subject}return(0,of.of)(null).pipe((0,tap.M)((_=>{this.urls.add(url),console.warn("----------api-cache urls----------",this.router.url,JSON.stringify(Array.from(this.urls)))})),(0,mergeMap.Z)((_=>subject.pipe((0,catchError.W)((err=>(0,throwError.$)((()=>err)))),(0,finalize.j)((()=>{setTimeout((()=>{this.urls.size>0&&(this.urls.delete(url),console.warn("----------delete urls----------",this.router.url,url,JSON.stringify(Array.from(this.urls))),0===this.urls.size&&(console.warn("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",this.router.url),this._pageApiChainEnded.next()))}),500)}))))))}static{this.ctorParameters=()=>[{type:OkraHttpService},{type:fesm2022_router.Ix},{type:transfer_state.WL},{type:env_service._}]}};OkraApiCacheService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[OkraHttpService,fesm2022_router.Ix,transfer_state.WL,env_service._])],OkraApiCacheService);var common=__webpack_require__("./node_modules/@angular/common/fesm2022/common.mjs"),never=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/never.js");let OkraResponseResolverService=class OkraResponseResolverService{get puppeteerRequestHeaders(){return this.document[this.puppeteerRequestKey].headers}set puppeteerRequestHeaders(obj){this.document[this.puppeteerRequestKey].headers=obj}get puppeteerResponseHeaders(){return this.document[this.puppeteerResponseKey].headers}set puppeteerResponseHeaders(obj){this.document[this.puppeteerResponseKey].headers=obj}get puppeteerResponseStatus(){return this.document[this.puppeteerResponseKey].status}set puppeteerResponseStatus(status){this.document[this.puppeteerResponseKey].status=status}get puppeteerResponseCookies(){return this.document[this.puppeteerResponseKey].cookies}set puppeteerResponseCookies(cookies){this.document[this.puppeteerResponseKey].cookies=cookies}get responseRedirect$(){return this._responseRedirect$.asObservable()}constructor(env,router,location,appId,document){this.env=env,this.router=router,this.location=location,this.appId=appId,this.document=document,this.puppeteerRequestKey="PuppeteerRequest",this.puppeteerResponseKey="PuppeteerResponse",this._responseRedirect$=new Subject.B,this.document[this.puppeteerRequestKey]||(this.document[this.puppeteerRequestKey]={headers:{}}),this.document[this.puppeteerResponseKey]||(this.document[this.puppeteerResponseKey]={headers:{},status:{statusCode:200,statusMessage:""},cookies:[]})}getRequestHeader(key){if(this.env.isPuppeteer)return this.puppeteerRequestHeaders[key]}redirect(status,url){return this.env.isServer?(this.setRedirectionStatus(status),this.setHeader("location",url),this._responseRedirect$.next(),this):((0,functions.q)(url)?this.env.isPreviewMode?window.location.replace(`/${environment_settings.E.PREVIEW_PATH}${url}`):window.location.replace(url):window.location.href=url,this)}replaceUrl(status,url,queryParams=null,fragment=""){return this.env.isServer?(this.setRedirectionStatus(status),this.setHeader("location",url),this):(this.router.navigate([url],{fragment,queryParams,replaceUrl:!0}),this)}getHeader(key){return this.puppeteerResponseHeaders[key]||""}setHeader(key,value){return this.puppeteerResponseHeaders[key]=value,this}appendHeader(key,value,delimiter=","){const current=this.getHeader(key);if(!current)return this.setHeader(key,value);const newValue=[...current.split(delimiter),value].filter(((el,i,a)=>i===a.indexOf(el))).join(delimiter);return this.setHeader(key,newValue),this}setHeaders(dictionary){return Object.keys(dictionary).forEach((key=>this.setHeader(key,dictionary[key]||""))),this}setStatus(code,message,timeout=!1){if(this.puppeteerResponseStatus={statusCode:code,statusMessage:message||"No message"},this.env.isPuppeteer){const body=this.document.querySelector("body"),input=this.document.createElement("input");input.setAttribute("id",`${this.appId}-state-url`),input.setAttribute("type","hidden"),input.setAttribute("data-path",this.location.path(!0).replace(/\/$/,"")),input.setAttribute("data-timestamp",""+ +new Date),input.setAttribute("data-status",`${code}`),input.setAttribute("data-message",message),input.setAttribute("name","state-file-url"),input.classList.add("isPageDomLoaded"),timeout&&(input.classList.add("ssrTimedOut"),this.setHeader("X-Okra-Timeout","true")),body.appendChild(input)}else this.env.isBrowser&&console.error(`Server responded with error. ${code}`);return this}setRedirectionStatus(code,message){return this.puppeteerResponseStatus={statusCode:code,statusMessage:message||""},this._responseRedirect$.next(),this.setStatus(code),this}setNotFound(message="not found"){return this.puppeteerResponseStatus={statusCode:404,statusMessage:message},this}setError(message="internal server error"){return this.puppeteerResponseStatus={statusCode:500,statusMessage:message},this}appendCookies(cookiesString){this.puppeteerResponseCookies.push(cookiesString)}static{this.ctorParameters=()=>[{type:env_service._},{type:fesm2022_router.Ix},{type:common.Location},{type:String,decorators:[{type:core.Inject,args:[core.APP_ID]}]},{type:void 0,decorators:[{type:core.Inject,args:[common.DOCUMENT]}]}]}};OkraResponseResolverService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[env_service._,fesm2022_router.Ix,common.Location,String,Object])],OkraResponseResolverService);const COOKIE_OPTIONS=new core.InjectionToken("COOKIE_OPTIONS");let OkraCookieService=class OkraCookieService{has(key){return this.getAll().hasOwnProperty(key)}get(key){return(0,functions.Kh)(this.cookieString)[key]}getObject(key){const value=this.get(key);return value?(0,functions.jD)(value):value}getAll(){return(0,functions.Kh)(this.cookieString)}put(key,value,options){this._cookieWriter()(key,value,options)}putObject(key,value,options){this.put(key,JSON.stringify(value),options)}remove(key,options){this._cookieWriter()(key,"",options)}removeAll(options){const cookies=this.getAll();Object.keys(cookies).forEach((key=>{this.remove(key,options)}))}constructor(env,options={},_injector,responseResolver,document){this.env=env,this._injector=_injector,this.responseResolver=responseResolver,this.document=document,this.options={path:this._injector.get(common.APP_BASE_HREF,"/"),domain:environment_settings.E.COOKIE_DOMAIN,expires:null,secure:!1,httpOnly:!1}}get cookieString(){if(this.env.isBrowser)return this.document.cookie||"";{let cookieString=this.responseResolver.puppeteerRequestHeaders.cookie||"";return cookieString+=this.responseResolver.puppeteerResponseCookies.join("; "),cookieString}}set cookieString(val){this.env.isBrowser?this.document.cookie=val:this.responseResolver.appendCookies(val)}_cookieWriter(){const that=this;return function(name,value,options){that.cookieString=that._buildCookieString(name,value,options)}}_buildCookieString(name,value,options){const opts=(0,functions.lL)(this.options,options);let expires=opts.expires;(0,functions.z3)(value)&&(expires="Thu, 01 Jan 1970 00:00:00 GMT",value=""),(0,lodash.isString)(expires)&&(expires=new Date(expires));const cookieValue=opts.storeUnencoded?value:encodeURIComponent(value);let str=encodeURIComponent(name)+"="+cookieValue;str+=opts.path?";path="+opts.path:"",this.env.isPuppeteer&&environment_settings.E.COOKIE_DOMAIN?str+=";domain="+environment_settings.E.COOKIE_DOMAIN:opts.domain&&(str+=";domain="+opts.domain),str+=expires?";expires="+expires.toUTCString():"",str+=opts.secure?";secure":"",str+=opts.httpOnly?"; HttpOnly":"";const cookieLength=str.length+1;return cookieLength>4096&&console.log(`Cookie '${name}' possibly not set or overflowed because it was too\n      large (${cookieLength} > 4096 bytes)!`),str}static{this.ctorParameters=()=>[{type:env_service._},{type:void 0,decorators:[{type:core.Optional},{type:core.Inject,args:[COOKIE_OPTIONS]}]},{type:core.Injector},{type:OkraResponseResolverService},{type:Document,decorators:[{type:core.Inject,args:[common.DOCUMENT]}]}]}};OkraCookieService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[env_service._,Object,core.Injector,OkraResponseResolverService,Document])],OkraCookieService);var fromEvent=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/fromEvent.js");let OkraTranslationService=class OkraTranslationService{get editMode(){return this._editMode}set editMode(value){this._editMode=value,this.env.isBrowser&&(this.env.isPreviewMode||"dev"===this.env.targetEnv)?this._editMode?this.disableLink():this.unsubscribeLink():this._editMode=!1,this.editModeChange.next(this._editMode)}disableLink(){for(const a of Array(this.document.getElementsByTagName("a")))this._linkSubscriptions.push((0,fromEvent.R)(a,"click").subscribe((e=>(e.preventDefault(),e.stopPropagation(),!1))))}unsubscribeLink(){this._linkSubscriptions.forEach((s=>{s.unsubscribe()})),this._linkSubscriptions=[]}constructor(document,env){this.document=document,this.env=env,this.beforechangeTranslations={},this.translations=[],this.reversed=[],this.update=new Subject.B,this.updateTranslation$=new Subject.B,this.editModeChange=new Subject.B,this._editMode=!1,this._linkSubscriptions=[]}setTranslations(translations){this.translations=translations,this.beforechangeTranslations=JSON.parse(JSON.stringify(translations)),this.reversed=[],Object.keys(this.translations).forEach((key=>{this.reversed.push({code:key,translation:this.translations[key]})}))}updateTranslation(code,translated,fromAdmin=!1){fromAdmin||this.updateTranslation$.next({code,translation:translated}),this.translations[code]=translated,this.update.next()}saveTranslation(success){success&&this.setTranslations(this.translations)}static{this.ctorParameters=()=>[{type:void 0,decorators:[{type:core.Inject,args:[common.DOCUMENT]}]},{type:env_service._}]}};OkraTranslationService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[Object,env_service._])],OkraTranslationService);const formatRouteIds=menu=>{const flattenIds=(item,results,inheritedIdArray=[])=>{(item=>item.hasOwnProperty("id"))(item)&&(inheritedIdArray.push(item.id),results.push(inheritedIdArray)),item.children&&item.children.forEach((child=>{const idArray=(0,lodash.cloneDeep)(inheritedIdArray);flattenIds(child,results,idArray)}))},routes=[];return menu&&menu.tree.forEach((c=>flattenIds(c,routes,[]))),routes},formatRequest=(params,expectedKeys=[])=>Object.keys(params||{}).filter((key=>expectedKeys.includes(key))).reduce(((obj,key)=>(null!==params&&(console.log(obj,key,params[key]),obj[key]=params[key]),obj)),{});let OkraLocaleService=class OkraLocaleService{get timezone(){return this.formatTimeZone(this.currentLocale)}get currentLocaleResolved$(){return this._currentLocaleResolved$}constructor(router,location,rendererFactory,env,cookie,apiCache,responseResolver,translationService,formatterService,document){this.router=router,this.location=location,this.rendererFactory=rendererFactory,this.env=env,this.cookie=cookie,this.apiCache=apiCache,this.responseResolver=responseResolver,this.translationService=translationService,this.formatterService=formatterService,this.document=document,this.locales=[],this.translations={},this._currentLocaleResolved$=new Subject.B,this.renderer=this.rendererFactory.createRenderer(null,null)}setUserLocale(locale){locale&&locale.code&&(this.env.isAdmin||(this.cookie.put("locale_code",locale.code),this.userLocale=locale))}formatTimeZone(locale){if(!locale||!locale.time_difference)return"+0000";const TEXT_ABS_TIME_DIFFERENCE=("0000"+String(Math.abs(locale.time_difference))).slice(-4),DIFF=locale.time_difference<0?"-":"+";return isNaN(locale.time_difference)?"+0000":DIFF+TEXT_ABS_TIME_DIFFERENCE}setCurrentLocale(locale){if(!locale.language)return never.t;if(this.currentLocale=this.env.isAdmin&&!this.env.isIframe&&this.defaultLocale?this.defaultLocale:locale,this.document.documentElement.lang=locale.language?.code,this.env.rtlLanguages.some((lang=>lang===locale.language?.code))&&(this.document.documentElement.dir="rtl"),!this.env.isAdmin&&(environment_settings.E.I18N&&!this.document.querySelector('link[data-id="hreflang"]')&&this.locales.forEach((_locale=>{const hreflangElement=this.renderer.createElement("link"),lang=_locale.country?`${_locale.language?.code}-${_locale.country.code}`:_locale.language?.code;this.renderer.setAttribute(hreflangElement,"rel","alternate"),this.renderer.setAttribute(hreflangElement,"hreflang",lang),this.renderer.setAttribute(hreflangElement,"href",(0,functions.uJ)(environment_settings.E.SITE_URL,_locale.slug)),this.renderer.setAttribute(hreflangElement,"data-id","hreflang"),this.renderer.appendChild(this.document.head,hreflangElement)})),!this.document.querySelector('link[data-id="rss"]'))){const rssLinkElement=this.renderer.createElement("link");this.renderer.setAttribute(rssLinkElement,"rel","alternate"),this.renderer.setAttribute(rssLinkElement,"type","application/rss+xml"),this.renderer.setAttribute(rssLinkElement,"title",environment_settings.E.SITE_TITLE),this.renderer.setAttribute(rssLinkElement,"href",(0,functions.uJ)(environment_settings.E.SITE_URL,`${environment_settings.E.API_PATH}/feed/rss`,environment_settings.E.I18N?this.currentLocale.slug:"")),this.renderer.setAttribute(rssLinkElement,"data-id","rss"),this.renderer.appendChild(this.document.head,rssLinkElement)}return this.apiCache.get("translations",{locale_id:this.currentLocale.id}).pipe((0,map.T)((res=>(this.translations=res,this.translationService.setTranslations(this.translations),!0))))}resolveRequest(params=null,expectedKeys=null){return environment_settings.E.I18N&&(this.currentLocale||console.error("Error on LocaleService.resolveRequest: this function\n        should not be called before locale is set. Before resolving all locales,\n        you need to use resolveRequest_(request): Observable<[any, LocaleSetting]> instead."),null===params&&(params={locale_id:this.currentLocale?.id}),params.locale_id=this.currentLocale?.id),null===expectedKeys?params||{}:formatRequest(params||{},expectedKeys||[])}resolveRequest_(request=null){return this.resolveLocale().pipe((0,map.T)((settings=>environment_settings.E.I18N?[{...request||{},locale_id:settings.currentLocale.id},settings]:[request,settings])))}resolveLocale(requestedLocaleSlug){if(this._currentLocaleResolved$.next(!1),(void 0!==this.userLocale||this.env.isAdmin)&&void 0!==this.currentLocale)return(0,of.of)({userLocale:this.userLocale,currentLocale:this.currentLocale,locales:this.locales});let localeCode;return this.apiCache.get("locales",null,this.formatterService.formatLocale).pipe((0,catchError.W)((err=>this.env.isServer?(0,throwError.$)((()=>(this.responseResolver.setStatus(err.status,err.message),err))):(0,throwError.$)((()=>err)))),(0,map.T)((locales=>{this.defaultLocale=locales.find((l=>l.is_default));const defaultLocaleCode=this.defaultLocale?.code;if(!environment_settings.E.I18N)return{userLocale:this.defaultLocale,currentLocale:this.defaultLocale,locales};if(this.env.isServer)if(this.cookie.has("locale_code"))localeCode=this.cookie.get("locale_code");else{let viewerCountry=this.responseResolver.getRequestHeader("cloudfront-viewer-country");if(viewerCountry||(viewerCountry=this.responseResolver.getRequestHeader("client-geo-country")),void 0!==viewerCountry){const countryMatches=locales.filter((_locale=>!!_locale.country&&_locale.country.code.toLowerCase()===viewerCountry.toLowerCase()));localeCode=countryMatches.length>0&&countryMatches[0]?countryMatches[0].code:defaultLocaleCode}else localeCode=defaultLocaleCode;void 0!==localeCode&&void 0!==localeCode||(localeCode=defaultLocaleCode)}else this.env.isBrowser&&(this.cookie.has("locale_code")&&(localeCode=this.cookie.get("locale_code")),void 0!==localeCode&&void 0!==localeCode||(localeCode=defaultLocaleCode));let currentLocale,redirect,userLocale=locales.find((l=>l.code===localeCode))||this.defaultLocale||locales[0];if(!environment_settings.E.I18N)return currentLocale=userLocale,{userLocale,currentLocale:userLocale,locales};if(requestedLocaleSlug)currentLocale=locales.find((l=>l.slug===requestedLocaleSlug));else{const tree=this.router.parseUrl(this.location.path());if(tree.root.children.hasOwnProperty("primary")){const paths=tree.root.children.primary.segments.map((segment=>segment.path));paths.length>0&&(currentLocale=locales.find((l=>l.slug===paths[0])))}}return void 0===currentLocale&&(redirect=303,currentLocale=userLocale),{userLocale,currentLocale,locales,redirect}})),(0,concatMap.H)((settings=>(localStorage.setItem("current-locale-id",settings.currentLocale.id.toString()),this.setUserLocale(settings.userLocale),this.locales=settings.locales,this._currentLocaleResolved$.next(!0),this.setCurrentLocale(settings.currentLocale).pipe((0,map.T)((_=>settings)))))))}setLocales(locales){this.env.isAdmin&&(this.locales=locales)}static{this.ctorParameters=()=>[{type:fesm2022_router.Ix},{type:common.Location},{type:core.RendererFactory2},{type:env_service._},{type:OkraCookieService},{type:OkraApiCacheService},{type:OkraResponseResolverService},{type:OkraTranslationService},{type:OkraFormatterService},{type:Document,decorators:[{type:core.Inject,args:[common.DOCUMENT]}]}]}};OkraLocaleService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[fesm2022_router.Ix,common.Location,core.RendererFactory2,env_service._,OkraCookieService,OkraApiCacheService,OkraResponseResolverService,OkraTranslationService,OkraFormatterService,Document])],OkraLocaleService);let OkraCategoryService=class OkraCategoryService{constructor(apiCache,localeService,formatterService){this.apiCache=apiCache,this.localeService=localeService,this.formatterService=formatterService}categories(routeIds,_request=null){return void 0!==this._categories?(0,of.of)(this._categories.map((category=>this.formatterService.formatCategory(category,this._categories||[],routeIds)))):this.apiCache.get("categories",_request,((category,categories)=>this.formatterService.formatCategory(category,categories,routeIds)))}getCategoryById(id){return this.getCategories().pipe((0,map.T)((categories=>categories.find((c=>c.id===id)))))}getCategoriesByIds(ids){return this.getCategories().pipe((0,map.T)((categories=>categories.filter((c=>ids.includes(c.id))))))}setCategories(categories){this._categories=JSON.parse(JSON.stringify(categories))}getCategories(_request=null){return this.apiCache.get("menus/routes",{temporary:!0},formatRouteIds).pipe((0,mergeMap.Z)((routeIds=>this.categories(routeIds,_request))))}getAuthCategoryById(id,request=null){request&&"preview"in request&&/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/.test(request.preview)&&(request.timestamp=(new Date).getTime());const url=`auth_categories/${id}`;return this.apiCache.get(url,request)}getFlattenRouteUrls(){return this.getCategories().pipe((0,map.T)((categories=>categories.map((category=>category.url)).filter((url=>!!url)))),(0,shareReplay.t)(1))}getEmailCategories(){return(0,of.of)({}).pipe((0,mergeMap.Z)((()=>this.apiCache.get("__email/categories",{},(category=>this.formatterService.formatEmailCategory(category))))))}static{this.ctorParameters=()=>[{type:OkraApiCacheService},{type:OkraLocaleService},{type:OkraFormatterService}]}};OkraCategoryService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[OkraApiCacheService,OkraLocaleService,OkraFormatterService])],OkraCategoryService);let OkraMenuService=class OkraMenuService{constructor(apiCache,categoryService,localeService,formatterService){this.apiCache=apiCache,this.categoryService=categoryService,this.localeService=localeService,this.formatterService=formatterService}getRoutes(){return this.categoryService.getCategories().pipe((0,switchMap.n)((categories=>{const _categories=new Map(categories.map((c=>[c.id,c])));return this.localeService.resolveRequest_().pipe((0,switchMap.n)((([request,_])=>this.apiCache.get("menus/routes",request,(menu=>this.formatterService.formatMenu(menu,_categories))).pipe((0,catchError.W)((err=>(0,throwError.$)((()=>err))))))))})))}getMenu(name){return this.categoryService.getCategories().pipe((0,switchMap.n)((categories=>{const _categories=new Map(categories.map((c=>[c.id,c])));return this.localeService.resolveRequest_().pipe((0,switchMap.n)((([request,_])=>this.apiCache.get(`menus/${name.toLowerCase()}`,request,(menu=>this.formatterService.formatMenu(menu,_categories))).pipe((0,catchError.W)((err=>(0,throwError.$)((()=>err))))))))})))}hasMenuCache(name){return this.apiCache.hasCache(`menus/${name.toLowerCase()}`,this.localeService.resolveRequest(null))}static{this.ctorParameters=()=>[{type:OkraApiCacheService},{type:OkraCategoryService},{type:OkraLocaleService},{type:OkraFormatterService}]}};OkraMenuService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[OkraApiCacheService,OkraCategoryService,OkraLocaleService,OkraFormatterService])],OkraMenuService);const typeGuardCategory=c=>c?.hasOwnProperty("is_tag")||!1;let OkraBreadcrumbsService=class OkraBreadcrumbsService{constructor(menuService){this.menuService=menuService}loadCategoryBreadcrumbs(category){return this.menuService.getRoutes().pipe((0,map.T)((_menu=>{if(category.url?.startsWith(`/${environment_settings.E.TAG_PATH}`)||category.url?.startsWith(`/${environment_settings.E.PERSON_PAGE_PATH}`))return[];return this._getCategoryTree(_menu,category).map((c=>this.mapCategoryToBreadcrumb(typeGuardCategory(c)?c:null)))})))}loadPostBreadcrumbs(post){return this.menuService.getRoutes().pipe((0,map.T)((_menu=>{if(!post.url||!post.main_category)return[];const postBreadcrumb={title:post.title,url:post.url,is_current_item:!0,content:post};return this._getCategoryTree(_menu,post.main_category).map((c=>this.mapCategoryToBreadcrumb(typeGuardCategory(c)?c:null))).concat([postBreadcrumb])})))}_getCategoryTree(menu,category){const isMatchedCategory=(category,id)=>{return c=category,!!c?.hasOwnProperty("is_tag")&&category.id===id;var c},iterateTree=(children,category,path=[])=>{for(let i=0;i<children.length;i++){const child=children[i];if(void 0!==child){if(isMatchedCategory(child,category.id))return[...path,child];if(child.children.length){const result=iterateTree(child.children,category,[...path,child]);if(result)return result}}}return null},rootCategory=menu.tree[0];return rootCategory&&typeGuardCategory(rootCategory)?category?iterateTree([rootCategory],category,[])||[]:iterateTree([rootCategory],rootCategory,[])||[]:[]}mapCategoryToBreadcrumb(category,currentId){return category?{title:category.name_menu||"",url:category.url||"",is_current_item:currentId===category.id,content:category}:{title:"-",url:"",is_current_item:!1,content:null}}static{this.ctorParameters=()=>[{type:OkraMenuService}]}};OkraBreadcrumbsService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[OkraMenuService])],OkraBreadcrumbsService);var takeUntil=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/takeUntil.js"),asyncToGenerator=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js");let OkraVisibilityService=class OkraVisibilityService{constructor(env,document){this.env=env,this.document=document,this.hidden=new Subject.B,this.shown=new Subject.B,this.env.isServer||(0,fromEvent.R)(this.document,"visibilitychange").subscribe((event=>{"hidden"===this.document.visibilityState&&this.hidden.next(event.timeStamp),"visible"===this.document.visibilityState&&this.shown.next(event.timeStamp)}))}static{this.ctorParameters=()=>[{type:env_service._},{type:void 0,decorators:[{type:core.Inject,args:[common.DOCUMENT]}]}]}};OkraVisibilityService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[env_service._,Object])],OkraVisibilityService);var TransitionMethod,object_hash=__webpack_require__("./node_modules/object-hash/dist/object_hash.js"),empty=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/empty.js"),race=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/race.js"),merge=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/merge.js"),zip=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/zip.js"),first=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/first.js"),share=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/share.js"),take=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/take.js"),skip=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/skip.js"),scan=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/scan.js");function hasRoutingAnimation(event){return!!event&&(!event.pop&&(!!event.animation&&!!event.animation.func))}function getStyles(animation,el,phase){return animation&&(animation.duration||animation.func)&&animation.styles&&animation.styles[el]&&animation.styles[el][phase]?(0,lodash.isEmpty)(animation.styles[el][phase])?null:animation.styles[el][phase]:null}function setStyles(target,styles,phase){if(target.renderer.addClass(target.el.nativeElement,`okra-show-animation-${phase}`),styles)for(const key of Object.keys(styles))target.renderer.setStyle(target.el.nativeElement,key,styles[key])}function setContainerStyles(target,styles){for(const key of Object.keys(styles))target.renderer.setStyle(target.el.nativeElement,key,styles[key])}!function(TransitionMethod){TransitionMethod.INTERNAL="internal",TransitionMethod.TAB="tab",TransitionMethod.TAB_INTERNAL="tab_internal",TransitionMethod.POPSTATE="popstate",TransitionMethod.QUERY="query",TransitionMethod.ANCHOR="anchor",TransitionMethod.VISIT="visit",TransitionMethod.LEAVE="leave",TransitionMethod.OTHER="other"}(TransitionMethod||(TransitionMethod={}));let OkraPersonService=class OkraPersonService{constructor(apiCache,localeService){this.apiCache=apiCache,this.localeService=localeService}getPersonById(id,request=null){return this.apiCache.get(`persons/${id}`,this.localeService.resolveRequest(request),(person=>person))}getPersonBySlug(name,request=null){return this.apiCache.get(`persons/name/${name}`,request,(person=>person))}getPersons(request=null,is_random=!1,unit=null){return null===request&&(request={}),request.random_persons=is_random,request.persons_unit=unit,this.apiCache.get("persons",this.localeService.resolveRequest(request),(persons=>persons))}static{this.ctorParameters=()=>[{type:OkraApiCacheService},{type:OkraLocaleService}]}};OkraPersonService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[OkraApiCacheService,OkraLocaleService])],OkraPersonService);const dynamicImportedElementComponent={},dynamicImportElements=elementKinds=>Promise.all(elementKinds.map((kind=>(elementKind=>{let module$;return module$=null,module$?module$.then((module=>(dynamicImportedElementComponent[elementKind]=module,module))):null})(kind))));let OkraPostService=class OkraPostService{constructor(apiCache,categoryService,localeService,formatterService,env,state,http){this.apiCache=apiCache,this.categoryService=categoryService,this.localeService=localeService,this.formatterService=formatterService,this.env=env,this.state=state,this.http=http}importElementsComponent(postContainer){return postContainer&&postContainer.post&&postContainer.post.elements?(0,of.of)(null).pipe((0,mergeMap.Z)((()=>{const kinds=postContainer.post.elements.map((element=>element.kind));if(this.env.isSSR){const stateKey=(0,transfer_state.zw)("SSRImportedElementsName"),savedKinds=this.state.get(stateKey,[]);kinds.forEach((kind=>{-1===savedKinds.indexOf(kind)&&savedKinds.push(kind)})),this.state.set(stateKey,savedKinds)}return(0,from.H)(dynamicImportElements(kinds)).pipe((0,map.T)((_=>postContainer)))}))):(0,of.of)(postContainer)}getFormPostBySlug(slug,request=null){request&&"preview"in request&&/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/.test(request.preview)&&(request.timestamp=(new Date).getTime());let url="";url=this.env.isAdmin?`posts/form/1/${slug}`:`posts/form/${this.localeService.currentLocale.id}/${slug}`,console.log("form: getFormPostBySlug",url);const _categories=new Map([]);return this.http.get(url).pipe((0,map.T)((_post=>({post:this.formatterService.formatPost(_post,_categories),redirectUrl:null}))),(0,mergeMap.Z)((postContainer=>this.importElementsComponent(postContainer))))}getPostBySlug(slug,categoryId,localeId,request=null){request&&"preview"in request&&/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/.test(request.preview)&&(request.timestamp=(new Date).getTime());const url=categoryId?`posts/slug/${localeId}/${categoryId}/${slug}`:`posts/block/${localeId}/${slug}`;return this.categoryService.getCategories().pipe((0,switchMap.n)((categories=>{const _categories=new Map(categories.map((c=>[c.id,c])));return this.apiCache.get(url,formatRequest(request||{},["id","preview","timestamp","locale_id","locale","reference_id","is_block","reference_date"]),(post=>({post:this.formatterService.formatPost(post,_categories)}))).pipe((0,catchError.W)((err=>(0,throwError.$)((()=>err)))))})),(0,mergeMap.Z)((postContainer=>this.importElementsComponent(postContainer))))}getPostById(id,request=null){return request&&"preview"in request&&/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/.test(request.preview)&&(request.timestamp=(new Date).getTime()),this.categoryService.getCategories().pipe((0,switchMap.n)((categories=>{const _categories=new Map(categories.map((c=>[c.id,c])));return this.apiCache.get(`posts/${id}`,formatRequest(request,["id","preview","timestamp","locale_id","reference_id","is_block","reference_date"]),(post=>({post:this.formatterService.formatPost(post,_categories)}))).pipe((0,catchError.W)((err=>(0,throwError.$)((()=>err)))))})),(0,mergeMap.Z)((postContainer=>this.importElementsComponent(postContainer))))}getLockedElementsById(id,request=null){return request&&"preview"in request&&/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/.test(request.preview)&&(request.timestamp=(new Date).getTime()),this.categoryService.getCategories().pipe((0,switchMap.n)((categories=>{const _categories=new Map(categories.map((c=>[c.id,c])));return this.apiCache.get((0,functions.ok)(`posts/locked_elements/${id}`,this.env.isAdmin),request,(post=>({post:this.formatterService.formatPost(post,_categories)})))})),(0,mergeMap.Z)((postContainer=>this.importElementsComponent(postContainer))))}getPosts(request=null){return this.categoryService.getCategories().pipe((0,switchMap.n)((categories=>{const _categories=new Map(categories.map((c=>[c.id,c])));return this.apiCache.get("posts/search",request,(post=>this.formatterService.formatPost(post,_categories)))})))}getPagedPosts(request=null){return request.paginate=!0,this.categoryService.getCategories().pipe((0,switchMap.n)((categories=>{const _categories=new Map(categories.map((c=>[c.id,c])));return this.apiCache.get("posts/search",request,(result=>(result.results.map((item=>this.formatterService.formatPost(item,_categories))),result)))})))}getContentProtectionPosts(request=null){return this.categoryService.getCategories().pipe((0,switchMap.n)((categories=>{const _categories=new Map(categories.map((c=>[c.id,c])));return this.apiCache.get((0,functions.ok)("posts/search",this.env.isAdmin),request,(post=>this.formatterService.formatPost(post,_categories)))})))}getPagedContentProtectionPosts(request=null){return request.paginate=!0,this.categoryService.getCategories().pipe((0,switchMap.n)((categories=>{const _categories=new Map(categories.map((c=>[c.id,c])));return this.apiCache.get((0,functions.ok)("posts/search",this.env.isAdmin),request,(result=>(result.results.map((item=>this.formatterService.formatPost(item,_categories))),result)))})))}getEmailPostBySlug(slug,emailCategoryId,request=null){return request&&"preview"in request&&/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/.test(request.preview)&&(request.timestamp=(new Date).getTime()),this.categoryService.getEmailCategories().pipe((0,switchMap.n)((categories=>{const _categories=new Map(categories.map((c=>[c.id,c])));return this.apiCache.get(`${environment_settings.E.EMAIL_PATH}/posts/slug/${Math.floor(emailCategoryId)}/${slug}`,request,(post=>({post:this.formatterService.formatPost(post,_categories)})))})),(0,mergeMap.Z)((postContainer=>this.importElementsComponent(postContainer))))}getEmailPostById(id,request=null){return request&&"preview"in request&&/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/.test(request.preview)&&(request.timestamp=(new Date).getTime()),this.categoryService.getEmailCategories().pipe((0,switchMap.n)((categories=>{const _categories=new Map(categories.map((c=>[c.id,c])));return this.apiCache.get(`${environment_settings.E.EMAIL_PATH}/posts/${id}`,request,(post=>({post:this.formatterService.formatEmailPost(post,_categories)})))})),(0,mergeMap.Z)((postContainer=>this.importElementsComponent(postContainer))))}static{this.ctorParameters=()=>[{type:OkraApiCacheService},{type:OkraCategoryService},{type:OkraLocaleService},{type:OkraFormatterService},{type:env_service._},{type:transfer_state.WL},{type:OkraHttpService}]}};OkraPostService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[OkraApiCacheService,OkraCategoryService,OkraLocaleService,OkraFormatterService,env_service._,transfer_state.WL,OkraHttpService])],OkraPostService);let OkraTagService=class OkraTagService{constructor(apiCache,localeService,formatterService,env){this.apiCache=apiCache,this.localeService=localeService,this.formatterService=formatterService,this.env=env}getTag(name_url){return this.apiCache.get(`tag/${name_url}`,null,(tag=>this.formatterService.formatTag(tag)))}getTagsList(request=null){return this.apiCache.get("tags/list",request,(tags=>tags.map((item=>this.formatterService.formatTag(item)))))}getPagedTagsList(request=null){return request.paginate=!0,this.apiCache.get("tags/list",request,(res=>{const tags=res.results.map((item=>this.formatterService.formatTag(item)));return res.results=tags,res}))}getPopularTag(request=null){return this.apiCache.get("popular/tag",request,(item=>({tag:this.formatterService.formatTag(item.tag),pageview:item.pageview})))}static{this.ctorParameters=()=>[{type:OkraApiCacheService},{type:OkraLocaleService},{type:OkraFormatterService},{type:env_service._}]}};OkraTagService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[OkraApiCacheService,OkraLocaleService,OkraFormatterService,env_service._])],OkraTagService);let OkraUrlHistoryService=class OkraUrlHistoryService{constructor(http,env){this.http=http,this.env=env}searchHistory(_url){const urls=_url.split("?");return this.http.get(`url_change_history_search?url=${urls[0]}`).pipe((0,mergeMap.Z)((url=>(console.warn("URL CHANGE HISTORY",JSON.stringify(url)),url?(0,of.of)(urls.length>1?`${url}?${urls[1]}`:url):(0,throwError.$)({status:0,statusText:"URL is None"})))),(0,catchError.W)((err=>(console.warn("URL CHANGE HISTORY ERR",err,err.status),301===err.status?(0,of.of)(err.error):(0,throwError.$)((()=>`Server response ${err.status} - ${err.statusText}`))))))}static{this.ctorParameters=()=>[{type:OkraHttpService},{type:env_service._}]}};OkraUrlHistoryService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[OkraHttpService,env_service._])],OkraUrlHistoryService);const SERVER_ERROR_RESPONSE={isCategory:!1,isPost:!0,category:null,post:null,path:"",notFound:!1,serverError:!0};let OkraContentResolverService=class OkraContentResolverService{get transition$(){return this._transition$}constructor(router,location,locationStrategy,env,localeService,categoryService,tagService,postService,personService,urlHistoryService,responseResolver){this.router=router,this.location=location,this.locationStrategy=locationStrategy,this.env=env,this.localeService=localeService,this.categoryService=categoryService,this.tagService=tagService,this.postService=postService,this.personService=personService,this.urlHistoryService=urlHistoryService,this.responseResolver=responseResolver,this.contentResolved=new ReplaySubject.m(1),this._transition$=new ReplaySubject.m(1),this.requestTransitionFromRouterLink$=new Subject.B,this.caches={},this.contentResolved.pipe((0,filter.p)((res=>!this.env.isPreviewMode&&!this.env.isSSR))).subscribe((res=>{this.isUrlCached(res.path)||(this.caches[res.path]=res)}))}urlToPath(url=null){if("/"===this.router.url)return"/";return this.router.parseUrl(url||this.location.path()).toString()}isUrlCached(url){return this.caches.hasOwnProperty(this.urlToPath(url))}resolveContent(_url){const urlPath=this.urlToPath(_url);return this.env.isPreviewMode||this.env.isAdmin||!this.isUrlCached(_url)?(console.warn("resolveContent url:",_url),this.resolveContentByUrl(_url).pipe((0,tap.M)((res=>{this.contentResolved.next(res)})))):(0,of.of)(this.caches[urlPath])}get mypagePath(){return environment_settings.E.MYPAGE_PATH?environment_settings.E.MYPAGE_PATH:"mypage"}resolveContentByUrl(_url){const path="/"===this.locationStrategy.getBaseHref()?_url:_url.replace(this.locationStrategy.getBaseHref(),"/"),fragment=path.match(/#/)?path.split("#")[1].split("?")[0]:void 0,_params=path.match(/\?/)?path.split("?")[1].split("#")[0]:void 0,params=_params?(0,functions._A)(_params):void 0,urlPath="/"===decodeURIComponent(path.split("?")[0]?.split("#")[0])?"":decodeURIComponent(path.split("?")[0]?.split("#")[0]),paths=urlPath.split("/").filter((p=>""!==p)),lastPath=paths.length>0?paths[paths.length-1]:"";let redirectionRequest;return environment_settings.E.USE_GENERAL_USER&&1===paths.length&&lastPath===this.mypagePath&&(redirectionRequest={status:301,replace:!0,url:paths.concat(["account"]).join("/")}),(0,of.of)(null).pipe((0,mergeMap.Z)((()=>{if(environment_settings.E.USE_GENERAL_USER&&2==paths.length){if(paths[0]==this.mypagePath)return this.getFormContent(urlPath,paths,lastPath,params,fragment,!0)}return environment_settings.E.USE_GENERAL_USER&&(0,functions.ew)(lastPath)?this.getFormContent(urlPath,paths,lastPath,params,fragment,!1):environment_settings.E.IS_EMAIL?this.getEmailContent(urlPath,paths,lastPath,params,fragment):this.getContent(urlPath,paths,lastPath,params,fragment)})),(0,map.T)((res=>({...res,redirection:res.redirection||redirectionRequest}))))}getFormContent(urlPath,paths,lastPath,params,fragment,is_mypage){return this.postService.getFormPostBySlug(lastPath,params).pipe((0,concatMap.H)((postContainer=>{const res={isPost:!0,post:postContainer.post,isCategory:!1,category:null,path:urlPath};return res.post&&!(0,lodash.isEmpty)(res.post)&&(is_mypage?(res.post.url=urlPath,res.post._component_name="post-mypage"):(res.post.url=urlPath,res.post._component_name="post-form")),!res.post||(0,lodash.isEmpty)(res.post)?res.notFound=!0:urlPath.toLowerCase()!==(res.post?res.post.url?.toLowerCase():null)&&(res.redirection={status:301,replace:!0,url:res.post&&res.post.url?res.post.url:"",queryParams:params,fragment}),(0,of.of)(res)})),(0,catchError.W)((err=>(console.error("Error while loading form post",err),this.responseResolver.setStatus(500,"Server error E003"),(0,of.of)(SERVER_ERROR_RESPONSE)))))}lookupHistory(res){return(0,of.of)(res).pipe((0,mergeMap.Z)((res=>res.notFound?this.urlHistoryService.searchHistory(this.router.url).pipe((0,map.T)((redirectionUrl=>(this.router.url!==redirectionUrl&&(res.notFound=!1,res.redirection={status:303,replace:!1,url:redirectionUrl}),res))),(0,catchError.W)((err=>(0,of.of)(res)))):(0,of.of)(res))))}getContent(urlPath,paths,lastPath,params,fragment){if(environment_settings.E.USE_PERSON_PAGE&&paths[0]===environment_settings.E.PERSON_PAGE_PATH){const userContent=this.getPersonContent(urlPath,paths);if(userContent)return userContent}if((_paths=>{if(environment_settings.E.TAG_PATH){let __paths=_paths;if(1===__paths.length&&__paths[0]===environment_settings.E.TAG_PATH)return!0}return!1})(paths))return(0,of.of)({isCategory:!0,category:{name_menu:environment_settings.E.TAG_PATH,_component_name:"tags-category",url:urlPath},isPost:!1,post:null,path:urlPath});if((_paths=>{if(environment_settings.E.TAG_PATH){let __paths=_paths;if(2===__paths.length&&__paths[0]===environment_settings.E.TAG_PATH)return!0}return!1})(paths)){if(paths[0]===environment_settings.E.TAG_PATH){const tagContent=this.getTagContent(urlPath,paths);if(tagContent)return tagContent}}return(0,zip.y)(this.categoryService.getCategories(),this.localeService.resolveLocale()).pipe((0,concatMap.H)((([categories,localeSettings])=>{if(environment_settings.E.I18N){if(0===paths.length){const category=categories.find((c=>""===c.url));if(category)return(0,of.of)({isCategory:!0,category,isPost:!1,post:null,path:""})}else if(localeSettings.locales.some((locale=>locale.slug===paths[0]))){const categoryPaths=paths.slice(1);let category;if(category=categoryPaths.length>0?categories.find((c=>c.url===`${categoryPaths.slice(1).join("/")}`)):categories.find((c=>""===c.url)),void 0!==category)return(0,of.of)({isCategory:!0,category,isPost:!1,post:null,path:urlPath})}}else{const category=categories.find((c=>c.url===paths.join("/")));if(void 0!==category)return(0,of.of)({isCategory:!0,category,isPost:!1,post:null,path:urlPath})}let postObservable;if(environment_settings.E.USE_SLUG){const __paths=JSON.parse(JSON.stringify(paths)),localeSlug=environment_settings.E.I18N&&__paths.length>0?__paths[0]:null,localeId=localeSlug?localeSettings.locales.find((l=>l.slug===localeSlug))?.id:localeSettings.locales.find((l=>l.is_default))?.id;let _paths=[];_paths=__paths,_paths.pop();const mainCategory=categories.find((c=>environment_settings.E.I18N&&_paths.length>0?c.url===`${_paths.slice(1).join("/")}`:c.url===(0===_paths.length?"":`/${_paths.join("/")}`))),mainCategoryId=mainCategory?mainCategory.id:null;postObservable=this.postService.getPostBySlug(lastPath,mainCategoryId,localeId,params)}else postObservable=this.postService.getPostById(lastPath,params);return postObservable.pipe((0,concatMap.H)((postContainer=>{const res={isPost:!0,post:postContainer.post,isCategory:!1,category:null,path:urlPath};return!postContainer.post||(0,lodash.isEmpty)(postContainer.post)?res.notFound=!0:urlPath.toLowerCase()!==postContainer.post.url?.toLowerCase()&&(res.redirection={status:301,replace:!0,url:postContainer.post.url||"",queryParams:params,fragment}),this.lookupHistory(res)})))})),(0,catchError.W)((err=>(console.error("Error while loading post",err),this.responseResolver.setStatus(500,"Server error E002"),(0,of.of)(SERVER_ERROR_RESPONSE)))))}getEmailContent(urlPath,paths,lastPath,params,fragment){return this.categoryService.getEmailCategories().pipe((0,concatMap.H)((categories=>{let postObservable;if(environment_settings.E.USE_SLUG){const _paths=JSON.parse(JSON.stringify(paths));_paths.pop();const mainCategory=categories.find((c=>c.url===(0===_paths.length?"":`/${_paths.join("/")}`))),mainCategoryId=mainCategory?mainCategory.id:null;postObservable=mainCategoryId?this.postService.getEmailPostBySlug(lastPath,mainCategoryId,params):(0,throwError.$)((()=>new Error("main category not found.")))}else postObservable=this.postService.getEmailPostById(lastPath,params);return postObservable.pipe((0,concatMap.H)((postContainer=>{const res={isPost:!0,post:postContainer.post,isCategory:!1,category:null,path:urlPath};return!postContainer.post||(0,lodash.isEmpty)(postContainer.post)?res.notFound=!0:urlPath.toLowerCase()!==postContainer.post.url?.toLowerCase()&&(res.redirection={status:301,replace:!0,url:postContainer.post.url||"",queryParams:params,fragment}),(0,of.of)(res)})),(0,catchError.W)((err=>(0,of.of)({post:null}))))})),(0,catchError.W)((err=>(console.error("Error while loading email categories",err),this.responseResolver.setStatus(500,"Server error E003"),(0,of.of)(SERVER_ERROR_RESPONSE)))))}getPersonContent(urlPath,paths){const res={isCategory:!0,category:{name_menu:environment_settings.E.PERSON_PAGE_PATH,_component_name:"persons-category",url:urlPath},isPost:!1,post:null,path:urlPath};if(paths[paths.length-1]===environment_settings.E.PERSON_PAGE_PATH&&environment_settings.E.CATEGORY_COMPONENT_SELECTORS.includes(res.category._component_name||""))return(0,of.of)(res);if(paths[paths.length-2]===environment_settings.E.PERSON_PAGE_PATH&&environment_settings.E.CATEGORY_COMPONENT_SELECTORS.includes("person-detail-category")){const param=paths[paths.length-1];return this.personService.getPersonById(`${param}`).pipe((0,map.T)((person=>(res.category._component_name="person-detail-category",res.category.instance=person,res))),(0,catchError.W)((err=>(this.responseResolver.setStatus(500,"Server error E006."),(0,of.of)(SERVER_ERROR_RESPONSE)))))}return(0,of.of)(SERVER_ERROR_RESPONSE)}getTagContent(urlPath,paths){return this.tagService.getTag(paths[paths.length-1]).pipe((0,map.T)((tag=>(tag._component_name="tag-default",tag.url=urlPath,{isCategory:!0,category:tag,isPost:!1,post:null,path:urlPath}))),(0,catchError.W)((err=>(this.responseResolver.setStatus(500,"Server error E005."),(0,of.of)(SERVER_ERROR_RESPONSE)))))}static{this.ctorParameters=()=>[{type:fesm2022_router.Ix},{type:common.Location},{type:common.LocationStrategy},{type:env_service._},{type:OkraLocaleService},{type:OkraCategoryService},{type:OkraTagService},{type:OkraPostService},{type:OkraPersonService},{type:OkraUrlHistoryService},{type:OkraResponseResolverService}]}};OkraContentResolverService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[fesm2022_router.Ix,common.Location,common.LocationStrategy,env_service._,OkraLocaleService,OkraCategoryService,OkraTagService,OkraPostService,OkraPersonService,OkraUrlHistoryService,OkraResponseResolverService])],OkraContentResolverService);let OkraPageBuilderService=class OkraPageBuilderService{get _isSSRedContentReady(){return this.__isSSRedContentReady}set _isSSRedContentReady(value){this.__isSSRedContentReady=value,this.contentsOutletParent&&this.env.isServer&&this.contentsOutletParent.ref.markForCheck()}constructor(env){this.env=env,this.contentsOutletParent=null,this.elementsOutletParent=null,this._newElementsRendered$=new Subject.B,this._newElementsContainerRendered$=new Subject.B,this.__isSSRedContentReady=this.env.isBrowserAfterSSR,this._setFirstSSRComponent$=new ReplaySubject.m(1),this._firstSSRComponentFinished=!1,this._firstSSRElementsFinished=!1,this._setFirstSSRElementsComponent$=new ReplaySubject.m(1),this.categoryRefs=new Map,this.mainCategoryRefs=new Map,this.elementsContainerRefs=new Map}_setContentOutlet(parent){this.contentsOutletParent=parent}_setElementsOutletOnBrowserAfterSSR(parent){this.elementsOutletParent=parent}initAnimationStyles(target,event){setStyles(target,getStyles(event.animation,"latter","from"),"from")}get isSSRedContentAlive(){return this.env.isBrowserAfterSSR&&(!this._firstSSRComponentFinished||!this._firstSSRElementsFinished)}get isSSRedContainerAlive(){return this.env.isBrowserAfterSSR&&!this._firstSSRComponentFinished}get isSSRedElementsAlive(){return this.env.isBrowserAfterSSR&&!this._firstSSRElementsFinished}get containerOutletChildLength(){return this.contentsOutletParent?this.contentsOutletParent.outlet.viewContainerRef.length:0}get elementsOutletChildLength(){return this.elementsOutletParent?this.elementsOutletParent.outlet.viewContainerRef.length:0}get containerDOMCount(){return this.contentsOutletParent?this.contentsOutletParent.el.nativeElement.querySelectorAll("div[okra-client-content-container-component]").length:0}get elementsContainerDOMCount(){return this.elementsOutletParent?this.elementsOutletParent.el.nativeElement.querySelectorAll("div[okra-elements-container-component]").length:0}cleanAnimatingContainers(event){if(!event.pop)return(0,of.of)(event);const animatingElementsLength=this.elementsContainerDOMCount;if(animatingElementsLength>=2){event.transition_analysis.removedElements=animatingElementsLength;for(let i=this.elementsOutletChildLength-1;i>=0;i--)this.elementsOutletParent.outlet.viewContainerRef.remove(i);if(this.isSSRedElementsAlive)return this.cleanSSRedElements(event)}const animatingContainersLength=this.containerDOMCount;if(animatingContainersLength>=2){event.transition_analysis.removedContainers=animatingContainersLength;for(let i=this.containerOutletChildLength-1;i>=0;i--)this.contentsOutletParent.outlet.viewContainerRef.remove(i);if(this.isSSRedContainerAlive)return this.cleanSSRedContainer(event)}return(0,of.of)(event)}cleanSSRedContainer(event){return this.cleanSSRedElements(event),this._firstSSRComponentFinished=!0,this.contentsOutletParent.ref.markForCheck(),(0,of.of)(event).pipe((0,delay.c)(0))}cleanSSRedElements(event){return this._firstSSRElementsFinished=!0,this.elementsOutletParent&&this.elementsOutletParent.ref.markForCheck(),(0,of.of)(event).pipe((0,delay.c)(0))}detachPreviousContent(event){if(event.pop||!event.transition_analysis.hasAnimation&&!event.transition_analysis.hasElementsAnimation)if(event.transition_analysis.betweenSamePostTemplate&&event.transition_analysis.betweenSameCategoryTemplate){if(this.isSSRedElementsAlive)return this.cleanSSRedElements(event);event.transition_analysis.detach0=this.elementsOutletChildLength,this.elementsOutletChildLength>0&&this.elementsOutletParent.outlet.viewContainerRef.remove(0)}else{if(this.isSSRedContainerAlive)return this.cleanSSRedContainer(event);event.transition_analysis.detach1=this.containerOutletChildLength,this.containerOutletChildLength>0&&this.contentsOutletParent.outlet.viewContainerRef.remove(0)}return(0,of.of)(event)}setAnimationFormerTarget(event){return this.env.isBrowserAfterSSR&&1===event.count?event.transition_analysis.hasElementsAnimation?this._setFirstSSRElementsComponent$.pipe((0,map.T)((target=>(event.transition_analysis.former=target,event)))):this._setFirstSSRComponent$.pipe((0,map.T)((target=>(event.transition_analysis.former=target,event)))):(0,of.of)(null).pipe((0,mergeMap.Z)((()=>{if(0===event.count)return(0,of.of)(event);const formerPath=event.former_content.path;try{if(event.transition_analysis.hasElementsAnimation)return event.transition_analysis.former=this.elementsContainerRefs.get(formerPath).instance,(0,of.of)(event);if(event.transition_analysis.hasAnimation){if(event.former_content.isCategory)return event.transition_analysis.former=this.categoryRefs.get(formerPath).instance,(0,of.of)(event);{const mainCategoryUrl=event.former_content.post.main_category.url;return console.error("SSR",mainCategoryUrl,this.mainCategoryRefs),this._setFirstSSRComponent$.pipe((0,map.T)((target=>(event.transition_analysis.former=target,event))))}}return(0,of.of)(event)}catch(err){return console.error("page build error",err),(0,of.of)(event)}})))}_buildPage(_event){const hasAnimation=_event.transition_analysis.hasAnimation;_event.transition_analysis.hasElementsAnimation;return this.cleanAnimatingContainers(_event).pipe((0,mergeMap.Z)((event=>this.detachPreviousContent(event))),(0,mergeMap.Z)((event=>this.setAnimationFormerTarget(event))),(0,mergeMap.Z)((event=>{if(event.content.isCategory||!event.content.isCategory&&null==event.content.post){event.transition_analysis.attached="NC";const componentRef=this.contentsOutletParent.outlet?.viewContainerRef.createComponent(this.contentsOutletParent.outlet.componentClass,{index:this.containerOutletChildLength}),component=componentRef.instance;return component.event=event,component.ref.markForCheck(),this.categoryRefs.set(event.content.path,componentRef),component.onInit$.pipe((0,tap.M)((()=>{hasAnimation&&this.initAnimationStyles(component,event)})),(0,mergeMap.Z)((()=>component.afterViewInit$)),(0,map.T)((()=>(event.transition_analysis.container=this.contentsOutletParent,event.transition_analysis.SC=event.content.path,event.transition_analysis.latter=component,event))),(0,take.s)(1))}{let mainCategoryUrl=event.content.post.main_category?.url;return mainCategoryUrl||(mainCategoryUrl="form"),(0,of.of)(null).pipe((0,mergeMap.Z)((()=>{if(event.transition_analysis.betweenSamePostTemplate&&event.transition_analysis.betweenSameCategoryTemplate)return event.transition_analysis.attached="SC",(0,of.of)(event).pipe((0,mergeMap.Z)((()=>{if(this.isSSRedContainerAlive)return this._setFirstSSRComponent$;{const component=this.mainCategoryRefs.get(mainCategoryUrl).instance;return(0,of.of)(component)}})),(0,map.T)((component=>(component.event=event,component.ref.markForCheck(),event))));{event.transition_analysis.attached="NC";const componentRef=this.contentsOutletParent.outlet.viewContainerRef.createComponent(this.contentsOutletParent.outlet.componentClass,{index:this.containerOutletChildLength}),component=componentRef.instance;return component.event=event,component.ref.markForCheck(),this.mainCategoryRefs.set(mainCategoryUrl,componentRef),component.onInit$.pipe((0,take.s)(1),(0,tap.M)((()=>{hasAnimation&&this.initAnimationStyles(component,event)})),(0,mergeMap.Z)((()=>this._newElementsRendered$.pipe((0,take.s)(1)))),(0,map.T)((container=>(this.elementsOutletParent=container,event))))}})),(0,mergeMap.Z)((event_=>this.buildElements$(event_).pipe((0,tap.M)((e=>{e.transition_analysis.hasElementsAnimation&&this.initAnimationStyles(e.transition_analysis.latter,e)}))))))}})))}_cleanAfterAnimation(event){if(event.transition_analysis.betweenSamePostTemplate){if(this.isSSRedElementsAlive)return this.cleanSSRedElements(event);this.elementsOutletParent.outlet.viewContainerRef.remove(0)}else{if(this.isSSRedContainerAlive)return this.cleanSSRedContainer(event);this.contentsOutletParent.outlet.viewContainerRef.remove(0)}return(0,of.of)(event)}_setDOMCounts(event){return event.transition_analysis.containers=this.containerDOMCount,event.transition_analysis.elements=this.elementsContainerDOMCount,(0,of.of)(event)}buildElements$(event){event.transition_analysis.container=this.elementsOutletParent,event.transition_analysis.attached+="NE";const componentRef=this.elementsOutletParent.outlet?.viewContainerRef.createComponent(this.elementsOutletParent.outlet.componentClass,{index:this.elementsOutletChildLength}),component=componentRef.instance;return component.post=event.content.post,componentRef.changeDetectorRef.detectChanges(),component.afterViewInit$.pipe((0,take.s)(1),(0,map.T)((_=>{this.elementsContainerRefs.set(event.content.path,componentRef);const paths=event.content.path.split("/");return event.transition_analysis.SE=paths[paths.length-1],event.transition_analysis.latter=componentRef.instance,event})))}static{this.ctorParameters=()=>[{type:env_service._}]}};OkraPageBuilderService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[env_service._])],OkraPageBuilderService);var startWith=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/startWith.js"),mergeScan=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/mergeScan.js");let OkraUniversalService=class OkraUniversalService{constructor(env,state,document){this.env=env,this.state=state,this.document=document}mergeScanAndReplay(startWithItem,stateKeyName,accumulator,seed,concurrent=Number.POSITIVE_INFINITY){const lastItemSeedKey=(0,transfer_state.zw)(stateKeyName);let universalSeed=null;this.env.isBrowserAfterSSR&&(universalSeed=this.state.get(lastItemSeedKey,null)),universalSeed=universalSeed||seed;const operators=[];return this.env.isBrowserAfterSSR||operators.push((0,startWith.Z)(startWithItem)),operators.push((0,mergeScan.i)(accumulator,universalSeed,concurrent),(0,tap.M)((lastItem=>{console.log("lastItem",JSON.stringify(lastItem)),this.env.isSSR&&this.state.set(lastItemSeedKey,lastItem)}))),this.env.isBrowserAfterSSR&&operators.push((0,startWith.Z)(universalSeed)),(0,functions.TZ)(...operators)}static{this.ctorParameters=()=>[{type:env_service._},{type:transfer_state.WL},{type:Document,decorators:[{type:core.Inject,args:[common.DOCUMENT]}]}]}};function msToSec(value){return Math.round(value/100)/10}OkraUniversalService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[env_service._,transfer_state.WL,Document])],OkraUniversalService),(0,functions.RU)();let OkraRouterService=class OkraRouterService{get now(){return(new Date).getTime()}get duration(){return msToSec(this.now-this._startTime-this._durationHidden)}get totalDuration(){return msToSec(this.now-this._preservedStartTime-this._totalDurationHidden)}get events(){return this.ngRouter.events}get routing(){return this._routing}get pageBuildStart$(){return this._pageBuildStart$}get pageBuildEnd$(){return this._pageBuildEnd$}get routingResolved$(){return this._routingResolved$}get transitionDisrupt$(){return this._transitionDisrupt$.asObservable()}get ssrEvent$(){return this._ssrEvent$}get pageApisLoaded$(){return this._pageApisLoaded$.pipe((0,filter.p)((event=>(event?event.url:"")===this.ngRouterUrl||this.isFirstRouteAfterSSR)),(0,first.$)())}get pageImagesLoaded$(){return this._pageImagesLoaded$.pipe((0,filter.p)((event=>(event?event.url:"")===this.ngRouterUrl||this.isFirstRouteAfterSSR)),(0,first.$)(),(0,functions.aG)("okraRouter.pageImagesLoaded$"))}get fragment(){return this.activatedRoute.fragment.pipe((0,mergeMap.Z)((fragment=>this.env.isServer||this.env.isAdmin?empty.w:this._routing?this.routingResolved$.pipe((0,mergeMap.Z)((event=>event.changed?this.transitionFinished$.pipe((0,map.T)((event=>event?.location?.url_fragment||{}))):(0,of.of)(fragment))),(0,first.$)()):(0,of.of)(fragment))),(0,functions.aG)("okraRouter.fragment"))}get queryParamMap(){return this.activatedRoute.queryParamMap.pipe((0,mergeMap.Z)((queryParams=>this.env.isServer||this.env.isAdmin?empty.w:this._routing?this.routingResolved$.pipe((0,mergeMap.Z)((event=>event.changed?this.transitionFinished$.pipe((0,map.T)((event=>event?.location?.url_params||{}))):(0,of.of)(queryParams))),(0,first.$)()):(0,of.of)(queryParams))),(0,functions.aG)("okraRouter.queryParamMap"))}get queryParams(){return this.activatedRoute.queryParams.pipe((0,mergeMap.Z)((queryParams=>this.env.isServer||this.env.isAdmin?empty.w:this._routing?this.routingResolved$.pipe((0,mergeMap.Z)((event=>event.changed?this.transitionFinished$.pipe((0,map.T)((event=>event?.location?.url_fragment||{}))):(0,of.of)(queryParams))),(0,first.$)()):(0,of.of)(queryParams))),(0,functions.aG)("okraRouter.queryParams"))}get url(){return this.activatedRoute.url.pipe((0,mergeMap.Z)((segments=>this._routing?this.routingResolved$.pipe((0,first.$)(),(0,map.T)((_=>segments))):(0,of.of)(segments))),(0,functions.aG)("okraRouter.url"))}get currentPath(){return this.location.path(!0).replace(/\/$/,"")}get currentDirectory(){return(this.location.path(!1).split(/(\?|#)/)[0]||"").replace(/\/$/,"")}get ngRouterUrl(){return this.ngRouter.url.replace(/\/$/,"")}get firstEventAtSSR(){const lastItemSeedKey=(0,transfer_state.zw)(this.firstEventStateKeyName);return this.env.isBrowserAfterSSR||this.env.isSSR?this.state.get(lastItemSeedKey,null):null}get isSSRedContentReady(){return this.pageBuilder._isSSRedContentReady}set isSSRedContentReady(val){this.pageBuilder._isSSRedContentReady=val}get firstSSRComponentFinished(){return this.pageBuilder._firstSSRComponentFinished}get firstSSRElementsFinished(){return this.pageBuilder._firstSSRElementsFinished}get routerStateSnapshot(){return this.ngRouter.routerState.snapshot}get activatedRouteSnapshot(){return this.activatedRoute.snapshot}setDefaultRoutingAnimation(options){this.defaultRoutingAnimation=options}constructor(ngRouter,location,env,localeService,contentResolver,visibilityService,universal,apiCacheService,pageBuilder,state,responseResolver,document,window){if(this.ngRouter=ngRouter,this.location=location,this.env=env,this.localeService=localeService,this.contentResolver=contentResolver,this.visibilityService=visibilityService,this.universal=universal,this.apiCacheService=apiCacheService,this.pageBuilder=pageBuilder,this.state=state,this.responseResolver=responseResolver,this.document=document,this.window=window,this._preservedStartTime=this.now,this._startTime=this.now,this._durationHidden=0,this._totalDurationHidden=0,this._routing=!0,this._linkRoutingRequest$=new Subject.B,this._externalLinkRoutingRequest$=new Subject.B,this._pageBuildStart$=new Subject.B,this._pageBuildEnd$=new Subject.B,this._transitionDisrupt$=new Subject.B,this.animationStarted$=new Subject.B,this.animationFinished$=new Subject.B,this.popTransitionFinished$=new Subject.B,this.noAnimationTransitionFinished$=new Subject.B,this.authInitGuard$=new ReplaySubject.m(1),this.isFirstRouteAfterSSR=this.env.isBrowserAfterSSR&&this.state.stateTransferred,this._ssrEvent$=new ReplaySubject.m(1),this.firstEventStateKeyName="okra-routing-scan",this.urlSerializer=new fesm2022_router.nU,this.defaultRoutingAnimation=null,this.env.isAdmin)return;this.pageLeave$=(0,race.O)((0,fromEvent.R)(this.window,"beforeunload"),(0,fromEvent.R)(this.window,"unload")).pipe((0,map.T)((_=>({url:this.currentPath,path:this.urlToPath(),changed:!0,former_location:this.urlToLocation(this.document.location.pathname),request_method:TransitionMethod.LEAVE,time:this.duration,total_time:this.totalDuration})))),this.transitionDisrupt$.subscribe((_=>{(0,functions.nG)("okraRouter.transitionDisrupt$",_)})),this.popstateRequest$=(0,fromEvent.R)(this.window,"popstate").pipe((0,map.T)((()=>({url:this.currentPath+this.window.location.hash,path:this.urlToPath(this.currentPath+this.window.location.hash),pop:!0,extras:{fragment:this.window.location.hash.replace("#","")}}))),(0,share.u)()),this._ngRouterNavigateRequest$=this.ngRouter.events.pipe((0,filter.p)((event=>!this._routing&&event instanceof fesm2022_router.Z&&"popstate"!==event.navigationTrigger)),(0,map.T)((event=>({url:event.url.replace(/\/$/,""),path:this.urlToPath(event.url),pop:!1}))),(0,share.u)()),this.firstRoutingEvent={url:this.currentPath,path:this.urlToPath(),changed:!0,location:this.urlToLocation(this.document.location.pathname),request_method:TransitionMethod.VISIT,time:this.duration,total_time:this.totalDuration,count:0},this.routingRequest$=(0,merge.h)(this._ngRouterNavigateRequest$.pipe((0,functions.aG)(">>>>>>>>>>\nokraRouter._ngRouterNavigateRequest$")),this._linkRoutingRequest$.pipe((0,functions.aG)(">>>>>>>>>>\nokraRouter._linkRoutingRequest$")),this._externalLinkRoutingRequest$.pipe((0,functions.aG)(">>>>>>>>>>\nokraRouter._externalLinkRoutingRequest$")),this.popstateRequest$.pipe((0,functions.aG)(">>>>>>>>>>\nokraRouter.popstateRequest$")));const _routingResolved$=this.routingRequest$.pipe((0,mergeMap.Z)((event=>(console.log("routingRequest$",JSON.stringify(event)),this._routing=!0,this.authInitGuard$.pipe((0,tap.M)((_=>{console.log("authInitGuard$",JSON.stringify(event))})),(0,take.s)(1),(0,map.T)((_=>(console.log("authInitGuard$ 2",JSON.stringify(event)),event))))))),this.universal.mergeScanAndReplay(this.firstRoutingEvent,this.firstEventStateKeyName,((prev,event)=>(0,of.of)(null).pipe((0,mergeMap.Z)((()=>{const externalLink=[TransitionMethod.TAB,TransitionMethod.TAB_INTERNAL,TransitionMethod.LEAVE,TransitionMethod.OTHER].includes(event.request_method),changed=!prev||prev.path!==event.path&&!externalLink;if(event={...event,count:prev?prev.count+1:0,changed,location:this.urlToLocation(event.url),former_location:prev?prev.location:null,former_content:prev?prev.content:null,created:msToSec(Date.now()),time:this.duration,total_time:this.totalDuration,time_stayed:this.duration},this._startTime=this.now,this._durationHidden=0,!externalLink){event.cached=this.contentResolver.isUrlCached(event.url),event.request_method||(event.request_method=function getRequestMethod(prev,event){const fragmentChanged=prev&&prev.location?prev.location.url_fragment!==event.location.url_fragment:!!event.location.url_fragment,queryChanged=prev&&prev.location?!(0,lodash.isEqual)(prev.location.url_params,event.location.url_params):!!event.location.url_params;return!event.changed&&queryChanged?TransitionMethod.QUERY:!event.changed&&fragmentChanged?TransitionMethod.ANCHOR:TransitionMethod.INTERNAL}(prev,event)),this.defaultRoutingAnimation&&!event.animation&&(event.animation=this.defaultRoutingAnimation),event.animation&&event.animation.duration&&!event.animation.func&&(event.animation.func=(0,asyncToGenerator.A)((function*(){yield(0,functions.of)(event.animation?.duration||0)})));event.count;!event.pop&&(event.count&&event.count>0&&this.env.isBrowser||this.env.isSSR)&&this.ngRouter.navigateByUrl(event.url,event.extras)}return this.processRedirect(event).pipe((0,mergeMap.Z)((redirectedEvent=>{if(console.log("processRedirect",JSON.stringify(redirectedEvent)),!externalLink&&["/oauth-callback","/oidc-callback","/activate",`/${environment_settings.E.MYPAGE_PATH}`].some((_authUrl=>event.path?.endsWith(_authUrl))))return(0,of.of)({...redirectedEvent,content:{isCategory:!1,isPost:!1,category:null,post:null}});if(console.log("changed",changed),!changed){const queryOrFragEvent={...redirectedEvent,content:prev.content};return Object.assign(queryOrFragEvent.location||{},{locale_id:queryOrFragEvent.former_location?.locale_id,main_category_id:queryOrFragEvent.former_location?.main_category_id,category_id:queryOrFragEvent.former_location?.category_id,category_ids:queryOrFragEvent.former_location?.category_ids,post_id:queryOrFragEvent.former_location?.post_id}),console.log("changed 2",JSON.stringify(queryOrFragEvent)),(0,of.of)(queryOrFragEvent)}return(0,of.of)(redirectedEvent).pipe(this.loadContent(),this.processContentException())})))})),this.analyzeTransition())),null),(0,mergeMap.Z)((event=>(console.log("resolving routing",JSON.stringify(event)),this.env.isBrowserAfterSSR&&0===event.count?(Object.assign(event.location||{},this.urlToLocation(this.currentPath)),this.authInitGuard$.pipe((0,tap.M)((_=>{console.log("authInitGuard$ 3",JSON.stringify(event))})),(0,take.s)(1),(0,map.T)((_=>event)))):(0,of.of)(event)))));let _timeHidden;this._routingResolved$=_routingResolved$.pipe((0,tap.M)((_=>console.log("_routingResolved",_.url))),(0,share.u)()),this.routingResolvedReplay$=this._routingResolved$.pipe((0,tap.M)((_=>console.log("routingResolvedReplay",_.url))),(0,shareReplay.t)(1)),this.routingResolvedReplay$.subscribe((event=>{(0,functions.nG)("okraRouter.routingResolvedReplay$",event.url)})),this.routingResolved$.subscribe((event=>{event.pop&&this._transitionDisrupt$.next(event),this.env.isSSR&&(this.isSSRedContentReady=!0),this._routing=!1})),this.routingResolved$.subscribe((event=>{(0,functions.nG)("okraRouter.routingResolved$",event)})),this.routingResolved$.pipe((0,filter.p)((_=>this.env.isBrowserAfterSSR)),(0,skip.i)(1),(0,take.s)(1),(0,tap.M)((_=>this.isFirstRouteAfterSSR=!0))).subscribe(),this.transition$=this.routingResolved$.pipe((0,skip.i)(this.env.isSSR?1:0),(0,filter.p)((event=>event.changed)),(0,delay.c)(0),(0,mergeMap.Z)((event=>this.env.isBrowserAfterSSR&&0===event.count?(0,of.of)(event):(this._pageBuildStart$.next(event),this.pageBuilder._buildPage(event).pipe((0,takeUntil.Q)(this.transitionDisrupt$),(0,tap.M)((event_=>{this._pageBuildEnd$.next(event_)})))))),(0,mergeMap.Z)((event=>this.env.isBrowserAfterSSR&&0===event.count?(0,of.of)(event):event.transition_analysis&&(event.transition_analysis.hasElementsAnimation||event.transition_analysis.hasAnimation)?function performAnimate(_event,_window,disrupt$){console.log("~~~~",_event.transition_analysis);const container=_event.transition_analysis.container,former=_event.transition_analysis.former,latter=_event.transition_analysis.latter;return(0,of.of)(_event).pipe((0,tap.M)((event=>{former||console.error("former"),former.renderer.addClass(former.el.nativeElement,"okra-clean-animation-from");const containerFrom=getStyles(event.animation,"container","from");containerFrom&&setContainerStyles(container,containerFrom);const formerFrom=getStyles(event.animation,"former","from");formerFrom&&setStyles(former,formerFrom,"from")})),(0,delay.c)(0),(0,tap.M)((event=>{former.renderer.addClass(former.el.nativeElement,"okra-clean-animation-to");const containerTo=getStyles(event.animation,"container","to");containerTo&&setContainerStyles(container,containerTo);const formerTo=getStyles(event.animation,"former","to");formerTo&&setStyles(former,formerTo,"to");const latterTo=getStyles(event.animation,"latter","to");latterTo&&setStyles(latter,latterTo,"to")})),(0,concatMap.H)((event=>(0,from.H)(event.animation.func(container.el,former.el,latter.el,container.renderer,_window)).pipe((0,map.T)((_=>event))))),(0,takeUntil.Q)(disrupt$.pipe((0,tap.M)((_=>{const containerAfter=getStyles(_event.animation,"container","after");containerAfter&&setContainerStyles(container,containerAfter);const containerDisrupt=getStyles(_event.animation,"container","disrupt");containerDisrupt&&setContainerStyles(container,containerDisrupt);const formerAfter=getStyles(_event.animation,"former","after");formerAfter&&setStyles(former,formerAfter,"after");const formerDisrupt=getStyles(_event.animation,"former","disrupt");formerDisrupt&&setStyles(former,formerDisrupt,"disrupt");const latterAfter=getStyles(_event.animation,"latter","after");latterAfter&&setStyles(latter,latterAfter,"after");const latterDisrupt=getStyles(_event.animation,"latter","disrupt");latterDisrupt&&setStyles(latter,latterDisrupt,"disrupt")})))),(0,tap.M)((event=>{former.renderer.addClass(former.el.nativeElement,"okra-clean-animation-after"),latter.renderer.addClass(latter.el.nativeElement,"okra-show-animation-after");const containerAfter=getStyles(event.animation,"container","after");containerAfter&&setContainerStyles(container,containerAfter);const formerAfter=getStyles(event.animation,"former","after");formerAfter&&setStyles(former,formerAfter,"after");const formerDisrupt=getStyles(event.animation,"former","disrupt");formerDisrupt&&setStyles(former,formerDisrupt,"disrupt");const latterAfter=getStyles(event.animation,"latter","after");latterAfter&&setStyles(latter,latterAfter,"after")})))}(event,this.window,this.transitionDisrupt$).pipe((0,takeUntil.Q)(this.transitionDisrupt$),(0,mergeMap.Z)((()=>this.pageBuilder._cleanAfterAnimation(event)))):(0,of.of)(event))),(0,mergeMap.Z)((event=>this.pageBuilder._setDOMCounts(event))),(0,share.u)()),this.transition$.subscribe((event=>{event.pop?this.popTransitionFinished$.next(event):event.transition_analysis?.hasAnimation||event.transition_analysis?.hasElementsAnimation?(event.animation&&(event.animation.finished=!0),this.animationFinished$.next(event)):this.noAnimationTransitionFinished$.next(event),(0,functions.nG)("okraRouter.transition$",event)})),environment_settings.E.SHOW_HOOKS&&this.transition$.pipe((0,scan.S)(((arr,item)=>[...arr,item]),[])).subscribe((events=>{console.table(events.map((event=>({from:event.former_location?event.former_location.url:"",url:event.url,pop:Number(event.pop)||0,post:Number(event.content?.isPost),category:Number(event.content?.isCategory),template:event.content?.isCategory?event.content?.category?._component_name:event.content?.post?._component_name,ani:event.transition_analysis?.hasAnimation?1:event.transition_analysis?.hasElementsAnimation?2:0,rmC:event.transition_analysis?.removedContainers||0,rmE:event.transition_analysis?.removedElements||0,d0:event.transition_analysis?.detach0||0,d1:event.transition_analysis?.detach1||0,d2:event.transition_analysis?.detach2||0,d3:event.transition_analysis?.detach3||0,A:event.transition_analysis?.attached||"",SC:event.transition_analysis?.SC||"",SE:event.transition_analysis?.SE||"",C:event.transition_analysis?.containers||0,E:event.transition_analysis?.elements||0}))))})),this.transitionFinished$=(0,merge.h)(this.animationFinished$,this.popTransitionFinished$,this.noAnimationTransitionFinished$).pipe((0,share.u)()),this.transitionFinished$.subscribe((event=>{(0,functions.nG)("okraRouter.transitionFinished$",event?.url),(0,functions.nG)("---------------------------"),this._routing=!1,["/oauth-callback","/oidc-callback","/activate",`/${environment_settings.E.MYPAGE_PATH}`].some((_authUrl=>(event?.path||"").endsWith(_authUrl)))&&this.navigate(["/"],{replaceUrl:!0})})),this.visibilityService.hidden.pipe((0,tap.M)((t=>_timeHidden=t)),(0,switchMap.n)((_=>this.visibilityService.shown))).subscribe((t=>{this._durationHidden=t-_timeHidden,this._totalDurationHidden+=this._durationHidden})),console.log("okraRouter, isSSR:",this.env.isSSR,this.env.isServer),this.env.isSSR?(console.log("okraRouter.pageApisLoaded$ SSR",this.ngRouterUrl),this._pageApisLoaded$=this.routingResolved$.pipe((0,delay.c)(50),(0,mergeMap.Z)((event=>(console.log("okraRouter.pageApisLoaded$ SSR mergeMap",this.ngRouterUrl,event.url,this.apiCacheService.requestedApiCount),0===this.apiCacheService.requestedApiCount?(0,of.of)(event):this.apiCacheService.pageApiChainEnded.pipe((0,map.T)((()=>event)))))))):this._pageApisLoaded$=this.pageBuildEnd$.pipe((0,delay.c)(0),(0,mergeMap.Z)((event=>this.apiCacheService.requestedApiCount<=0?(0,of.of)(event):this.apiCacheService.pageApiChainEnded.pipe((0,map.T)((_=>event)),(0,first.$)()))),(0,shareReplay.t)(1)),this._pageApisLoaded$.subscribe((_=>{console.log("okraRouter.pageApisLoaded$",_.url)})),this._pageImagesLoaded$=this._pageBuildEnd$.pipe((0,switchMap.n)((event=>{if(this.env.isServer)return(0,of.of)(event).pipe((0,takeUntil.Q)(this.transitionDisrupt$));const el=event.transition_analysis?.latter?.el.nativeElement,$images=el.querySelectorAll("img");if(0===$images.length)return(0,of.of)(event).pipe((0,takeUntil.Q)(this.transitionDisrupt$));const observables=Array.prototype.map.call($images,(element=>{const loaded$=new Promise((resolve=>{const image=new Image;image.src=element.src,image.onload=()=>resolve(),image.onerror=err=>{resolve()}}));return(0,from.H)(loaded$)}));return(0,zip.y)(...observables).pipe((0,map.T)((_=>event)),(0,takeUntil.Q)(this.transitionDisrupt$))})),(0,shareReplay.t)(1)),this._pageImagesLoaded$.subscribe((_=>{(0,functions.nG)("okraRouter.pageImagesLoaded$")}))}processRedirect(event){if([TransitionMethod.TAB,TransitionMethod.TAB_INTERNAL,TransitionMethod.LEAVE,TransitionMethod.OTHER].includes(event.request_method||""))return(0,of.of)(event);return this.ngRouter.events.pipe((0,filter.p)((e=>e instanceof fesm2022_router.wF)),(0,map.T)((e=>(e.url=e.url.replace(/\/$/,""),e))),(0,shareReplay.t)(1)).pipe((0,take.s)(1),(0,map.T)((event_=>(event.url!==event_.url&&(event.url=event_.url,event.path=this.urlToPath(event_.url)),event))))}_setFirstSSRComponent(component){this.pageBuilder._setFirstSSRComponent$.next(component)}_setFirstSSRElementsComponent(component){this.pageBuilder._setFirstSSRElementsComponent$.next(component)}_setContentOutlet(component){this.pageBuilder._setContentOutlet(component)}_sendNewElementsRendered(component){this.pageBuilder._newElementsRendered$.next(component),this.pageBuilder._setElementsOutletOnBrowserAfterSSR(component)}_sendNewElementsContainerRendered(component){this.pageBuilder._newElementsContainerRendered$.next(component)}initActivatedRoute(activatedRoute){this.activatedRoute=activatedRoute,environment_settings.E.SHOW_HOOKS&&(this.ngRouter.events.subscribe((event=>{(0,functions.nG)(`ngRouter ${event}`)})),this.activatedRoute.url.subscribe((segments=>{(0,functions.nG)("activatedRoute.url",segments)})),this.activatedRoute.queryParamMap.subscribe((q=>{(0,functions.nG)("activatedRoute.queryParamMap",q)})),this.activatedRoute.queryParams.subscribe((q=>{(0,functions.nG)("activatedRoute.queryParams",q)})),this.activatedRoute.fragment.subscribe((q=>{(0,functions.nG)("activatedRoute.fragment",q)})),this.activatedRoute.paramMap.subscribe((q=>{(0,functions.nG)("activatedRoute.paramMap",q)})),this.activatedRoute.params.subscribe((q=>{(0,functions.nG)("activatedRoute.params",q)})),this.activatedRoute.data.subscribe((q=>{(0,functions.nG)("activatedRoute.data",q)})))}_navigateFromRouterLink(commands,extras={skipLocationChange:!1}){const updatedExtras=Array.isArray(commands)?extras:((extras_,event_)=>{const serializedUrl=this.urlSerializer.parse(event_.url),params=serializedUrl.queryParams,fragment=serializedUrl.fragment;let _extras_=extras_;return params&&(_extras_=(0,lodash.merge)(_extras_,{queryParams:params})),fragment&&(_extras_=(0,lodash.merge)(_extras_,{fragment})),_extras_})(extras,commands),urlTree=this.ngRouter.createUrlTree(Array.isArray(commands)?commands:(url=>{const rootChildrenPrimary=this.urlSerializer.parse(url).root.children.primary;if(rootChildrenPrimary){const paths=rootChildrenPrimary.segments.map((seg=>seg.path));if(paths.length>0)return paths}return["/"]})(commands.url),updatedExtras);if(this.ngRouter.url===urlTree.toString())return void console.warn("Requested the same URL",this.ngRouter.url,urlTree.toString());let event;if(Array.isArray(commands)){const urlFromTree=this.ngRouter.createUrlTree(commands,extras).toString();event={navigate:!0,url:urlFromTree,path:this.urlToPath(urlFromTree),extras:updatedExtras}}else event={navigate:!0,path:this.urlToPath(commands.url),...commands,extras:updatedExtras};this._routing?console.warn("Could not proceed with navigation request. Currently routing."):this._linkRoutingRequest$.next(event)}navigate(commands,extras={skipLocationChange:!1}){let event;this._transitionDisrupt$.next(),this._routing=!1,Array.isArray(commands)||(event=commands,hasRoutingAnimation(event)&&(console.warn("You cannot implement transition animation through OkraRouter.navigate(). Use OkraClientLink directive instead.",event),event.animation=void 0)),this._navigateFromRouterLink(commands,extras)}navigateExternally(method,url,params={}){params&&(url+="?",Object.keys(params).map((key=>`${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)).join("&")),this._externalLinkRoutingRequest$.next({request_method:method,url})}urlToPath(_url=void 0){let url=_url||this.currentPath,urlSplitted=url.split("?");urlSplitted=urlSplitted[0]?urlSplitted[0]:"",urlSplitted=urlSplitted.split("#"),url=urlSplitted[0]?urlSplitted[0]:"";const tree=(0,lodash.cloneDeep)(this.ngRouter.parseUrl(url||this.currentPath));return tree.fragment=null,tree.queryParams={},"/"===url||""===url?"":tree.toString()}urlToLocation(url){const urlString=(0,lodash.isString)(url)?url:url.toString(),tree=(0,lodash.isString)(url)?this.ngRouter.parseUrl(url):url;return{raw_url:urlString,url:tree.toString(),url_params:tree.queryParams,url_fragment:tree.fragment||void 0,url_params_hash:(0,lodash.isEmpty)(tree.queryParams)?"":object_hash(tree.queryParams)}}loadContent(){return(0,functions.TZ)((0,mergeMap.Z)((event=>{const paths=event.url.split("/");return(0,zip.y)(this.contentResolver.resolveContent(event.url),this.localeService.resolveLocale(paths.length>0?paths[0]:void 0)).pipe((0,mergeMap.Z)((([res,localeSettings])=>{(0,functions.nG)("ContentResolved",res);const _event={...event,location:{...event.location,locale_id:res.post?res.post?.locale_id:localeSettings.currentLocale.id,category_id:res.category?res.category.id:null,post_id:res.post?res.post?.id:null,main_category_id:res.post?res.post?.main_category_id:null,category_ids:res.post?res.post?.category_ids:null},content:res};return(0,of.of)(_event)})))})))}processContentException(){return(0,functions.TZ)((0,tap.M)((event=>{if(event.content?.notFound)this.responseResolver.setNotFound(`${event.url} was not found`);else if(event.content?.redirection){const redirection=event.content.redirection;redirection.replace?this.responseResolver.replaceUrl(redirection.status,redirection.url,redirection.queryParams?redirection.queryParams:null,redirection.fragment?redirection.fragment:void 0):this.responseResolver.redirect(redirection.status,redirection.url)}})))}analyzeTransition(){return(0,functions.TZ)((0,map.T)((event=>{if(null==event.content?.post&&!event.content?.isCategory)return event.transition_analysis={hasAnimation:!1,hasElementsAnimation:!1,formerTemplate:void 0,newTemplate:void 0,betweenSameCategoryTemplate:!1,betweenSamePostTemplate:!1},event;const newTemplate=event.content.isCategory?event.content.category?._component_name:event.content.post?._component_name;if(!event.former_content)return event.transition_analysis={hasAnimation:!1,hasElementsAnimation:!1,formerTemplate:void 0,newTemplate,betweenSameCategoryTemplate:!1,betweenSamePostTemplate:!1},event;const formerTemplate=event.former_content.isCategory?event.former_content.category?._component_name:event.former_content.post?._component_name,hasAnimation=hasRoutingAnimation(event),betweenSameCategoryTemplate=event.former_content.isCategory&&event.content.isCategory&&formerTemplate===newTemplate,betweenSamePostTemplate=event.former_content.isPost&&event.content.isPost&&formerTemplate===newTemplate;return event.transition_analysis={hasAnimation,hasElementsAnimation:hasAnimation&&betweenSamePostTemplate,formerTemplate,newTemplate,betweenSameCategoryTemplate,betweenSamePostTemplate},event})))}static{this.ctorParameters=()=>[{type:fesm2022_router.Ix},{type:common.Location},{type:env_service._},{type:OkraLocaleService},{type:OkraContentResolverService},{type:OkraVisibilityService},{type:OkraUniversalService},{type:OkraApiCacheService},{type:OkraPageBuilderService},{type:transfer_state.WL},{type:OkraResponseResolverService},{type:Document,decorators:[{type:core.Inject,args:[common.DOCUMENT]}]},{type:Window,decorators:[{type:core.Inject,args:[window_service.jf]}]}]}};OkraRouterService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[fesm2022_router.Ix,common.Location,env_service._,OkraLocaleService,OkraContentResolverService,OkraVisibilityService,OkraUniversalService,OkraApiCacheService,OkraPageBuilderService,transfer_state.WL,OkraResponseResolverService,Document,Window])],OkraRouterService);let OkraBreadcrumbsDirective=class OkraBreadcrumbsDirective{constructor(env,breadcrumbsService,okraRouter){this.env=env,this.breadcrumbsService=breadcrumbsService,this.okraRouter=okraRouter,this.items$=new ReplaySubject.m(1),this.loaded=!1,this.unsubscriber$=new Subject.B}ngOnInit(){this.setBreadcrumbs()}setBreadcrumbs(){(0,of.of)(null).pipe((0,mergeMap.Z)((()=>this.env.isAdmin?this.post?this.breadcrumbsService.loadPostBreadcrumbs(this.post):this.category?this.samplePost?void 0:this.breadcrumbsService.loadCategoryBreadcrumbs(this.category):(0,of.of)([{title:"Possible",is_current_item:!1,url:"#",content:null},{title:"Path to cateogries",is_current_item:!1,url:"#",content:null},{title:"Title of post",is_current_item:!0,url:"#",content:null}]):this.post?this.breadcrumbsService.loadPostBreadcrumbs(this.post):this.category?this.breadcrumbsService.loadCategoryBreadcrumbs(this.category):this.okraRouter.routingResolved$.pipe((0,mergeMap.Z)((res=>res.content.isCategory?this.breadcrumbsService.loadCategoryBreadcrumbs(res.content.category):res.content.isPost?this.breadcrumbsService.loadPostBreadcrumbs(res.content.post):void 0))))),(0,takeUntil.Q)(this.unsubscriber$)).subscribe(this.items$)}ngOnDestroy(){this.unsubscriber$.next(),this.unsubscriber$.complete()}static{this.ctorParameters=()=>[{type:env_service._},{type:OkraBreadcrumbsService},{type:OkraRouterService}]}static{this.propDecorators={post:[{type:core.Input}],category:[{type:core.Input}],samplePost:[{type:core.Input}]}}};OkraBreadcrumbsDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraBreadcrumbs]",exportAs:"okraBreadcrumbs"}),(0,tslib_es6.Sn)("design:paramtypes",[env_service._,OkraBreadcrumbsService,OkraRouterService])],OkraBreadcrumbsDirective);var interval=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/interval.js"),animationFrame=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/scheduler/animationFrame.js");let OkraCarouselDirective=class OkraCarouselDirective{get slideWidth(){return this.$slides.length<1?null:parseFloat(this.window.getComputedStyle(this.$slides[0]).width)*this.slidesToShift}get wrapperWidth(){let width=0;return Array.prototype.forEach.call(this.$slides,(element=>{width+=this.getSlideWidthWithMargin(element)})),width}constructor(document,el,zone,renderer,cd,env,window){this.document=document,this.el=el,this.zone=zone,this.renderer=renderer,this.cd=cd,this.env=env,this.window=window,this.draggable="admin"!==environment_settings.E.MODULE,this.manualInit=!1,this.infinite=!1,this.initialSlide=0,this.speed=300,this.slidesPerView=1,this.slidesToShift=1,this.effect="slide",this.freemode=!1,this.containerClass="okra-carousel-container",this.wrapperClass="okra-carousel-wrapper",this.slideClass="okra-carousel-slide",this.slideInnerClass="okra-carousel-slide-inner",this.captionClass="okra-carousel-caption",this.initComplete=new core.EventEmitter,this.transitionStart=new core.EventEmitter,this.transitionEnd=new core.EventEmitter,this.touchStart=new core.EventEmitter,this.touchEnd=new core.EventEmitter,this.transitionStart$=new Subject.B,this.transitionEnd$=new Subject.B,this.touchMove$=new Subject.B,this.duplicateContainer=[],this.slideItems=[],this.paginationItems=[],this.isInitialized=!1,this.hasChange=!1,this.timers=[],this.DUPLICATE_NUMBER=5,this.SWIPE_PLAY_VAL=5}ngOnInit(){this.data&&!this.items&&(this.items=this.data.items),this.duplicateSlideToLoop=!("slide"!==this.effect||!this.infinite),this.duplicateContainer=this.duplicateSlideToLoop?new Array(this.DUPLICATE_NUMBER):new Array(1),this._items=this.getItems(),this.slideItems=this.getSlideItems(),this.currentIndex$=this.transitionEnd$.pipe((0,map.T)((i=>{for(;i<0;)i+=this.originalSlideLength;return i%this.originalSlideLength})),(0,startWith.Z)(0),(0,shareReplay.t)(1))}ngDoCheck(){this.env.isAdmin&&!this.el.nativeElement.hasAttribute("okraadmincarouselelement")&&this.items&&this.items.length!==this.itemLength&&this.isInitialized&&(this.itemLength=this.items.length,this.changeItems())}ngOnChanges(changes){if(this.env.isAdmin)this.isInitialized&&(changes.infinite&&changes.infinite.previousValue!==changes.infinite.currentValue||changes.effect&&changes.effect.previousValue!==changes.effect.currentValue||changes.infinite&&changes.infinite.previousValue!==changes.infinite.currentValue||changes.slidesPerView&&changes.slidesPerView.previousValue!==changes.slidesPerView.currentValue||changes.slidesToShift&&changes.slidesToShift.previousValue!==changes.slidesToShift.currentValue||changes.effect&&changes.effect.previousValue!==changes.effect.currentValue)&&(this.duplicateSlideToLoop=!("slide"!==this.effect||!this.infinite),this.duplicateContainer=this.duplicateSlideToLoop?new Array(this.DUPLICATE_NUMBER):new Array(1),this.changeItems());else{if(changes.data&&changes.data.firstChange||changes.items&&changes.items.firstChange||changes.data&&(0,lodash.isEqual)(changes.data.previousValue,changes.data.currentValue)||changes.items&&(0,lodash.isEqual)(changes.items.previousValue,changes.items.currentValue))return;if(this.duplicateSlideToLoop=!("slide"!==this.effect||!this.infinite),this.duplicateContainer=this.duplicateSlideToLoop?new Array(this.DUPLICATE_NUMBER):new Array(1),this._items=this.getItems(),this.slideItems=this.getSlideItems(),this.manualInit)return;this.destroy();let timer=setTimeout((()=>{timer=null,this.init()}),0);this.timers.push(timer)}}ngAfterViewInit(){if(!this.manualInit)try{setTimeout((()=>{this.initialize()}),0)}catch(error){console.error("error",error)}}ngOnDestroy(){this.subscription&&!this.subscription.closed&&this.subscription.unsubscribe(),this.timers.forEach((timer=>{timer&&clearTimeout(timer)}))}init(){this._items=this.getItems(),this.slideItems=this.getSlideItems(),this.cd.detectChanges();let timer=setTimeout((()=>{timer=null;try{this.initialize()}catch(error){console.error("error",error)}}),0);this.timers.push(timer)}destroy(){if(this.isInitialized){this.isInitialized=!1,this.items&&(this.itemLength=this.items.length),this.subscription.unsubscribe();let timer=setTimeout((()=>{timer=null,this.privateDestroy()}),0);this.timers.push(timer)}}slideNext(){this.changedByNavigation(!0)}slidePrev(){this.changedByNavigation(!1)}slideTo(nextIndex,speed=this.speed){this.slideMove(nextIndex+this.leftEndIndex,speed)}getItems(){let items=[];if(this.duplicateSlideToLoop&&this.items)if(this.items.length%this.slidesPerView==0||1===this.slidesToShift)items=this.items;else{const dummyItems=this.items.slice(0,this.slidesPerView-this.items.length%this.slidesPerView);items=[...this.items,...dummyItems]}else this.items&&(items=this.items);return items}getSlideItems(){let items=[];if(this.duplicateSlideToLoop&&this.items)for(let i=0;i<this.DUPLICATE_NUMBER;i++)items.push(...this.getItems());else this.items&&(items=this.items);return items}initialize(){this.$container=this.el.nativeElement.querySelector(`.${this.containerClass}`),this.$wrapper=this.el.nativeElement.querySelector(`.${this.wrapperClass}`),this.$slides=this.$container.querySelectorAll(`.${this.slideClass}`),this.$nextBtn=this.el.nativeElement.querySelector(`.${this.nextButtonClass}`)||null,this.$prevBtn=this.el.nativeElement.querySelector(`.${this.prevButtonClass}`)||null,this.slideLength=this.$slides.length,this.originalSlideLength=this.items?Math.ceil(this._items.length/this.slidesToShift):0,this.leftEndIndex=this.duplicateSlideToLoop?this.originalSlideLength*Math.floor(this.DUPLICATE_NUMBER/2):0,this.rightEndIndex=this.duplicateSlideToLoop?this.leftEndIndex+this.originalSlideLength:this.originalSlideLength,this.currentPos=this.leftEndIndex+this.initialSlide,this.isEnabled=1<this.originalSlideLength&&(this.$container.offsetWidth<this.wrapperWidth||"fade"===this.effect),this.subscription&&!this.subscription.closed&&this.subscription.unsubscribe(),this.subscription=new Subscription.yU,this.groupPerView=Math.floor(this.slidesPerView/this.slidesToShift);const _paginationItems=this.duplicateSlideToLoop?this._items:this._items.slice(0,this._items.length-(this.groupPerView-1)),paginationItemsLength=Math.ceil(_paginationItems.length/this.slidesToShift);this.paginationItems=[];for(let i=0;i<paginationItemsLength;i++){const startCount=i*this.slidesToShift,item=_paginationItems.slice(startCount,startCount+this.slidesToShift);this.paginationItems.push(item)}this.paginationClass&&this.items&&this.cd.detectChanges(),this.$paginations=this.el.nativeElement.querySelectorAll(`.${this.paginationClass}-item`)||null,this.eventListen(),this.updatePagination(),this.updateNavigation(),this.initComplete.emit();let timer=setTimeout((()=>{timer=null,this.updateSlideStyle(this.currentPos),this.isInitialized=!0,this.zone.runOutsideAngular((()=>{this.touchMove$.observers.length>0&&this.speed>0&&this.subscription.add((0,interval.Y)(10,animationFrame.X).pipe((0,filter.p)((()=>!this.isTouchStart&&this.isDuringTransition))).subscribe((()=>{const leftX=this.getCurrentLeftX();this.touchMove$.next({pos:this.getPosFromLeftX(leftX),posX:leftX})}))),this.env.isAdmin&&(this.clientRect=this.el.nativeElement.getBoundingClientRect())}))}),0);this.timers.push(timer)}changeItems(callback=null,_index=-1){this.subscription&&!this.subscription.closed&&this.subscription.unsubscribe(),this.subscription=new Subscription.yU;let index=_index>=0?_index:this.currentPos-this.leftEndIndex;(this.currentPos<this.leftEndIndex||this.rightEndIndex-1<this.currentPos)&&(index=this.currentPos%this.originalSlideLength),(isNaN(index)||index>this.originalSlideLength-1)&&(index=0);const zoneOnStable$=new Subject.B;this.slideItems=this.getSlideItems(),this._items=this.getItems(),this.cd.detectChanges();let timer1=setTimeout((()=>{timer1=null,zoneOnStable$.next()}),0);this.timers.push(timer1),this.subscription.add((0,merge.h)(zoneOnStable$,this.zone.onStable.asObservable()).pipe((0,take.s)(1)).subscribe((()=>{clearTimeout(timer1),this.$slides=this.$container.querySelectorAll(`.${this.slideClass}`),this.$nextBtn=this.el.nativeElement.querySelector(`.${this.nextButtonClass}`)||null,this.$prevBtn=this.el.nativeElement.querySelector(`.${this.prevButtonClass}`)||null,this.slideLength=this.duplicateContainer.length*this.items.length,this.originalSlideLength=this.items?Math.ceil(this._items.length/this.slidesToShift):0,this.leftEndIndex=this.duplicateSlideToLoop?this.originalSlideLength*Math.floor(this.DUPLICATE_NUMBER/2):0,this.rightEndIndex=this.duplicateSlideToLoop?this.leftEndIndex+this.originalSlideLength:this.originalSlideLength,this.currentPos=this.leftEndIndex+index,this.isEnabled=1<this.originalSlideLength&&(this.$container.offsetWidth<this.wrapperWidth||"fade"===this.effect),this.groupPerView=Math.floor(this.slidesPerView/this.slidesToShift);const _paginationItems=this.duplicateSlideToLoop?this._items:this._items.slice(0,this._items.length-(this.groupPerView-1)),paginationItemsLength=Math.ceil(_paginationItems.length/this.slidesToShift);this.paginationItems=[];for(let i=0;i<paginationItemsLength;i++){const startCount=i*this.slidesToShift,item=_paginationItems.slice(startCount,startCount+this.slidesToShift);this.paginationItems.push(item)}this.paginationClass&&this.items&&this.cd.detectChanges(),this.$paginations=this.el.nativeElement.querySelectorAll(`.${this.paginationClass}-item`)||null,this.eventListen(),this.updatePagination(),this.updateNavigation();let timer2=setTimeout((()=>{timer2=null,zoneOnStable$.next()}),0);this.timers.push(timer2),this.subscription.add((0,merge.h)(zoneOnStable$,this.zone.onStable.asObservable()).pipe((0,take.s)(1)).subscribe((()=>{clearTimeout(timer2),zoneOnStable$.complete(),this.updateSlideStyle(this.currentPos),this.cd.detectChanges(),this.zone.runOutsideAngular((()=>{this.touchMove$.observers.length>0&&this.speed>0&&this.subscription.add((0,interval.Y)(10,animationFrame.X).pipe((0,filter.p)((()=>!this.isTouchStart&&this.isDuringTransition))).subscribe((()=>{const leftX=this.getCurrentLeftX();this.touchMove$.next({pos:this.getPosFromLeftX(leftX),posX:leftX})}))),this.env.isAdmin&&(this.clientRect=this.el.nativeElement.getBoundingClientRect())})),callback&&callback()})))})))}privateDestroy(){this.duplicateSlideToLoop&&(this.slideItems=this.items||[]),this.renderer.removeAttribute(this.$wrapper,"style")}eventListen(){this.zone.runOutsideAngular((()=>{this.$container&&(this.subscription.add(this.listenAsObservable(this.$container,"mousedown").subscribe((event=>{this.isEnabled&&this.draggable&&this.onSwipeStart(event)}))),this.subscription.add(this.listenAsObservable(this.$container,"touchstart").subscribe((event=>{this.isEnabled&&this.onSwipeStart(event)})))),this.subscription.add(this.listenAsObservable("window","mousemove").pipe((0,filter.p)((res=>this.isTouchStart))).subscribe((event=>{this.onSwipeMove(event)}))),this.subscription.add(this.listenAsObservable("window","touchmove").pipe((0,filter.p)((res=>this.isTouchStart))).subscribe((event=>{this.onSwipeMove(event)}))),this.subscription.add(this.listenAsObservable("window","mouseup").pipe((0,filter.p)((res=>this.isTouchStart))).subscribe((event=>{this.onSwipeEnd(event)}))),this.subscription.add(this.listenAsObservable("window","touchend").pipe((0,filter.p)((res=>this.isTouchStart))).subscribe((event=>{this.onSwipeEnd(event)}))),this.subscription.add(this.listenAsObservable("window","resize").subscribe((event=>{this.updateSlideStyle(this.currentPos),this.env.isAdmin&&(this.clientRect=this.el.nativeElement.getBoundingClientRect())}))),this.$wrapper&&this.subscription.add(this.listenAsObservable(this.$wrapper,"transitionend").subscribe((event=>{this.isTouchStart||(this.currentPosX=this.getCurrentLeftX(),this.isDuringTransition=!1,this.transitionEnd.emit(),this.transitionEnd$.next(this.currentPos-this.leftEndIndex),this.cd.detectChanges())}))),this.$nextBtn&&this.subscription.add(this.listenAsObservable(this.$nextBtn,"click").subscribe((event=>{event.stopPropagation(),event.preventDefault(),this.changedByNavigation(!0)}))),this.$prevBtn&&this.subscription.add(this.listenAsObservable(this.$prevBtn,"click").subscribe((event=>{event.stopPropagation(),event.preventDefault(),this.changedByNavigation(!1)}))),this.$paginations&&Array.prototype.forEach.call(this.$paginations,(element=>this.subscription.add(this.listenAsObservable(element,"click").subscribe((event=>{const targetIndex=[].slice.call(this.$paginations).indexOf(event.currentTarget)+this.leftEndIndex;event.stopPropagation(),event.preventDefault(),this.slideMove(targetIndex)})))))}))}onSwipeStart(event){this.touchStartTime=(new Date).getTime(),this.hasChangedTouches=!!event.changedTouches&&event.changedTouches.length>0,this.isTouchStart=!0,this.touchMoveVal=0,this.hasChangedTouches||event.preventDefault(),this.touchStart.emit(),this.startPosX=this.hasChangedTouches?event.changedTouches[0].pageX:event.pageX,this.startPosY=this.hasChangedTouches?event.changedTouches[0].pageY:event.pageY,this.isTouchMoveEnable=!1,this.isWindowScroll=!1,"slide"!==this.effect||this.freemode||this.updateSlideStyle(this.currentPos),this.currentPosX=this.getCurrentLeftX()}onSwipeMove(event){if(this.isWindowScroll)return;const movePosX=this.hasChangedTouches?event.changedTouches[0].pageX:event.pageX,movePosY=this.hasChangedTouches?event.changedTouches[0].pageY:event.pageY,moveDiffX=this.startPosX-movePosX,moveDiffY=this.startPosY-movePosY;if(!(Math.abs(moveDiffX)<3))if(this.renderer.setStyle(this.$wrapper,"pointer-events","none"),this.isTouchMoveEnable){this.touchMoveVal=movePosX-this.startPosX;let posFromLeftX=this.getPosFromLeftX(this.currentPosX-moveDiffX);"slide"===this.effect&&(this.freemode&&this.infinite&&(posFromLeftX<this.leftEndIndex?posFromLeftX+=this.originalSlideLength:this.rightEndIndex-1<posFromLeftX&&(posFromLeftX-=this.originalSlideLength)),this.freemode&&!this.infinite&&(this.freemodePosFromLeftX=posFromLeftX),this.updateSlideStyle(posFromLeftX),this.touchMove$.next({pos:posFromLeftX,posX:this.getLeftXFromPos(posFromLeftX)}),this.freemode&&(this.currentPos=this.touchMoveVal<0?this.getNextPos(!0):this.getNextPos(!1),this.updatePagination(),this.updateNavigation(),this.syncCarousel&&(this.syncCarousel.currentPos=this.currentPos,this.syncCarousel.updatePagination(),this.syncCarousel.updateNavigation())))}else this.getAngle(moveDiffY,moveDiffX)<45?(this.isTouchMoveEnable=!0,this.restoreSlidePos()):this.isWindowScroll=!0}onSwipeEnd(event){if(this.isTouchStart=!1,this.renderer.removeStyle(this.$wrapper,"pointer-events"),this.touchEnd.emit(),this.freemode)return!this.infinite&&this.freemodePosFromLeftX&&(this.freemodePosFromLeftX<this.leftEndIndex||this.rightEndIndex-1<this.freemodePosFromLeftX)&&(this.touchMoveVal<0?this.slideMove(this.getNextPos(!0)):0<this.touchMoveVal&&this.slideMove(this.getNextPos(!1))),void(this.freemodePosFromLeftX=null);this.touchMoveVal<0?this.slideMove(this.getNextPos(!0)):0<this.touchMoveVal?this.slideMove(this.getNextPos(!1)):!this.freemode&&Math.abs(this.touchMoveVal)>this.SWIPE_PLAY_VAL&&this.slideMove(this.getNearestIndex(this.getCurrentLeftX()))}getNextPos(isToRight){const timeDiff=(new Date).getTime()-this.touchStartTime;let nextPos;if(100*Math.abs(this.touchMoveVal/timeDiff)/timeDiff<.3||this.slideWidth<Math.abs(this.touchMoveVal))nextPos="fade"===this.effect?this.currentPos:this.getNearestIndex(this.getCurrentLeftX()),this.duplicateSlideToLoop&&this.slideLength-this.groupPerView<nextPos&&(nextPos=this.slideLength-this.groupPerView);else{nextPos=isToRight?this.currentPos+1:this.currentPos-1;const _nextPos=Math.ceil(this.slideLength/this.slidesToShift)-this.groupPerView;nextPos<0?nextPos="fade"===this.effect&&this.infinite?_nextPos:0:_nextPos<nextPos&&(nextPos="fade"===this.effect&&this.infinite?0:_nextPos)}return nextPos}changedByNavigation(isToRight){this.currentPos<this.leftEndIndex?(this.currentPos=this.rightEndIndex-(this.leftEndIndex-this.currentPos),this.updateSlideStyle(this.currentPos)):this.rightEndIndex-1<this.currentPos&&(this.currentPos=this.leftEndIndex+(this.currentPos-this.rightEndIndex),this.updateSlideStyle(this.currentPos));let nextPos=isToRight?this.currentPos+1:this.currentPos-1;this.infinite?this.infinite&&"fade"===this.effect&&(nextPos<this.leftEndIndex?nextPos=this.rightEndIndex-this.groupPerView:this.rightEndIndex-this.groupPerView<nextPos&&(nextPos=this.leftEndIndex)):nextPos<this.leftEndIndex?nextPos=this.leftEndIndex:this.rightEndIndex-this.groupPerView<nextPos&&(nextPos=this.rightEndIndex-this.groupPerView),this.slideMove(nextPos)}slideMove(nextPos,speed=this.speed){this.updateSlideStyle(nextPos,speed),this.currentPos=nextPos,this.isDuringTransition=!0,this.updatePagination(),this.updateNavigation(),this.transitionStart.emit(),this.transitionStart$.next(this.currentPos-this.leftEndIndex),this.syncCarousel&&(this.syncCarousel.currentPos=nextPos,this.syncCarousel.updatePagination(),this.syncCarousel.updateNavigation()),this.cd.detectChanges()}updateSlideStyle(nextPos,duration=0){if(this.$wrapper){if(this._items.length!==(this.items||[]).length&&Array.prototype.forEach.call(this.$slides,((element,index)=>{index%this._items.length>this.items.length-1&&(this.renderer.addClass(element,"is-dummy"),this.renderer.setStyle(element,"visibility","hidden"),this.renderer.setAttribute(element,"aria-hidden","true"))})),"slide"===this.effect){const targetX=this.getLeftXFromPos(nextPos);if(this.renderer.setStyle(this.$wrapper,"transform",`translate3d(${targetX}px, 0, 0)`),this.renderer.setStyle(this.$wrapper,"transition-duration",`${duration}ms`),this.syncCarousel){const speed=this.syncCarousel.wrapperWidth/this.wrapperWidth;this.renderer.setStyle(this.syncCarousel.$wrapper,"transform",`translate3d(${targetX*speed}px, 0, 0)`),this.renderer.setStyle(this.syncCarousel.$wrapper,"transition-duration",`${duration}ms`)}}else Array.prototype.forEach.call(this.$slides,((element,index)=>{this.renderer.setStyle(element,"transform",`translate3d(-${this.slideWidth*index}px, 0, 0)`),this.renderer.setStyle(element,"transition-property","opacity"),this.renderer.setStyle(element,"transition-duration",`${duration}ms`),this.renderer.setStyle(element,"opacity",nextPos===index?1:0),this.renderer.setStyle(element,"z-index",nextPos===index?1:0)}));this.updateNavigationStyle(this.isEnabled),this.cd.detectChanges()}}updateNavigationStyle(isEnabled){isEnabled?(this.$nextBtn&&this.renderer.removeStyle(this.$nextBtn,"display"),this.$prevBtn&&this.renderer.removeStyle(this.$prevBtn,"display"),Array.prototype.forEach.call(this.$paginations,(pagination=>{this.renderer.removeStyle(pagination,"display")}))):(this.$nextBtn&&this.renderer.setStyle(this.$nextBtn,"display","none"),this.$prevBtn&&this.renderer.setStyle(this.$prevBtn,"display","none"),Array.prototype.forEach.call(this.$paginations,(pagination=>{this.renderer.setStyle(pagination,"display","none")})))}getCurrentLeftX(){if(!this.$wrapper)return null;const transformStyle=this.window.getComputedStyle(this.$wrapper).transform,xPosIndex=transformStyle.match(/^matrix3d\(.+\)$/)?12:4;return parseInt(transformStyle.split(",")[xPosIndex],10)||0}getNearestIndex(pos){const diff=[],leadNumbers=[];let slidesGroup=[],slides=[];const _slides=[].map.call(this.$slides,(el=>el));let index=0;if(Array.prototype.forEach.call(this.paginationItems,((item,i)=>{const findIndex=(0,lodash.flatten)(this.paginationItems).findIndex((_item=>(0,lodash.isEqual)(_item,item[0])));leadNumbers.push(findIndex)})),this.duplicateSlideToLoop)for(let i=0;i<this.DUPLICATE_NUMBER;i++){const startCount=i*this._items.length,item=_slides.slice(startCount,startCount+this._items.length);slidesGroup.push(item)}else slidesGroup=[_slides];return slidesGroup.forEach((elements=>{slides=[...slides,...elements.filter(((el,i)=>leadNumbers.find((number=>number===i))>=0))]})),Array.prototype.forEach.call(slides,((slide,i)=>{diff[i]=Math.abs(slide.offsetLeft+pos),index=diff[index]<diff[i]?index:i})),index}getLeftXFromPos(pos){return this.$slides.length<1?null:this.$slides[pos*this.slidesToShift]?-this.$slides[pos*this.slidesToShift].offsetLeft:pos*this.slideWidth*-1}getPosFromLeftX(leftX){return leftX/this.slideWidth*-1}updatePagination(){let index=this.currentPos-this.leftEndIndex;(this.currentPos<this.leftEndIndex||this.rightEndIndex-1<this.currentPos)&&(index=this.currentPos%this.originalSlideLength),Array.prototype.forEach.call(this.$paginations,(pagination=>{pagination.classList.remove("is-current")})),this.$paginations[index]&&this.$paginations[index].classList.add("is-current")}updateNavigation(){this.$nextBtn&&this.$prevBtn&&(this.$nextBtn.classList.remove("is-disabled"),this.$prevBtn.classList.remove("is-disabled"),this.infinite||(this.currentPos===this.leftEndIndex?this.$prevBtn.classList.add("is-disabled"):this.rightEndIndex-this.groupPerView===this.currentPos&&this.$nextBtn.classList.add("is-disabled")))}listenAsObservable(target,eventName){return new Observable.c((observer=>this.renderer.listen(target,eventName,(event=>observer.next(event)))))}getAngle(diffY,diffX){let rad,angle;return rad=Math.atan2(Math.abs(diffY),Math.abs(diffX)),angle=180*rad/Math.PI,angle}getSlideWidthWithMargin(slide){return parseInt(this.window.getComputedStyle(slide).width,10)+(parseInt(this.window.getComputedStyle(slide).marginLeft,10)+parseInt(this.window.getComputedStyle(slide).marginRight,10))}restoreSlidePos(){const diff=this.getLeftXFromPos(this.currentPos)-this.getCurrentLeftX();this.duplicateSlideToLoop&&this.currentPos<this.leftEndIndex?(this.currentPos=this.rightEndIndex-(this.leftEndIndex-this.currentPos),this.updateSlideStyle(this.getPosFromLeftX(this.getLeftXFromPos(this.currentPos)-diff)),this.currentPosX=this.getCurrentLeftX()):this.duplicateSlideToLoop&&this.rightEndIndex-1<this.currentPos&&(this.currentPos=this.leftEndIndex+(this.currentPos-this.rightEndIndex),this.updateSlideStyle(this.getPosFromLeftX(this.getLeftXFromPos(this.currentPos)-diff)),this.currentPosX=this.getCurrentLeftX())}countArrayItems(data){let count=0;const ARRAY_COUNT=item=>{if(Array.isArray(item))item.forEach((i=>{count+=1,ARRAY_COUNT(i)}));else for(const prop in item)null===item[prop]||item[prop]instanceof Function||!(item[prop]instanceof Object||"object"==typeof item[prop])||ARRAY_COUNT(item[prop])};return(data||[]).forEach((item=>{count+=1,ARRAY_COUNT(item)})),count}static{this.ctorParameters=()=>[{type:void 0,decorators:[{type:core.Inject,args:[common.DOCUMENT]}]},{type:core.ElementRef},{type:core.NgZone},{type:core.Renderer2},{type:core.ChangeDetectorRef},{type:env_service._},{type:void 0,decorators:[{type:core.Inject,args:[window_service.jf]}]}]}static{this.propDecorators={data:[{type:core.Input}],items:[{type:core.Input}],draggable:[{type:core.Input}],manualInit:[{type:core.Input}],infinite:[{type:core.Input}],initialSlide:[{type:core.Input}],speed:[{type:core.Input}],slidesPerView:[{type:core.Input}],slidesToShift:[{type:core.Input}],effect:[{type:core.Input}],freemode:[{type:core.Input}],containerClass:[{type:core.Input}],wrapperClass:[{type:core.Input}],slideClass:[{type:core.Input}],slideInnerClass:[{type:core.Input}],captionClass:[{type:core.Input}],nextButtonClass:[{type:core.Input}],prevButtonClass:[{type:core.Input}],paginationClass:[{type:core.Input}],syncCarousel:[{type:core.Input}],initComplete:[{type:core.Output}],transitionStart:[{type:core.Output}],transitionEnd:[{type:core.Output}],touchStart:[{type:core.Output}],touchEnd:[{type:core.Output}]}}};OkraCarouselDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraCarousel]",exportAs:"okraCarousel"}),(0,tslib_es6.Sn)("design:paramtypes",[Object,core.ElementRef,core.NgZone,core.Renderer2,core.ChangeDetectorRef,env_service._,Object])],OkraCarouselDirective);let OkraUserService=class OkraUserService{set isAdult(is_adult){if(!this.env.isServer&&!this.env.isAdmin){localStorage.setItem("is_adult",is_adult);const get_time=(new Date).getTime(),set_time=String(get_time);localStorage.setItem("set_time",set_time)}}get isAdult(){if(this.env.isServer||this.env.isAdmin)return null;{const objTime=JSON.parse(localStorage.getItem("set_time")),setTime=Number(objTime);if(!(((new Date).getTime()-setTime)/1e3>86400))return localStorage.getItem("is_adult");localStorage.removeItem("is_adult"),localStorage.removeItem("set_time")}}constructor(http,env,formatterService,apiCache,localeService){this.http=http,this.env=env,this.formatterService=formatterService,this.apiCache=apiCache,this.localeService=localeService}getCmsUserById(id){return this.localeService.resolveRequest_().pipe((0,switchMap.n)((([request,localeSettings])=>this.apiCache.get(`cms_users/${id}`,request,(cmsUser=>cmsUser=this.formatterService.formatCmsUser(cmsUser,new Map(localeSettings.locales.map((locale=>[locale.id,locale]))),!1))))))}getPagedCmsUsers(_request){return this.localeService.resolveRequest_().pipe((0,switchMap.n)((([request,localeSettings])=>(_request&&(request=(0,lodash.merge)(request,_request)),this.apiCache.get("cms_users",request,(result=>(result.results.map((item=>this.formatterService.formatCmsUser(item,new Map(localeSettings.locales.map((locale=>[locale.id,locale]))),!1))),result)))))))}static{this.ctorParameters=()=>[{type:OkraHttpService},{type:env_service._},{type:OkraFormatterService},{type:OkraApiCacheService},{type:OkraLocaleService}]}};OkraUserService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[OkraHttpService,env_service._,OkraFormatterService,OkraApiCacheService,OkraLocaleService])],OkraUserService);var distinctUntilChanged=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js");let OkraCmsUsersLoaderDirective=class OkraCmsUsersLoaderDirective{get totalPages(){return this._totalPages}set totalPages(value){this._totalPages=value}get loading(){return this._loading}set loading(value){this._loading=value}constructor(cd,userService){this.cd=cd,this.userService=userService,this._totalPages=1,this._loading=!1,this.page=1,this.unit=10,this.requestSubject=new Subject.B,this.unsubscriber$=new Subject.B,this.cmsUsers=[],this.requestSubject.pipe((0,distinctUntilChanged.F)(((pre,curr)=>(0,lodash.isEqual)(pre,curr))),(0,switchMap.n)((req=>(this.loading=!0,this.userService.getPagedCmsUsers(req)))),(0,takeUntil.Q)(this.unsubscriber$)).subscribe((results=>{this.totalPages=results.paginationStatus?.pages||0,this.cmsUsers=results.results,this.loading=!1,this.cd.markForCheck()}))}ngOnInit(){this.loadPage(this.page)}loadPage(page){if(this.loading||page<1||page>this.totalPages)return;this.page=page;const request={params:{}};this.params&&(request.params=this.params),null!==this.page&&(request.page=this.page),null!==this.unit&&(request.unit=this.unit),this.requestSubject.next(request)}loadPrevPage(){1!==this.page&&this.loadPage(this.page-1)}loadNextPage(){this.page!==this.totalPages&&this.loadPage(this.page+1)}ngOnDestroy(){this.unsubscriber$.next()}static{this.ctorParameters=()=>[{type:core.ChangeDetectorRef},{type:OkraUserService}]}static{this.propDecorators={params:[{type:core.Input}],page:[{type:core.Input}],unit:[{type:core.Input}]}}};OkraCmsUsersLoaderDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraCmsUsersLoader]",exportAs:"okraCmsUsersLoader"}),(0,tslib_es6.Sn)("design:paramtypes",[core.ChangeDetectorRef,OkraUserService])],OkraCmsUsersLoaderDirective);let OkraElasticSearchService=class OkraElasticSearchService{constructor(apiCache,formatterService,localeService,categoryService){this.apiCache=apiCache,this.formatterService=formatterService,this.localeService=localeService,this.categoryService=categoryService}getPostsBySearchWord(locale,searchword,size,page,offset,scale,decay,order,sortAlgorithm,fuzziness,scope,categories,scoreBoostValues,exclusionCategories){let fetchedCategories,allCategories;return this.categoryService.getCategories().pipe((0,map.T)((_allCategories=>{fetchedCategories=_allCategories,allCategories=new Map(_allCategories.map((c=>[c.id,c])));const callback=(acc,cur)=>{const id=("number"==typeof cur?allCategories.get(cur):"string"==typeof cur?Array.from(allCategories.values()).find((c=>cur===c.name_id)):allCategories.get(cur.id))?.id;return id?acc.concat(id):acc};return{categoryIds:(categories||[]).reduce(callback,[]),exclusionCategoryIds:(exclusionCategories||[]).reduce(callback,[])}})),(0,switchMap.n)((({categoryIds,exclusionCategoryIds})=>(console.warn("elastic search service, cat, ex cat",categoryIds,exclusionCategoryIds),this.apiCache.get(`search/${encodeURIComponent(locale)}`,{q:searchword,size:size||null,page:page||null,offset:offset||null,scale:scale||null,decay:decay||null,order:order||null,algorithm:sortAlgorithm||null,fuzziness:fuzziness||null,scope:scope||null,category_ids:categoryIds?categoryIds.map((id=>id)):null,timestamp:"local"===environment_settings.E.ENV?Date.now():null,score_boost_values:scoreBoostValues?JSON.stringify(scoreBoostValues):null,exclusion_category_ids:exclusionCategoryIds},null)))),(0,catchError.W)((err=>(0,throwError.$)([`Server response ${err.status} - ${err.statusText}`]))),(0,map.T)((esResponses=>{const categoryIds=esResponses.docs.filter((doc=>!doc.is_post)).map((doc=>doc.id)),posts=esResponses.docs.filter((doc=>doc.is_post)).map((doc=>doc.source)),findCategories=fetchedCategories.filter((category=>category.id in categoryIds));return{hits:esResponses.hits,posts:0!==posts.length?posts.map((item=>this.formatterService.formatPost(item,allCategories))):[],categories:findCategories}})))}getSuggestWordBySearchWord(searchword,locale,size){return this.apiCache.get(`/search/suggest/${encodeURIComponent(locale)}`,{q:searchword,size:size||null,timestamp:"local"===environment_settings.E.TARGET_ENV?Date.now():null},null).pipe((0,catchError.W)((err=>(0,throwError.$)([`Server response ${err.status} - ${err.statusText}`]))))}static{this.ctorParameters=()=>[{type:OkraApiCacheService},{type:OkraFormatterService},{type:OkraLocaleService},{type:OkraCategoryService}]}};OkraElasticSearchService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[OkraApiCacheService,OkraFormatterService,OkraLocaleService,OkraCategoryService])],OkraElasticSearchService);var BehaviorSubject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/BehaviorSubject.js"),debounce=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/debounce.js");let OkraElasticSearchDirective=class OkraElasticSearchDirective{get searchedTerm$(){return this._searchedTerm$.asObservable()}get loading(){return this.loading$.getValue()}constructor(activatedRoute,okraRouter,okraLocaleService,okraElasticSearchService,cd){this.activatedRoute=activatedRoute,this.okraRouter=okraRouter,this.okraLocaleService=okraLocaleService,this.okraElasticSearchService=okraElasticSearchService,this.cd=cd,this.maxSuggestCount=10,this.maxSearchCount=30,this.sortOrder="desc",this.sortAlgorithm="mixed",this.scope="post",this.fuzziness=0,this.includeCategories=null,this.exclusionCategories=null,this.scoreBoostValues={_additional_search_field:10,additional_search_field:9,_title:8,title:7,_subtitle:6,subtitle:5,_description:4,description:3,_elements_text:2,elements_text:1},this._searchedTerm$=new ReplaySubject.m(1),this.loading$=new BehaviorSubject.t(!1),this.suggest$=new ReplaySubject.m(1),this.posts$=new ReplaySubject.m(1),this.searchResultCount$=new ReplaySubject.m(1),this.paginationStatus$=new ReplaySubject.m(1),this.unsubscriber$=new Subject.B,this.inputKey$=new Subject.B,this.locale="",this.locale=this.okraLocaleService.userLocale.slug}onEnter(event){const input=event.target,lastWord=JSON.parse(JSON.stringify(input.value)).split(" ").slice(-1)[0];this.inputKey$.next(lastWord)}ngOnInit(){this.activatedRoute.queryParams.pipe((0,filter.p)((params=>params.q)),(0,tap.M)((params=>{this.loading$.next(!0),this._searchedTerm$.next(params.q),this.cd.detectChanges()})),(0,mergeMap.Z)((params=>this.okraElasticSearchService.getPostsBySearchWord(this.locale,params.q,this.maxSearchCount,params.page,this.decreasingOffsetTerm,this.decreasingScaleTerm,this.decreasingDecayRate,this.sortOrder,this.sortAlgorithm,this.fuzziness,this.scope,this.includeCategories,this.scoreBoostValues,this.exclusionCategories).pipe((0,catchError.W)((err=>(0,throwError.$)([`Server response ${err.status} - ${err.statusText}`]))),(0,map.T)((res=>({params,res})))))),(0,takeUntil.Q)(this.unsubscriber$)).subscribe((({params,res})=>{this.posts$.next(res.posts),this.searchResultCount$.next(res.hits),this.paginationStatus$.next({page:params.page?Number(params.page):1,unit:this.maxSearchCount,pages:Math.ceil(res.hits/this.maxSearchCount),count:res.hits}),this.loading$.next(!1)}),(_=>{this.posts$.next([]),this.searchResultCount$.next(0),this.paginationStatus$.next(null),this.loading$.next(!1),console.error(_)})),this.inputKey$.pipe((0,filter.p)((searchWord=>""!==searchWord)),(0,debounce.s)((()=>(0,interval.Y)(200))),(0,switchMap.n)((searchWord=>this.okraElasticSearchService.getSuggestWordBySearchWord(searchWord,this.locale,this.maxSuggestCount).pipe((0,catchError.W)((err=>never.t))))),(0,takeUntil.Q)(this.unsubscriber$)).subscribe((res=>{const suggestWords=res.map((doc=>doc.word));this.suggest$.next(suggestWords)}),(_=>{console.error(_),this.suggest$.next([])}))}ngOnDestroy(){this.unsubscriber$.next(),this.unsubscriber$.complete()}static{this.ctorParameters=()=>[{type:fesm2022_router.nX},{type:OkraRouterService},{type:OkraLocaleService},{type:OkraElasticSearchService},{type:core.ChangeDetectorRef}]}static{this.propDecorators={input:[{type:core.ViewChild,args:["input",{static:!0}]}],maxSuggestCount:[{type:core.Input}],maxSearchCount:[{type:core.Input}],decreasingOffsetTerm:[{type:core.Input}],decreasingScaleTerm:[{type:core.Input}],decreasingDecayRate:[{type:core.Input}],sortOrder:[{type:core.Input}],sortAlgorithm:[{type:core.Input}],scope:[{type:core.Input}],fuzziness:[{type:core.Input}],includeCategories:[{type:core.Input}],exclusionCategories:[{type:core.Input}],scoreBoostValues:[{type:core.Input}],onEnter:[{type:core.HostListener,args:["input",["$event"]]}]}}};OkraElasticSearchDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraElasticSearch]",exportAs:"okraElasticSearch"}),(0,tslib_es6.Sn)("design:paramtypes",[fesm2022_router.nX,OkraRouterService,OkraLocaleService,OkraElasticSearchService,core.ChangeDetectorRef])],OkraElasticSearchDirective);let OkraElementEraserDirective=class OkraElementEraserDirective{constructor(zone,env){this.zone=zone,this.env=env,this.erase=!1,this.unsubscriber$=new Subject.B,this.isAdmin="admin"===environment_settings.E.MODULE}ngOnInit(){if(!this.env.isServer&&!this.isAdmin){const elementKindArray=this.post.elementsGroups.reduce(((acc,val)=>acc.concat(val)),[]).map((element=>element.kind+"-element")),addElementKindArray=this.otherElements.map((elementName=>elementName+"-element")),elementKindTotalArray=elementKindArray.concat(addElementKindArray),elementKinds=elementKindTotalArray.filter(((value,index)=>index===elementKindTotalArray.indexOf(value)));this.zone.onStable.asObservable().pipe((0,takeUntil.Q)(this.unsubscriber$)).subscribe((()=>{const elementArray=[];elementKinds.forEach((elementKind=>{const elements=Array.from(document.querySelectorAll("."+elementKind));elementArray.push(elements)}));elementArray.reduce(((acc,val)=>acc.concat(val)),[]).forEach((element=>{this.erase?-1!==element.className.indexOf(this.excludeElement+"-element")?element.style.display="none":element.style.display="":-1==element.className.indexOf(this.excludeElement+"-element")&&(element.style.display="none")}))}))}}ngOnDestroy(){this.unsubscriber$.next(),this.unsubscriber$.complete()}static{this.ctorParameters=()=>[{type:core.NgZone},{type:env_service._}]}static{this.propDecorators={post:[{type:core.Input}],excludeElement:[{type:core.Input}],erase:[{type:core.Input}],otherElements:[{type:core.Input}]}}};OkraElementEraserDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraElementEraser]",exportAs:"okraElementEraser"}),(0,tslib_es6.Sn)("design:paramtypes",[core.NgZone,env_service._])],OkraElementEraserDirective);let OkraFormPostLoaderDirective=class OkraFormPostLoaderDirective{constructor(cd,postService,categoryService){this.cd=cd,this.postService=postService,this.categoryService=categoryService,this.slug=null,this.params={},this.isBlock=!1,this.isLoaded=!1,this.unsubscriber$=new Subject.B}ngOnInit(){this.post?(this.slug&&(this.postContainer=this.postService.getFormPostBySlug(this.slug,this.params).pipe((0,takeUntil.Q)(this.unsubscriber$))),this.isLoaded=!1,this.postContainer.pipe((0,takeUntil.Q)(this.unsubscriber$)).subscribe((res=>{this.isLoaded=!0,this.cd.markForCheck()}))):this.resolveRequest()}ngOnChanges(changes){let hasFirstChange=!0;for(const key in changes)if(changes.hasOwnProperty(key)&&!changes[key].firstChange){hasFirstChange=!1;break}hasFirstChange||this.resolveRequest()}ngOnDestroy(){this.unsubscriber$.next(),this.unsubscriber$.complete()}resolveRequest(){this.postContainer=this.categoryService.getCategories().pipe((0,mergeMap.Z)((_categories=>{if(this.slug)return this.postService.getFormPostBySlug(this.slug,this.params);console.warn("Please specify slug.")}))),this.isLoaded=!1,this.postContainer.pipe((0,takeUntil.Q)(this.unsubscriber$)).subscribe((()=>{this.isLoaded=!0}))}static{this.ctorParameters=()=>[{type:core.ChangeDetectorRef},{type:OkraPostService},{type:OkraCategoryService}]}static{this.propDecorators={slug:[{type:core.Input}],params:[{type:core.Input}],post:[{type:core.Input}],isBlock:[{type:core.Input}]}}};OkraFormPostLoaderDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[formPostLoader]",exportAs:"formPostLoader"}),(0,tslib_es6.Sn)("design:paramtypes",[core.ChangeDetectorRef,OkraPostService,OkraCategoryService])],OkraFormPostLoaderDirective);let OkraFragmentDirective=class OkraFragmentDirective{constructor(el,renderer){this.el=el,this.renderer=renderer}ngOnInit(){this.data&&this.data.fragment&&this.renderer.setAttribute(this.el.nativeElement,"id",this.data.fragment)}static{this.ctorParameters=()=>[{type:core.ElementRef},{type:core.Renderer2}]}static{this.propDecorators={data:[{type:core.Input}]}}};OkraFragmentDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraFragment]",exportAs:"okraFragment"}),(0,tslib_es6.Sn)("design:paramtypes",[core.ElementRef,core.Renderer2])],OkraFragmentDirective);var InputKind;__webpack_require__("./node_modules/moment/moment.js");Error;!function(InputKind){InputKind[InputKind.Input=0]="Input",InputKind[InputKind.TextArea=1]="TextArea",InputKind[InputKind.Select=2]="Select"}(InputKind||(InputKind={}));var LayoutType,LayoutPart;!function(LayoutType){LayoutType[LayoutType.Single=1]="Single",LayoutType[LayoutType.Double=2]="Double",LayoutType[LayoutType.Triple=3]="Triple"}(LayoutType||(LayoutType={})),function(LayoutPart){LayoutPart[LayoutPart.Header=1]="Header",LayoutPart[LayoutPart.Contents=2]="Contents",LayoutPart[LayoutPart.Sidebar=3]="Sidebar",LayoutPart[LayoutPart.Footer=4]="Footer",LayoutPart[LayoutPart.ChildPostHeader=5]="ChildPostHeader",LayoutPart[LayoutPart.ChildPostSidebar=6]="ChildPostSidebar",LayoutPart[LayoutPart.ChildPostFooter=7]="ChildPostFooter"}(LayoutPart||(LayoutPart={}));var PostScheduleKind;!function(PostScheduleKind){PostScheduleKind[PostScheduleKind.NONE=0]="NONE",PostScheduleKind[PostScheduleKind.PUBLISH=1]="PUBLISH",PostScheduleKind[PostScheduleKind.UPDATE=2]="UPDATE",PostScheduleKind[PostScheduleKind.EXPIRY=3]="EXPIRY",PostScheduleKind[PostScheduleKind.UPDATE_DRAFT=4]="UPDATE_DRAFT",PostScheduleKind[PostScheduleKind.EXPIRY_DRAFT=5]="EXPIRY_DRAFT"}(PostScheduleKind||(PostScheduleKind={}));window.sendMessage=function(message){const e=new MessageEvent("message",{data:message,origin:location.protocol+"//"+location.host});window.dispatchEvent(e)};const adminApiUrl=endpoint=>(0,functions.uJ)((0,functions.y0)("/",window),environment_settings.E.ADMIN_API_PATH,endpoint);let OkraTransitionOutletDirective=class OkraTransitionOutletDirective{constructor(viewContainerRef){this.viewContainerRef=viewContainerRef,this.targetContainer="app"}static{this.ctorParameters=()=>[{type:core.ViewContainerRef}]}static{this.propDecorators={componentClass:[{type:core.Input}],targetContainer:[{type:core.Input}]}}};var OkraRouterModule_1;OkraTransitionOutletDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"ng-container[okraTransitionOutlet]",exportAs:"okraTransitionOutlet"}),(0,tslib_es6.Sn)("design:paramtypes",[core.ViewContainerRef])],OkraTransitionOutletDirective);let OkraRouterModule=OkraRouterModule_1=class OkraRouterModule{static forRoot(){return{ngModule:OkraRouterModule_1,providers:[OkraRouterService]}}};OkraRouterModule=OkraRouterModule_1=(0,tslib_es6.Cg)([(0,core.NgModule)({declarations:[OkraTransitionOutletDirective],exports:[OkraTransitionOutletDirective],providers:[OkraRouterService]})],OkraRouterModule);var bufferTime=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/bufferTime.js");let OkraAccessLogService=class OkraAccessLogService{constructor(http,env,okraRouter,cookie,activatedRoute,window,document){this.http=http,this.env=env,this.okraRouter=okraRouter,this.cookie=cookie,this.activatedRoute=activatedRoute,this.window=window,this.document=document,this._TIME_TO_BUFFER=this.env.isLocal?1e4:3e4,this.sample=Math.random()<environment_settings.E.LOG_SAMPLE_RATE_FOR_ANONYMOUS_USER,this.accessLog$=void 0,this.trackerToken$=new Subject.B,this.visitedPages$=void 0,this.appEvent$=new Subject.B,this.pageVisit$=void 0,this.pageLeave$=void 0,this.bufferedEvents$=void 0,this.gaRequest$=void 0,this.env.isServer||this.env.isEmail||this.env.isAdmin||(this.bufferedEvents$=(0,merge.h)(this.okraRouter.routingResolved$,this.appEvent$).pipe((0,filter.p)((event=>!!event.request_method&&![TransitionMethod.VISIT,TransitionMethod.LEAVE].includes(event.request_method))),(0,bufferTime.w)(this._TIME_TO_BUFFER),(0,filter.p)((events=>events.length>0))),this.pageVisit$=this.okraRouter.routingResolvedReplay$.pipe((0,filter.p)((event=>event.request_method===TransitionMethod.VISIT)),(0,take.s)(1),(0,map.T)((event=>[event]))),this.pageLeave$=this.okraRouter.routingResolved$.pipe((0,filter.p)((event=>event.request_method===TransitionMethod.LEAVE)),(0,map.T)((event=>[event]))),this.gaRequest$=this.okraRouter.routingResolved$.pipe((0,filter.p)((_=>!this.window.hasOwnProperty("google_tag_manager")&&this.window.hasOwnProperty("ga")))),this.accessLog$=(0,merge.h)(this.pageVisit$,this.pageLeave$,this.bufferedEvents$).pipe((0,filter.p)((_=>!("preview"in this.activatedRoute.snapshot.queryParams)&&this.sample)),(0,mergeMap.Z)((events=>{const request={logs:this.makeLogs(events),referrer:this.document.referrer,user_agent:this.window.navigator.userAgent},trackerToken=this.cookie.get("ttoken");return!!trackerToken&&(request.tracker=trackerToken,this.trackerToken$.next(trackerToken)),this.http.post("logs",request).pipe((0,catchError.W)((err=>(console.error("access log POST request error",err),(0,of.of)(err)))))})),(0,shareReplay.t)(1)),this.accessLog$.subscribe(),this.gaRequest$.pipe((0,take.s)(1)).subscribe((_=>ga("send","pageview"))),this.gaRequest$.pipe((0,skip.i)(1)).subscribe((event=>{ga("set","page",event.location?.raw_url),ga("send","pageview")})))}logAppEvent(request_method){this.okraRouter.routingResolvedReplay$.pipe((0,take.s)(1),(0,filter.p)((event=>!!event.request_method&&![TransitionMethod.INTERNAL,TransitionMethod.TAB,TransitionMethod.TAB_INTERNAL,TransitionMethod.POPSTATE,TransitionMethod.QUERY,TransitionMethod.ANCHOR,TransitionMethod.VISIT,TransitionMethod.LEAVE,TransitionMethod.OTHER].includes(event.request_method))),(0,map.T)((event=>(event.request_method=request_method,event.created=function access_log_service_msToSec(value){return Math.round(value/100)/10}((new Date).getTime()),event)))).subscribe((event=>{this.appEvent$.next(event)}))}logGAEvent(eventCategory,action,label,value){this.env.isServer||window.hasOwnProperty("ga")&&ga("send","event",{eventCategory,eventAction:action,eventLabel:label,eventValue:value})}makeLogs(events){return(0,lodash.cloneDeep)(events).map((e=>{if(TransitionMethod.VISIT===e.request_method||TransitionMethod.INTERNAL===e.request_method){const _visitedPages={postPages:[],categoryPages:[]},visitedCategoryPages=localStorage.getItem("visitedCategoryPages");if(e.content?.isCategory&&e.content?.category&&e.content?.category?.id&&visitedCategoryPages){const visitedPages=visitedCategoryPages.split(",").map((v=>Number(v))).filter((p=>p!==e.content?.category?.id));visitedPages.push(e.content?.category?.id),201===visitedPages.length&&visitedPages.shift(),localStorage.setItem("visitedCategoryPages",visitedPages.map((p=>p.toString())).join(",")),_visitedPages.categoryPages=visitedPages}else e.content?.isCategory&&!visitedCategoryPages&&e.content?.category?.id&&(localStorage.setItem("visitedCategoryPages",e.content?.category.id.toString()),_visitedPages.categoryPages=[e.content?.category.id]);const visitedPostPages=localStorage.getItem("visitedPostPages");if(e.content?.isPost&&e.content?.post&&e.content?.post?.id&&visitedPostPages){const visitedPages=visitedPostPages.split(",").filter((p=>p!==e.content?.post?.id));visitedPages.push(e.content?.post.id),201===visitedPages.length&&visitedPages.shift(),localStorage.setItem("visitedPostPages",visitedPages.map((p=>p.toString())).join(",")),_visitedPages.postPages=visitedPages}else e.content?.isPost&&!visitedPostPages&&e.content?.post?.id&&(localStorage.setItem("visitedPostPages",e.content?.post.id.toString()),_visitedPages.postPages=[e.content?.post.id]);this.visitedPages$=(0,of.of)(_visitedPages)}let url,isLeaveOrOther;return isLeaveOrOther=!!e.request_method&&[TransitionMethod.LEAVE,TransitionMethod.OTHER].includes(e.request_method),url=isLeaveOrOther?e.url:e.location?.url,{request_method:e.request_method,place:e.place,created:e.created,count:e.count,time:e.time,time_stayed:e.time_stayed,total_time:e.total_time,url,url_params:e.location?.url_params,url_fragment:e.location?.url_fragment,url_params_hash:e.location?.url_params_hash,locale:e.location?.locale_id,category:e.location?.category_id,post:e.location?.post_id,main_category:e.location?.main_category_id,category_ids:e.location?.category_ids,...e.former_location?{_url:e.former_location.url,_url_params:e.former_location.url_params,_url_fragment:e.former_location.url_fragment,_url_params_hash:e.former_location.url_params_hash,_category:e.former_location.category_id,_post:e.former_location.post_id,_main_category:e.former_location.main_category_id,_category_ids:e.former_location.category_ids}:{}}}))}static{this.ctorParameters=()=>[{type:OkraHttpService},{type:env_service._},{type:OkraRouterService},{type:OkraCookieService},{type:fesm2022_router.nX},{type:Window,decorators:[{type:core.Inject,args:[window_service.jf]}]},{type:Document,decorators:[{type:core.Inject,args:[common.DOCUMENT]}]}]}};OkraAccessLogService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[OkraHttpService,env_service._,OkraRouterService,OkraCookieService,fesm2022_router.nX,Window,Document])],OkraAccessLogService);let OkraGTMService=class OkraGTMService{customEvent(eventName){window.dataLayer=window.dataLayer||[];const gtmEvent={event:"okra_event",okra_event:eventName};window.dataLayer.push(gtmEvent)}login(method){window.dataLayer=window.dataLayer||[];const gtmEvent={event:"login",method};window.dataLayer.push(gtmEvent)}okraTicketToGAItem(ticket,currency){return{item_id:ticket.id,item_name:ticket.name,currency,index:0,price:ticket.price,quantity:1}}send_any_data(data){window.dataLayer&&window.dataLayer.push(data)}begin_checkout(ticket){window.dataLayer=window.dataLayer||[];const currency=(0,functions.D9)(ticket.locale),gaEvent={event:"begin_checkout",ecommerce:{items:[this.okraTicketToGAItem(ticket,currency)]}};window.dataLayer.push(gaEvent)}purchase(ticket){window.dataLayer=window.dataLayer||[],window.dataLayer.push({ecommerce:null});const currency=(0,functions.D9)(ticket.locale),gaEvent={event:"purchase",ecommerce:{value:ticket.price,currency,items:[this.okraTicketToGAItem(ticket,currency)]}};window.dataLayer.push(gaEvent)}add_payment_info(ticket){window.dataLayer=window.dataLayer||[],window.dataLayer.push({ecommerce:null});const currency=(0,functions.D9)(ticket.locale),gaEvent={event:"add_payment_info",ecommerce:{value:ticket.price,currency,items:[this.okraTicketToGAItem(ticket,currency)],payment_type:"Credit Card"}};window.dataLayer.push(gaEvent)}add_to_cart(ticket){window.dataLayer=window.dataLayer||[],window.dataLayer.push({ecommerce:null});const currency=(0,functions.D9)(ticket.locale),gaEvent={event:"add_to_cart",ecommerce:{items:[this.okraTicketToGAItem(ticket,currency)]}};window.dataLayer.push(gaEvent)}video(data){window.dataLayer=window.dataLayer||[];const gtmEvent={event:"video",video:{status:data.status,label:data.label}};window.dataLayer.push(gtmEvent)}};OkraGTMService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"})],OkraGTMService);var OkraTokenService_1,errors=__webpack_require__("../ts-utils/dist/errors.js"),timer=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/timer.js"),electron=__webpack_require__("../ts-utils/dist/electron.js"),electron_ipc_service=__webpack_require__("./.src/storybook/storybook_admin/lib/services/electron-ipc.service.ts");let OkraTokenService=class OkraTokenService{static{OkraTokenService_1=this}static{this.CLIENT_TOKEN_EXPIRE=6e4}static{this.ADMIN_TOKEN_EXPIRE=6e4}get clientTokenLastUpdated(){const dateStr=localStorage.getItem("client-token-last-updated");return dateStr?Number(dateStr):null}set clientTokenLastUpdated(value){null!==value?localStorage.setItem("client-token-last-updated",String(value)):localStorage.removeItem("client-token-last-updated")}get adminTokenLastUpdated(){const dateStr=localStorage.getItem("admin-token-last-updated");return dateStr?Number(dateStr):null}set adminTokenLastUpdated(value){null!==value?localStorage.setItem("admin-token-last-updated",String(value)):localStorage.removeItem("admin-token-last-updated")}get clientTokenNotSet(){return null===this.clientAccessToken||""===this.clientAccessToken}get adminTokenNotSet(){return null===this.adminAccessToken||""===this.adminAccessToken}get clientTokenExpired(){return!this.clientTokenLastUpdated||(new Date).getTime()-this.clientTokenLastUpdated>OkraTokenService_1.CLIENT_TOKEN_EXPIRE}get adminTokenExpired(){return!this.adminTokenLastUpdated||(new Date).getTime()-this.adminTokenLastUpdated>OkraTokenService_1.ADMIN_TOKEN_EXPIRE}set adminRefreshToken(value){""!==value?localStorage.setItem("admin-refresh-token",value):localStorage.removeItem("admin-refresh-token")}get adminRefreshToken(){return localStorage.getItem("admin-refresh-token")}get clientRefreshToken(){return this.cookie.get("refresh_token")}set clientRefreshToken(value){this.cookie.put("refresh_token",value)}set adminAccessToken(value){""!==value?localStorage.setItem("admin-access-token",value):localStorage.removeItem("admin-access-token")}get adminAccessToken(){return localStorage.getItem("admin-access-token")}get clientAccessToken(){return this.cookie.get("access_token")}set clientAccessToken(value){this.cookie.put("access_token",value)}get accessToken$(){return this.initTokenLastUpdated$.pipe((0,mergeMap.Z)((()=>this.env.isAdmin?this.adminAccessToken$:this.clientAccessToken$)))}get adminAccessToken$(){return this.adminTokenNotSet?(0,throwError.$)((()=>new errors.uV(errors.O4.NOT_LOGGED_IN,"Not logged in"))):this.adminTokenExpired?this.refreshAdminToken():(0,of.of)(this.adminAccessToken)}get clientAccessToken$(){return this.clientTokenNotSet?(0,throwError.$)((()=>new errors.uV(errors.O4.NOT_LOGGED_IN,"Not logged in"))):this.clientTokenExpired?this.refreshClientToken():(0,of.of)(this.clientAccessToken)}constructor(env,electronIpc,cookie,http,window){this.env=env,this.electronIpc=electronIpc,this.cookie=cookie,this.http=http,this.window=window,this.initTokenLastUpdated$=(0,of.of)(null).pipe((0,mergeMap.Z)((()=>{if(this.env.isClient){if(!this.clientRefreshToken)return(0,of.of)(!0);return!!this.clientRefreshToken&&!this.clientTokenExpired?(0,of.of)(!0):this.refreshClientToken().pipe((0,map.T)((()=>!0)))}if(!this.adminRefreshToken)return(0,of.of)(!0);return!!this.adminRefreshToken&&!this.adminTokenExpired?(0,of.of)(!0):this.refreshAdminToken().pipe((0,map.T)((()=>!0)))})),(0,shareReplay.t)()),this.env.isIframe||(this.electronIpc.observe$(electron.Q2.REFRESH_CLIENT_TOKEN).subscribe({next:token=>{console.log("Refreshed client",token),this.setClientToken(token,!0)}}),this.electronIpc.observe$(electron.Q2.REFRESH_ADMIN_TOKEN).subscribe({next:token=>{console.log("Refreshed admin",token),this.setAdminToken(token,!0)}}),this.env.isPreviewMode&&(0,timer.O)(3e4).pipe().subscribe())}acquireAdminLogin(email,password,revokeTargetUUIDs){return this.http.post(adminApiUrl("token-auth/"),JSON.stringify({email,password,uuid:revokeTargetUUIDs})).pipe((0,map.T)((token=>(this.setAdminToken(token),this.electronIpc.request$(electron.Q2.SET_ADMIN_TOKEN,token).subscribe(),this.adminAccessToken))))}acquireClientLogin(email,password,locale_id,revokeTargetUUIDs){const url=this.env.isAdmin?adminApiUrl("token-auth/"):(0,functions.ok)("token-auth/",this.env.isAdmin);return this.http.post(url,JSON.stringify({email,password,locale_id,uuid:revokeTargetUUIDs}),{withCredentials:!0}).pipe((0,map.T)((token=>(this.setClientToken(token),this.electronIpc.request$(electron.Q2.SET_CLIENT_TOKEN,token).subscribe(),this.clientAccessToken))))}logoutClient(locale_id){return this.clientTokenNotSet?(0,of.of)(!0):this.http.post((0,functions.ok)("logout",this.env.isAdmin),JSON.stringify({refresh:this.clientRefreshToken,locale_id})).pipe((0,map.T)((()=>(this.removeClientToken(),!0))))}setClientToken(token,ignoreElectron=!1){this.clientTokenLastUpdated=(new Date).getTime(),this.clientAccessToken=token.access,this.clientRefreshToken=token.refresh,ignoreElectron||this.electronIpc.request$(electron.Q2.SET_CLIENT_TOKEN,token).subscribe()}setAdminToken(token,ignoreEleetron=!1){this.adminTokenLastUpdated=(new Date).getTime(),this.adminAccessToken=token.access,this.adminRefreshToken=token.refresh,ignoreEleetron||this.electronIpc.request$(electron.Q2.SET_ADMIN_TOKEN,token).subscribe()}removeClientToken(){this.clientAccessToken="",this.clientRefreshToken="",this.electronIpc.request$(electron.Q2.REVOKE_CLIENT_TOKEN).subscribe()}removeAdminToken(){this.adminAccessToken="",this.adminRefreshToken="",this.electronIpc.request$(electron.Q2.REVOKE_ADMIN_TOKEN).subscribe()}refreshClientToken(){return this.http.post((0,functions.y0)("token-refresh",this.window),JSON.stringify({refresh:this.clientRefreshToken})).pipe((0,catchError.W)((err=>(this.removeClientToken(),(0,throwError.$)((()=>(0,errors.xX)(err,new errors.uV(errors.O4.FORBIDDEN,"Not authorized"))))))),(0,map.T)((token=>(this.setClientToken(token),this.clientAccessToken))))}refreshAdminToken(){return this.http.post(adminApiUrl("token-refresh"),JSON.stringify({refresh:this.adminRefreshToken})).pipe((0,catchError.W)((err=>(this.removeAdminToken(),(0,throwError.$)((()=>(0,errors.xX)(err,new errors.uV(errors.O4.FORBIDDEN,"Not authorized"))))))),(0,map.T)((token=>(this.setAdminToken(token),this.adminAccessToken))))}static{this.ctorParameters=()=>[{type:env_service._},{type:electron_ipc_service.l},{type:OkraCookieService},{type:OkraHttpService},{type:void 0,decorators:[{type:core.Inject,args:[window_service.jf]}]}]}};OkraTokenService=OkraTokenService_1=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[env_service._,electron_ipc_service.l,OkraCookieService,OkraHttpService,Object])],OkraTokenService);let OkraAuthService=class OkraAuthService{set isLoggedInWithOIDC(bool){const value=bool?"true":"false";localStorage.setItem("loggedin-oidc",value)}get isLoggedInWithOIDC(){const isLoggedInWithOIDC=localStorage.getItem("loggedin-oidc");return!!isLoggedInWithOIDC&&"true"===isLoggedInWithOIDC.toLowerCase()}set provider(value){localStorage.setItem("provider",value)}get provider(){return localStorage.getItem("provider")}constructor(http,cookie,localeService,categoryService,formatterService,env,gtmService,accessLogService,window,okraRouter,tokenService){this.http=http,this.cookie=cookie,this.localeService=localeService,this.categoryService=categoryService,this.formatterService=formatterService,this.env=env,this.gtmService=gtmService,this.accessLogService=accessLogService,this.window=window,this.okraRouter=okraRouter,this.tokenService=tokenService,this._userInfo$=new ReplaySubject.m(1),this.resetPaymentServiceData$=new Subject.B,this._authTokenRefreshRequested=!1,this._refreshAuthToken$=new ReplaySubject.m(1),this._fetchUserInfoRequested=!1,this._fetchUserInfo$=new BehaviorSubject.t(null),this.env.isServer||this.localeService.currentLocaleResolved$.subscribe((v=>{v&&this.checkIn$().subscribe()}))}get userInfo$(){return this.env.isSSR?empty.w:this._userInfo$}get isLoggedIn$(){return this.userInfo$.pipe((0,map.T)((userInfo=>!!userInfo)))}checkIn$(){return this.tokenService.accessToken$.pipe((0,catchError.W)((err=>(0,of.of)(null))),(0,mergeMap.Z)((token=>null===token?(0,of.of)(null):this.isLoggedInWithOIDC?this._fetchUserInfoWithOpenIDConnect():this._fetchUserInfo())),(0,tap.M)((userInfo=>{this._userInfo$.next(userInfo)})))}loginWithPassword(email,password,uuids){const current_locale_id=localStorage.getItem("current-locale-id");return this.env.isAdmin?this.tokenService.acquireAdminLogin(email,password,uuids):this.tokenService.acquireClientLogin(email,password,current_locale_id,uuids).pipe((0,mergeMap.Z)((accessToken=>{if(this.gtmService.login("password"),this.env.isClient)return this.accessLogService.logAppEvent("login"),this.checkIn$()})))}get siteUrl(){return this.env.isBrowserAfterSSR&&"local"===environment_settings.E.TARGET_ENV?this.window.location.origin:environment_settings.E.SITE_URL}loginWithFacebook(){environment_settings.E.I18N&&this.localeService.currentLocale.id;return this.provider="facebook",this.http.get((0,functions.ok)("oauth_redirect",this.env.isAdmin),{params:{provider:"facebook"},withCredentials:!0}).subscribe((res=>{location.href=res.redirect_url}))}loginWithGoogle(){return this.provider="google",this.http.get((0,functions.ok)("oauth_redirect",this.env.isAdmin),{params:{provider:"google"},withCredentials:!0}).subscribe((res=>{location.href=res.redirect_url}))}loginWithOpenIDConnect(){return this.http.get((0,functions.ok)("oidc_redirect",this.env.isAdmin),{withCredentials:!0}).subscribe((res=>{location.href=res.redirect_url}))}signup(registrationInfo){environment_settings.E.I18N&&this.localeService.currentLocale&&(registrationInfo.locale_slug=this.localeService.currentLocale.slug),registrationInfo.user_type=this.env.isAdmin?"cms_user":"general_user";const url=this.env.isAdmin?adminApiUrl("users/register/"):(0,functions.ok)("users/register",this.env.isAdmin);return this.http.post(url,JSON.stringify(registrationInfo))}logout(){const current_locale_id=localStorage.getItem("current-locale-id");return this.tokenService.logoutClient(current_locale_id).subscribe((res=>{this.clearData(),this.env.usePayment&&this.resetPaymentServiceData$.next()}))}clearData(){this._fetchUserInfoRequested=!1,this._userInfo$.next(null);const current_locale_id=localStorage.getItem("current-locale-id");this.cookie.remove(`access_token-${current_locale_id}`),this.cookie.remove(`refresh_token-${current_locale_id}`),localStorage.removeItem("provider"),localStorage.removeItem("loggedin-oidc")}getFavoritePosts(request=null){if(this.env.isServer||this.env.isAdmin)return console.warn("OkraAuthService.getFavoritePosts should not be called on the server or admin side."),(0,of.of)([]);const time=new Date;let httpParams=new http.Nl;return httpParams=httpParams.append("time",String(time.getTime())),httpParams=httpParams.append("unit","all"),request&&Object.keys(this.localeService.resolveRequest(request)).forEach((key=>{httpParams=httpParams.append(key,String(request[key]))})),this.http.get((0,functions.ok)("users/favorite",this.env.isAdmin),{params:httpParams}).pipe((0,mergeMap.Z)((res=>this.categoryService.getCategories().pipe((0,map.T)((categories=>{const _categories=new Map(categories.map((c=>[c.id,c])));return this.favoritePosts=res.map((item=>(item.post=this.formatterService.formatPost(item.post,_categories),item))),this.favoritePosts}))))))}getLikedPosts(request=null){if(this.env.isServer||this.env.isAdmin)return console.warn("OkraAuthService.getFavoritePosts should not be called on the server or admin side."),(0,of.of)([]);const time=new Date;let httpParams=new http.Nl;return httpParams=httpParams.append("time",String(time.getTime())),httpParams=httpParams.append("unit","all"),request&&Object.keys(this.localeService.resolveRequest(request)).forEach((key=>{httpParams=httpParams.append(key,String(request[key]))})),this.http.get("/users/liked_posts",{params:httpParams}).pipe((0,mergeMap.Z)((res=>this.categoryService.getCategories().pipe((0,map.T)((categories=>{const _categories=new Map(categories.map((c=>[c.id,c])));return this.likedPosts=res.map((item=>(item.post=this.formatterService.formatPost(item.post,_categories),item))),this.likedPosts}))))))}getDislikedPosts(request=null){if(this.env.isServer||this.env.isAdmin)return console.warn("OkraAuthService.getFavoritePosts should not be called on the server or admin side."),(0,of.of)([]);const time=new Date;let httpParams=new http.Nl;return httpParams=httpParams.append("time",String(time.getTime())),httpParams=httpParams.append("unit","all"),request&&Object.keys(this.localeService.resolveRequest(request)).forEach((key=>{httpParams=httpParams.append(key,String(request[key]))})),this.http.get("/users/disliked_posts",{params:httpParams}).pipe((0,mergeMap.Z)((res=>this.categoryService.getCategories().pipe((0,map.T)((categories=>{const _categories=new Map(categories.map((c=>[c.id,c])));return this.dislikedPosts=res.map((item=>(item.post=this.formatterService.formatPost(item.post,_categories),item))),this.dislikedPosts}))))))}getLikedComments(request=null){if(this.env.isServer||this.env.isAdmin)return console.warn("OkraAuthService.getFavoritePosts should not be called on the server or admin side."),(0,of.of)([]);const time=new Date;let httpParams=new http.Nl;return httpParams=httpParams.append("time",String(time.getTime())),httpParams=httpParams.append("unit","all"),request&&Object.keys(this.localeService.resolveRequest(request)).forEach((key=>{httpParams=httpParams.append(key,String(request[key]))})),this.http.get("/users/liked_comments",{params:httpParams}).pipe((0,tap.M)((res=>{this.likedComments=res})))}getDislikedComments(request=null){if(this.env.isServer||this.env.isAdmin)return console.warn("OkraAuthService.getFavoritePosts should not be called on the server or admin side."),(0,of.of)([]);const time=new Date;let httpParams=new http.Nl;return httpParams=httpParams.append("time",String(time.getTime())),httpParams=httpParams.append("unit","all"),request&&Object.keys(this.localeService.resolveRequest(request)).forEach((key=>{httpParams=httpParams.append(key,String(request[key]))})),this.http.get("/users/disliked_comments",{params:httpParams}).pipe((0,tap.M)((res=>{this.dislikedComments=res})))}getFavoritePagedPosts(request=null){if(this.env.isServer||this.env.isAdmin)return console.warn("OkraAuthService.getFavoritePagedPosts should not be called on the server or admin side."),(0,of.of)(null);const time=new Date;let httpParams=new http.Nl;return httpParams=httpParams.append("time",String(time.getTime())),request&&Object.keys(this.localeService.resolveRequest(request)).forEach((key=>{httpParams=httpParams.append(key,String(request[key]))})),this.http.get((0,functions.ok)("users/favorite",this.env.isAdmin),{params:httpParams}).pipe((0,mergeMap.Z)((res=>this.categoryService.getCategories().pipe((0,map.T)((categories=>{const _categories=new Map(categories.map((c=>[c.id,c])));return this.favoriteResult=res,this.favoriteResult.results.map((item=>this.formatterService.formatPost(item.post,_categories))),this.favoriteResult}))))))}addFavoritePost(postId){return this.env.isServer||this.env.isAdmin?(console.warn("OkraAuthService.addFavoritePost should not be called on the server or admin side."),(0,of.of)(null)):this.http.post((0,functions.ok)("users/favorite",this.env.isAdmin),{post_id:postId}).pipe((0,mergeMap.Z)((()=>this.getFavoritePosts())))}deleteFavoritePost(postId){return this.env.isServer||this.env.isAdmin?(console.warn("OkraAuthService.deleteFavoritePost should not be called on the server or admin side."),(0,of.of)(null)):this.http.delete((0,functions.ok)(`users/favorite/${postId}`,this.env.isAdmin)).pipe((0,mergeMap.Z)((()=>this.getFavoritePosts())))}getEmailMagazineSubscription(){if(this.env.isServer||this.env.isAdmin)return console.warn("OkraAuthService.fetchRegistrationInfo should not be called on the server or admin side."),(0,of.of)(null);const params=(new http.Nl).append("locale_id",this.localeService.currentLocale.id.toString());return this.http.get((0,functions.ok)("users/email-subscription",this.env.isAdmin),{params})}_fetchUserInfo(){if(this.env.isServer)return console.warn("OkraAuthService.fetchRegistrationInfo should not be called on the server or admin side."),(0,of.of)(null);if(this._fetchUserInfoRequested)return this.userInfo$;{this._fetchUserInfoRequested=!0;const url=this.env.isAdmin?adminApiUrl("users/mypage/"):(0,functions.ok)("users/mypage",this.env.isAdmin);return this.http.get(url).pipe((0,tap.M)((info=>{this._userInfo$.next(info)})))}}updateUserInfo(_updateInfo){const updateInfo=(0,lodash.cloneDeep)(_updateInfo);if(this.env.isServer)return console.warn("OkraAuthService.updateRegistrationInfo should not be called on the server or admin side."),(0,of.of)(null);for(const key in updateInfo.og_image)updateInfo.og_image.hasOwnProperty(key)&&!["file","file_name","file_path","height","id","mime_type","url_key","width","deleted"].some((k=>k===key))&&delete updateInfo.og_image[key];for(const key in updateInfo.thumbnail)updateInfo.thumbnail.hasOwnProperty(key)&&!["file","file_name","file_path","height","id","mime_type","url_key","width","deleted"].some((k=>k===key))&&delete updateInfo.thumbnail[key];return(0,zip.y)(this.userInfo$,this.http.formPut((0,functions.ok)("users/mypage",this.env.isAdmin),updateInfo)).pipe((0,map.T)((([oldUserInfo,newUserInfo])=>({...oldUserInfo,...newUserInfo}))),(0,tap.M)((res=>{this._userInfo$.next(res)})))}updatePassword(password,new_password){return this.env.isServer?(console.warn("OkraAuthService.updatePassword should not be called on the server or admin side."),(0,of.of)(null)):this.http.put((0,functions.ok)("users/change_password",this.env.isAdmin),{password,new_password})}updateEmailSubscription(emailCategoryIds){return this.env.isServer||this.env.isAdmin?(console.warn("OkraAuthService.updateEmailSubscription should not be called on the server or admin side."),(0,of.of)(null)):(0,zip.y)(this.userInfo$,this.http.put((0,functions.ok)("users/email-subscription",this.env.isAdmin),{emailCategoryIds})).pipe((0,map.T)((([oldUserInfo,_])=>({...oldUserInfo,subscribed_magazine_categories:emailCategoryIds}))),(0,tap.M)((res=>{this._userInfo$.next(res)})))}forgotPassword(email){if(this.env.isServer)return console.warn("OkraAuthService.forgotPassword should not be called on the server or admin side."),(0,of.of)(null);let locale_slug=null;return environment_settings.E.I18N&&(locale_slug=this.localeService.currentLocale.slug),this.http.post((0,functions.ok)("users/forgot_password",this.env.isAdmin),JSON.stringify({email,locale_slug}))}confirmInvitation(invitation_code,is_new_user,username,password){return this.env.isServer?(console.warn("OkraAuthService.resetPassword should not be called on the server or admin side."),(0,of.of)(null)):this.http.put((0,functions.ok)("confirm-invitation",this.env.isAdmin),JSON.stringify({invitation_code,is_new_user,password,username}))}changeEmailVerification(verification_code){return this.env.isServer?(console.warn("OkraAuthService.resetPassword should not be called on the server or admin side."),(0,of.of)(null)):this.http.put((0,functions.ok)("change-email-verification",this.env.isAdmin),JSON.stringify({verification_code}))}resetPassword(code,password){return this.env.isServer?(console.warn("OkraAuthService.resetPassword should not be called on the server or admin side."),(0,of.of)(null)):this.http.post((0,functions.ok)("users/reset_password",this.env.isAdmin),JSON.stringify({certification_code:code,password}))}withdraw(password){let locale_slug=null;return environment_settings.E.I18N&&(locale_slug=this.localeService.currentLocale.slug),this.http.post((0,functions.ok)("users/withdraw",this.env.isAdmin),JSON.stringify({locale_slug,password}))}getUserInfoWithOAuth(queryParams){return this.http.get((0,functions.ok)("oauth_user_info",this.env.isAdmin),{params:{...queryParams,provider:this.provider},withCredentials:!0}).pipe((0,catchError.W)((_err=>(0,of.of)(null))),(0,mergeMap.Z)((res=>(this.saveToken(res),(0,of.of)(res)))))}getUserTokenWithOpenIDConnect(queryParams){return this.http.get((0,functions.ok)("oidc_user_token",this.env.isAdmin),{params:{...queryParams,withCredentials:!0}}).pipe((0,catchError.W)((_err=>(0,of.of)(null))),(0,mergeMap.Z)((res=>(this.saveTokenWithOIDC(res),(0,of.of)(res)))))}_fetchUserInfoWithOpenIDConnect(){return this.env.isServer||this.env.isAdmin?(console.warn("OkraAuthService.fetchUserInfoWithOpenIDConnect should not be called on the server or admin side."),(0,of.of)(null)):this.http.get((0,functions.ok)("oidc_user_info",this.env.isAdmin),{withCredentials:!0}).pipe((0,catchError.W)((_err=>(this.logout(),(0,of.of)(null)))))}inquiryToZendesk(name,email,subject,body,recaptchaToken){return this.env.isServer||this.env.isAdmin?(console.warn("OkraAuthService.inqueryToZendesk should not be called on the server or admin side."),(0,of.of)(null)):this.http.post("zendesk-tickets",JSON.stringify({name,email,subject,body,recaptchaToken}))}verifyUser(activationCode,localeSlug){return this.http.put((0,functions.ok)("users/activate",this.env.isAdmin),{activation_code:activationCode,locale_slug:localeSlug})}saveToken(res){}saveTokenWithOIDC(res){res&&(this.isLoggedInWithOIDC=!0,this.saveToken(res))}static{this.ctorParameters=()=>[{type:OkraHttpService},{type:OkraCookieService},{type:OkraLocaleService},{type:OkraCategoryService},{type:OkraFormatterService},{type:env_service._},{type:OkraGTMService},{type:OkraAccessLogService},{type:void 0,decorators:[{type:core.Inject,args:[window_service.jf]}]},{type:OkraRouterService},{type:OkraTokenService}]}};OkraAuthService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[OkraHttpService,OkraCookieService,OkraLocaleService,OkraCategoryService,OkraFormatterService,env_service._,OkraGTMService,OkraAccessLogService,Object,OkraRouterService,OkraTokenService])],OkraAuthService);let OkraGuestDirective=class OkraGuestDirective{constructor(container,template,env,auth){this.container=container,this.template=template,this.env=env,this.auth=auth}ngOnInit(){this.env.isServer||this.auth.userInfo$.pipe((0,filter.p)((result=>(console.log(result),!result)))).subscribe((()=>{this.container.createEmbeddedView(this.template)}))}static{this.ctorParameters=()=>[{type:core.ViewContainerRef},{type:core.TemplateRef},{type:env_service._},{type:OkraAuthService}]}};OkraGuestDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraGuest]",exportAs:"okraGuest"}),(0,tslib_es6.Sn)("design:paramtypes",[core.ViewContainerRef,core.TemplateRef,env_service._,OkraAuthService])],OkraGuestDirective);var platform_browser=__webpack_require__("./node_modules/@angular/platform-browser/fesm2022/platform-browser.mjs"),resize_observer=__webpack_require__("./node_modules/@juggle/resize-observer/lib/exports/resize-observer.js");let OkraImageLazyLoadService=class OkraImageLazyLoadService{constructor(env,window){if(this.env=env,this.window=window,this.imageInstances=new Set,this.loadAnimationImageInstances=new Set,this.supportsObjectFit=!0,this.supportsObjectPosition=!0,this.supportsOFI=!0,this.resizeSubject$=new Subject.B,this.loadingOptions={root:null,rootMargin:"400px 100px",threshold:[0,.5,1]},this.dummyLoadingOptions={root:null,rootMargin:"1200px 10000%",threshold:[0,.5,1]},!this.env.isBrowser)return;const testImg="undefined"==typeof Image?{style:{"object-position":1}}:new Image;this.supportsObjectFit="object-fit"in testImg.style,this.supportsObjectPosition="object-position"in testImg.style,this.supportsOFI="background-size"in testImg.style;const self=this;this.imageLoadObserver=new IntersectionObserver(((entries,object)=>{self.intersectionCallback(entries,self)}),this.loadingOptions),this.loadAnimationImageLoadObserver=new IntersectionObserver(((entries,object)=>{self.loadAnimationIntersectionCallback(entries,self)}),this.dummyLoadingOptions),this.resizeObserver=new resize_observer.tb((entries=>{this.resizeLoadAnimationImages(entries,self)})),(0,fromEvent.R)(this.window,"resize").subscribe((_=>this.resizeSubject$.next()))}registerImageInstances(image){this.imageInstances.has(image)||(this.imageInstances.add(image),this.imageLoadObserver.observe(image.element))}removeImageInstances(image){this.imageInstances.has(image)&&(this.imageInstances.delete(image),this.imageLoadObserver.unobserve(image.element))}registerLoadAnimationImageInstances(image){this.loadAnimationImageInstances.has(image)||(this.loadAnimationImageInstances.add(image),this.loadAnimationImageLoadObserver.observe(image.element),this.resizeObserver.observe(image.element))}removeLoadAnimationImageInstances(image){this.loadAnimationImageInstances.has(image)&&(this.loadAnimationImageInstances.delete(image),this.loadAnimationImageLoadObserver.unobserve(image.element),this.resizeObserver.unobserve(image.element))}getImageInstance(id){return Array.from(this.imageInstances).find((instance=>instance.uniqueId===id))}getLoadAnimationImageInstance(id){return Array.from(this.loadAnimationImageInstances).find((instance=>instance.uniqueId===id))}intersectionCallback(entries,self){entries.forEach((entry=>{if(!entry.isIntersecting)return;const img=entry.target,uid=img.getAttribute("data-okra-image-id"),target=self.getImageInstance(uid);target?(target.loadImage(),this.removeImageInstances(target)):this.imageLoadObserver.unobserve(img)}))}loadAnimationIntersectionCallback(entries,self){entries.forEach((entry=>{const boundingClientRect=entry.boundingClientRect,rootBounds=entry.rootBounds;if(!rootBounds)return;if(!(entry.isIntersecting||boundingClientRect.top<rootBounds.bottom&&boundingClientRect.bottom>rootBounds.top))return;const img=entry.target,uid=img.getAttribute("data-okra-image-id"),target=self.getLoadAnimationImageInstance(uid);target?(target.setDummyImage(),this.removeLoadAnimationImageInstances(target)):this.loadAnimationImageLoadObserver.unobserve(img)}))}resizeLoadAnimationImages(entries,self){entries.forEach((entry=>{const uid=entry.target.getAttribute("data-okra-image-id"),target=self.getImageInstance(uid);target&&target.resizeSubject$.next()}))}static{this.ctorParameters=()=>[{type:env_service._},{type:void 0,decorators:[{type:core.Inject,args:[window_service.jf]}]}]}};OkraImageLazyLoadService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[env_service._,Object])],OkraImageLazyLoadService);var debounceTime=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/debounceTime.js");let nextUniqueId=0;let OkraImageDirective=class OkraImageDirective{get attrSrc(){if(!this._attrSrc||!this.env.isBrowser&&!this.isEmail)return null;if(this._attrSrc&&this.isLoaded)return this._attrSrc;const width=this._picture?this._picture.width:this.width,height=this._picture?this._picture.height:this.height;return this._attrSrc&&this.env.isBrowser&&!this.isLoaded&&width&&height?this.sanitizer.bypassSecurityTrustResourceUrl("data:image/svg+xml;charset=utf-8,"+encodeURIComponent(`<svg width="${width}" height="${height}" viewBox="0 0 ${width} ${height}" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"></svg>`)):null}set attrSrc(value){this._attrSrc=value}get attrSrcset(){return"string"==typeof this._attrSrcset&&(this.env.isBrowser||this.isEmail)?this.sanitizer.bypassSecurityTrustResourceUrl(this._attrSrcset):"string"!=typeof this._attrDummySrcset||!this.env.isBrowser&&!this.isEmail||this.isLoaded?null:this.sanitizer.bypassSecurityTrustResourceUrl(this._attrDummySrcset)}set attrSrcset(value){this._attrSrcset=value}get isBackgroundImage(){return"PICTURE"!==this.elementTagName&&!!this._attrSrc&&this.isLoaded}get attrWidth(){return!this.isBackgroundImage&&this.width?this.width.toString(10):null}get attrHeight(){return!this.isBackgroundImage&&this.height?this.height.toString(10):null}get attrAlt(){return this.alt}get uniqueId(){return this._uniqueId}get loadingAnimation(){return this.env.isBrowser&&!!this._picture&&this.loadingLazy&&this._loadingAnimation}set loadingAnimation(value){this._loadingAnimation=value}get srcset(){return this._srcset}set srcset(value){const old=this._srcset;if(this._srcset=value,old!==this._srcset&&value){let attrSrcset=value,attrDummySrcset=value,dummySrcset=value;const sizes=attrSrcset.match(/\$\{\d+\}/g),picture=this._picture?this._picture:!this.picture&&this.imageId&&this.images?this.findImage(Number(this.imageId)):this.picture;if(!picture)return;sizes?.forEach((_size=>{const size=this.roundUpSize(Number(_size.replace(/^\$\{(\d+)\}$/,"$1"))),url=this.getImageUrl(picture,size),dummyUrl=this.getImageUrl(picture,100),width=picture?picture.width:this.width,height=picture?picture.height:this.height,svg="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(`<svg width="${width}" height="${height}" viewBox="0 0 ${width} ${height}" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"></svg>`);url&&(attrSrcset=attrSrcset.replace(_size,url)),attrDummySrcset=attrDummySrcset.replace(_size,svg),dummyUrl&&(dummySrcset=dummySrcset.replace(_size,dummyUrl))})),this.attrSrcset=attrSrcset||null,this._attrDummySrcset=attrDummySrcset||null,this.dummySrcset=dummySrcset}}get token(){return localStorage.getItem("admin-access-token")||""}constructor(el,renderer,cd,sanitizer,env,imageLazyLoadService,window){this.el=el,this.renderer=renderer,this.cd=cd,this.sanitizer=sanitizer,this.env=env,this.imageLazyLoadService=imageLazyLoadService,this.window=window,this._attrSrc=null,this._attrSrcset=null,this._attrDummySrcset=null,this.size=null,this.alt="",this.images=[],this.loadingLazy=!1,this._loadingAnimation=!0,this._srcset=null,this.isEmail=!1,this.elementTagName="",this.isInitialized=!1,this.isAfterViewInit=!1,this.isLoaded=!1,this.isPreLoaded=!1,this.endSetDummyImage=!1,this.isAdmin=!1,this.closestPicture=null,this.dummySrcset=null,this.setAttrSrcCount=0,this.usedDefaultImage=!1,this.crossOrigin="anonymous",this.resizeSubject$=new Subject.B,this.resizeEndSubject$=new Subject.B,this.unsubscriber$=new Subject.B,this._uniqueId="okra-image-"+nextUniqueId++,this.isAdmin="admin"===environment_settings.E.MODULE||this.env.isPreviewMode,this.isEmail=environment_settings.E.IS_EMAIL}ngOnInit(){this._picture=!this.picture&&this.imageId&&this.images?this.findImage(Number(this.imageId)):this.picture,this._picture&&"image/svg+xml"===this._picture.mime_type&&(this.size=0)}ngAfterViewInit(){this.isAfterViewInit=!0,this.element=this.el.nativeElement,this.elementTagName=this.element.tagName,this.isEmail&&(this.loadingLazy=!1),this.isLoaded=!0,this.isInitialized||this.setImage(),"casual"===environment_settings.E.DEFAULT_IMAGE_PROTECTION&&(this.el.nativeElement.setAttribute("oncontextmenu","return false"),this.renderer.setStyle(this.el.nativeElement,"-webkit-user-select","none"),this.renderer.setStyle(this.el.nativeElement,"user-select","none"),this.renderer.setStyle(this.el.nativeElement,"-webkit-touch-callout","none"))}ngOnChanges(changes){this.isInitialized&&(this.setImage(),this.loadingAnimation&&this.endSetDummyImage&&this.env.isBrowser&&this.setDummyImage())}ngOnDestroy(){this.env.isBrowser&&(this.imageLazyLoadService.removeImageInstances(this),this.imageLazyLoadService.removeLoadAnimationImageInstances(this),this.resizeObserver&&(this.resizeObserver.unobserve(this.element),this.resizeObserver.disconnect(),this.resizeObserver=void 0)),this.resizeSubject$.complete(),this.resizeEndSubject$.next(),this.resizeEndSubject$.complete(),this.unsubscriber$.next(),this.unsubscriber$.complete()}setImage(){if(this.usedDefaultImage&&(this.src=void 0),!this._picture&&this.src)this._attrSrc=this.src,this.cd.detectChanges(),this.width&&this.height||"dev"!==this.env.targetEnv&&this.env.targetEnv;else if(this.picture||this.src||"string"!=typeof this.imageId){this._picture=!this.picture&&this.imageId&&this.images?this.findImage(Number(this.imageId)):this.picture,this.usedDefaultImage=!1,!this._picture&&this.src&&(!this.width||!this.height)&&("dev"===this.env.targetEnv||this.env.targetEnv),null!==this.size&&"number"!=typeof this.size&&(this.size=0),this._picture&&"image/svg+xml"===this._picture.mime_type&&(this.size=0,this.loadingAnimation=!1);const parentElement=this.element?this.element.parentElement:null,ration=this.window.devicePixelRatio||1;let size=0;this.size||0===this.size?size=this.size:this.element?size=this.element.offsetWidth*ration<=1600?this.element.offsetWidth*ration:1600:parentElement&&(size=parentElement.offsetWidth*ration<=1600?parentElement.offsetWidth*ration:1600);const imageSize=this.roundUpSize(size),src=this._picture?this.getImageUrl(this._picture,!this.currentSize||imageSize>=this.currentSize?imageSize:this.currentSize):null;(src||this.env.isAdmin)&&src!==this._attrSrc&&(this._attrSrc=src,this.currentSize=imageSize,this.isAfterViewInit&&this.cd.detectChanges())}else this.src=this.imageId,this._attrSrc=this.src,this.usedDefaultImage=!0,this.cd.detectChanges(),this.width&&this.height||"dev"!==this.env.targetEnv&&this.env.targetEnv;if(this.isBackgroundImage&&this.element){const src=this.getBackgroundImageUrl();this.renderer.setStyle(this.element,"background-image",`url(${src})`)}else this._attrSrc&&this.setImageToPictureTag();this.isInitialized||(this.isInitialized=!0)}loadImage(){if(this.loadingAnimation){new Promise(((resolve,reject)=>{const img=new Image;this._attrSrcset&&(img.srcset=this._attrSrcset),img.src=this._attrSrc,img.complete&&resolve(""),img.onload=()=>{resolve("")},img.onerror=()=>{resolve("")}})).then((_=>{this.isPreLoaded=!0,this.removeDummyImage()}))}this.isLoaded=!0,this.cd.detectChanges()}getImageUrl(picture,_size,type){if(!picture&&!this.src)return"dev"===this.env.targetEnv||this.env.targetEnv,null;if(!picture&&this.src)return this.src;const size=picture&&"image/svg+xml"!==picture.mime_type&&"number"==typeof picture.width&&_size&&_size<picture.width?_size:0;return(0,functions.BM)(picture,size,this.isAdmin,this.window)}getBackgroundImageUrl(){return this.env.isSupportWebp?this.getWebpSrc(this._attrSrc):this._attrSrc}setImageToPictureTag(){this.isInitialized&&this.element&&(this.tagSource&&this.renderer.removeChild(this.element,this.tagSource),this.tagImg&&this.renderer.removeChild(this.element,this.tagImg));const webpSrc=this.getWebpSrc(this._attrSrc);this.tagSource=/\.webp/.test(webpSrc)?this.renderer.createElement("source"):null,this.tagSource&&(this.tagSource.setAttribute("type","image/webp"),this.tagSource.setAttribute("srcset",webpSrc),this.tagSource.setAttribute("data-okra-image-id",this._uniqueId),this.attrWidth&&this.tagSource.setAttribute("width",this.attrWidth),this.attrHeight&&this.tagSource.setAttribute("height",this.attrHeight)),this.tagImg=this.renderer.createElement("img"),this.tagImg&&(this.tagImg.alt=this.attrAlt,this.env.isBrowser&&this.loadingLazy&&this.tagImg.setAttribute("loading","lazy"),this.tagImg.setAttribute("alt",this.attrAlt),this.tagImg.setAttribute("data-okra-image-id",this._uniqueId),this.attrWidth&&this.tagImg.setAttribute("width",this.attrWidth),this.attrHeight&&this.tagImg.setAttribute("height",this.attrHeight)),"casual"===environment_settings.E.DEFAULT_IMAGE_PROTECTION&&(this.tagSource&&this.tagSource.setAttribute("draggable","false"),this.tagImg&&this.tagImg.setAttribute("draggable","false")),this.tagSource&&this.element.appendChild(this.tagSource),this.tagImg&&this.element.appendChild(this.tagImg),this.tagImg&&(this.tagImg.src=this._attrSrc,this._attrSrcset&&(this.tagImg.srcset=this._attrSrcset))}setNoScript(){if(this.isInitialized)this.noScriptImage&&(this.noScriptImage.src=this._attrSrc,this.noScriptImage.alt=this.attrAlt,this._attrSrcset&&(this.noScriptImage.srcset=this._attrSrcset));else{const noscript=this.renderer.createElement("noscript");this.noScriptImage=this.renderer.createElement("img"),this.noScriptImage&&(this.noScriptImage.src=this._attrSrc,this.noScriptImage.alt=this.attrAlt,this.loadingLazy&&this.noScriptImage.setAttribute("loading","lazy"),this._attrSrcset&&(this.noScriptImage.srcset=this._attrSrcset),noscript.appendChild(this.noScriptImage),this.element&&this.element.parentNode&&this.renderer.insertBefore(this.element.parentNode,noscript,this.renderer.nextSibling(this.element)),this.renderer.removeChild(this.element.parentElement,this.element))}}getWebpSrc(src){return src.replace(/\.(jpg|jpeg|png)$/,".webp")}roundUpSize(size){return 0===size?0:100*Math.pow(2,Math.max(0,Math.ceil(Math.log2(size/100))))}setDummyImage(){this.endSetDummyImage=!0,this.isPreLoaded||(this.closestPicture=this.element.closest("picture"),this.closestPicture?this.setDummyPicture():this.setDummyImg(),this.resizeDummyImage())}setDummyImg(){if(this.dummyWrapper)this.dummyImage&&(this.dummyImage.src=this._picture&&this.getImageUrl(this._picture,100)||"",this.dummyImage.alt=this.attrAlt,this.dummySrcset&&(this.dummyImage.srcset=this.dummySrcset));else{this.renderer.setStyle(this.element,"opacity","0"),this.renderer.setStyle(this.element,"transition","opacity 400ms ease 0ms");const dummyWrapper=this.renderer.createElement("span"),dummyImage=this.renderer.createElement("img"),src=this._picture?this.getImageUrl(this._picture,100):null;this.isBackgroundImage?this.renderer.setStyle(dummyImage,"background-image",`src(${src})`):(dummyImage.src=src,this.dummySrcset&&(dummyImage.srcset=this.dummySrcset)),dummyImage.alt=this.attrAlt,this.renderer.setStyle(dummyWrapper,"position","absolute"),this.renderer.setStyle(dummyWrapper,"pointer-events","none"),this.renderer.setStyle(dummyWrapper,"opacity","1"),this.renderer.setStyle(dummyWrapper,"display","block"),this.renderer.setStyle(dummyWrapper,"overflow","hidden"),this.renderer.setStyle(dummyWrapper,"transition","opacity 100ms 400ms, visibility 100ms 400ms"),this.renderer.setAttribute(dummyWrapper,"aria-hidden","true"),this.renderer.setStyle(dummyImage,"position","absolute"),this.renderer.setStyle(dummyImage,"left","0"),this.renderer.setStyle(dummyImage,"top","0"),this.renderer.setStyle(dummyImage,"width","100%"),this.renderer.setStyle(dummyImage,"height","100%"),this.renderer.setStyle(dummyImage,"transform","scale(1)"),this.renderer.setStyle(dummyImage,"filter","blur(10px)"),this.renderer.appendChild(dummyWrapper,dummyImage),this.dummyImage=dummyImage,this.dummyWrapper=dummyWrapper,this.renderer.insertBefore(this.element.parentNode,this.dummyWrapper,this.element),this.resizeObserver=new resize_observer.tb((entries=>{this.resizeDummyImage()})),this.resizeObserver.observe(this.element),(0,merge.h)(this.resizeSubject$,this.imageLazyLoadService.resizeSubject$).pipe((0,debounceTime.B)(100),(0,takeUntil.Q)(this.resizeEndSubject$),(0,takeUntil.Q)(this.unsubscriber$)).subscribe((_=>{this.resizeDummyImage()}))}}setDummyPicture(){this.dummyWrapper?(this.renderer.removeChild(this.dummyWrapper.parentNode,this.dummyWrapper),this.dummyWrapper=void 0):(this.renderer.setStyle(this.closestPicture,"opacity","0"),this.renderer.setStyle(this.closestPicture,"transition","opacity 400ms ease 0ms"));const dummyWrapper=this.renderer.createElement("span"),dummyImage=this.renderer.createElement("picture");Array.prototype.forEach.call(this.closestPicture?.children,(el=>{const tagName=el.tagName,uid=el.getAttribute("data-okra-image-id"),target=this.imageLazyLoadService.getImageInstance(uid),element=el.cloneNode(!1);element.removeAttribute("ng-reflect-image-id"),target&&target.dummySrcset&&(element.srcset=target.dummySrcset),target&&"IMG"===tagName&&(this._picture&&(element.src=target.getImageUrl(this._picture,100)),element.alt=this.attrAlt),this.renderer.appendChild(dummyImage,element)})),this.renderer.setStyle(dummyWrapper,"position","absolute"),this.renderer.setStyle(dummyWrapper,"pointer-events","none"),this.renderer.setStyle(dummyWrapper,"opacity","1"),this.renderer.setStyle(dummyWrapper,"display","block"),this.renderer.setStyle(dummyWrapper,"overflow","hidden"),this.renderer.setStyle(dummyWrapper,"transition","opacity 100ms 400ms, visibility 100ms 400ms"),this.renderer.setAttribute(dummyWrapper,"aria-hidden","true"),this.renderer.setStyle(dummyImage,"position","absolute"),this.renderer.setStyle(dummyImage,"left","0"),this.renderer.setStyle(dummyImage,"top","0"),this.renderer.setStyle(dummyImage,"transform","scale(1)"),this.renderer.setStyle(dummyImage,"filter","blur(10px)"),this.renderer.appendChild(dummyWrapper,dummyImage),this.dummyImage=dummyImage,this.dummyWrapper=dummyWrapper,this.renderer.insertBefore(this.closestPicture?.parentNode,this.dummyWrapper,this.closestPicture),this.dummyWrapper||(0,merge.h)(this.resizeSubject$,this.imageLazyLoadService.resizeSubject$).pipe((0,debounceTime.B)(100),(0,takeUntil.Q)(this.resizeEndSubject$),(0,takeUntil.Q)(this.unsubscriber$)).subscribe((_=>{this.resizeDummyImage()}))}resizeDummyImage(){if(this.closestPicture||(this.closestPicture=this.element.closest("picture")),this.closestPicture){const img=this.dummyWrapper?.querySelector("img"),imgStyle=this.window.getComputedStyle(this.element);"static"!==imgStyle.position&&(this.renderer.setStyle(img,"position",imgStyle.position),this.renderer.setStyle(img,"left",`${imgStyle.left}`),this.renderer.setStyle(img,"top",`${imgStyle.top}`)),this.renderer.setStyle(img,"transform",`${imgStyle.transform}`),this.renderer.setStyle(img,"margin",`${imgStyle.margin}`),this.renderer.setStyle(img,"width",`${imgStyle.width}`),this.renderer.setStyle(img,"height",`${imgStyle.height}`);const style=this.window.getComputedStyle(this.closestPicture);"fixed"===style.position||"sticky"===style.position?this.renderer.setStyle(this.dummyWrapper,"position",style.position):this.renderer.setStyle(this.dummyWrapper,"position","absolute"),"static"!==style.position&&(this.renderer.setStyle(this.dummyWrapper,"left",`${style.left}`),this.renderer.setStyle(this.dummyWrapper,"top",`${style.top}`));const width="auto"!==style.width?style.width:imgStyle.width,_width=parseInt(width,10),blur=_width<400?8:_width<600?10:_width<1200?12:14;this.renderer.setStyle(this.dummyWrapper,"transform",`${style.transform}`),this.renderer.setStyle(this.dummyWrapper,"margin",`${style.margin}`),this.renderer.setStyle(this.dummyWrapper,"width",`${width}`),this.renderer.setStyle(this.dummyWrapper,"height",`${"auto"!==style.height?style.height:imgStyle.height}`),this.renderer.setStyle(this.dummyImage,"filter",`blur(${blur}px)`)}else this.renderer.removeStyle(this.element,"position"),(0,of.of)(null).pipe((0,delay.c)(1),(0,takeUntil.Q)(this.unsubscriber$)).subscribe((_=>{const style=this.window.getComputedStyle(this.element);if("fixed"===style.position||"sticky"===style.position?this.renderer.setStyle(this.dummyWrapper,"position",style.position):this.renderer.setStyle(this.dummyWrapper,"position","absolute"),this.env.browser.ie&&"static"===style.position){const positionStyle={top:this.element.style.top||null,left:this.element.style.left||null,bottom:this.element.style.bottom||null,right:this.element.style.right||null};this.renderer.setAttribute(this.element,"data-okra-image-position-cache",`${JSON.stringify(positionStyle)}`),this.renderer.setStyle(this.element,"position","relative"),this.renderer.setStyle(this.element,"top","auto"),this.renderer.setStyle(this.element,"left","auto"),this.renderer.setStyle(this.element,"bottom","auto"),this.renderer.setStyle(this.element,"right","auto")}"static"!==style.position&&(this.renderer.setStyle(this.dummyWrapper,"left",`${style.left}`),this.renderer.setStyle(this.dummyWrapper,"top",`${style.top}`));const _width=parseInt(style.width,10),blur=_width<400?8:_width<600?10:_width<1200?12:14;this.renderer.setStyle(this.dummyWrapper,"transform",`${style.transform}`),this.renderer.setStyle(this.dummyWrapper,"margin",`${style.margin}`),this.renderer.setStyle(this.dummyWrapper,"width",`${style.width}`),this.renderer.setStyle(this.dummyWrapper,"height",`${style.height}`),this.renderer.setStyle(this.dummyImage,"filter",`blur(${blur}px)`)}))}removeDummyImage(){const element=this.closestPicture?this.closestPicture:this.element;this.renderer.setStyle(element,"opacity","1"),this.dummyWrapper&&(this.renderer.setStyle(element,"will-change","opacity"),this.renderer.setStyle(this.dummyWrapper,"opacity","0"),this.renderer.setStyle(this.dummyWrapper,"visibility","hidden"),(0,of.of)(null).pipe((0,delay.c)(500),(0,takeUntil.Q)(this.unsubscriber$)).subscribe((_=>{this.renderer.removeChild(this.dummyWrapper?.parentNode,this.dummyWrapper),this.renderer.removeStyle(element,"opacity"),this.renderer.removeStyle(element,"transition"),this.renderer.removeStyle(element,"will-change"),this.resizeObserver&&(this.resizeObserver.unobserve(this.element),this.resizeObserver.disconnect(),this.resizeObserver=void 0);const imagePositionCache=this.element.getAttribute("data-okra-image-position-cache");if(this.env.browser.ie&&imagePositionCache){const style=JSON.parse(imagePositionCache);this.renderer.removeStyle(this.element,"position");for(const position in style)style[position]?this.renderer.setStyle(this.element,position,style[position]):this.renderer.removeStyle(this.element,position)}}))),this.imageLazyLoadService.removeLoadAnimationImageInstances(this),this.resizeEndSubject$.next()}findImage(id){return Array.isArray(this.images)?this.images.find((pic=>pic.id===id)):this.images.get(id)}static{this.ctorParameters=()=>[{type:core.ElementRef},{type:core.Renderer2},{type:core.ChangeDetectorRef},{type:platform_browser.DomSanitizer},{type:env_service._},{type:OkraImageLazyLoadService},{type:void 0,decorators:[{type:core.Inject,args:[window_service.jf]}]}]}static{this.propDecorators={uniqueId:[{type:core.HostBinding,args:["attr.data-okra-image-id"]}],picture:[{type:core.Input,args:["okraImage"]}],size:[{type:core.Input}],src:[{type:core.Input}],width:[{type:core.Input}],height:[{type:core.Input}],alt:[{type:core.Input}],imageId:[{type:core.Input}],images:[{type:core.Input}],loadingLazy:[{type:core.Input}],loadingAnimation:[{type:core.Input}],srcset:[{type:core.Input}]}}};OkraImageDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraImage]",exportAs:"okraImage"}),(0,tslib_es6.Sn)("design:paramtypes",[core.ElementRef,core.Renderer2,core.ChangeDetectorRef,platform_browser.DomSanitizer,env_service._,OkraImageLazyLoadService,Object])],OkraImageDirective);let OkraLocaleLoaderDirective=class OkraLocaleLoaderDirective{constructor(el,localeService){this.el=el,this.localeService=localeService,this.loading=!0,this.subscriptions=[]}ngOnInit(){this.localeSettings=this.localeService.resolveLocale(),this.subscriptions.push(this.localeSettings.subscribe((x=>this.loading=!1)))}ngOnDestroy(){this.subscriptions.forEach((s=>s.unsubscribe()))}static{this.ctorParameters=()=>[{type:core.ElementRef},{type:OkraLocaleService}]}};OkraLocaleLoaderDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraLocaleLoader]",exportAs:"okraLocaleLoader"}),(0,tslib_es6.Sn)("design:paramtypes",[core.ElementRef,OkraLocaleService])],OkraLocaleLoaderDirective);let OkraStructuredDataService=class OkraStructuredDataService{constructor(rendererFactory,env,document){this.rendererFactory=rendererFactory,this.env=env,this.document=document,this.data=[],this.renderer=rendererFactory.createRenderer(null,null)}replaceQuote(target){if(Array.isArray(target))target.map((item=>this.replaceQuote(item)));else if(target&&"object"==typeof target)for(const[key,value]of Object.entries(target))"string"==typeof value?target[key]=value.replace(/"/g,"&quot;"):"object"==typeof value&&this.replaceQuote(value);return target}setData(setData,place){if(!this.env.isAdmin){if(!this.document.querySelector('script[type="application/ld+json"]')){const scriptElement=this.renderer.createElement("script");this.renderer.setAttribute(scriptElement,"type","application/ld+json"),this.renderer.appendChild(this.document.body,scriptElement)}place?(setData.place=place,this.data=this.data.filter((item=>item.place!==place))):this.data=this.data.filter((item=>"BreadcrumbList"===item["@type"]||item["@type"]!==setData["@type"])),this.data.push(this.replaceQuote(setData)),this.render()}}removeData(type,place){this.env.isAdmin||this.document.querySelector('script[type="application/ld+json"]')&&(type?this.data=place?this.data.filter((item=>item["@type"]!==type||item.place!==place)):this.data.filter((item=>item["@type"]!==type)):place&&(this.data=this.data.filter((item=>item.place!==place))),this.render())}removeAllData(){this.env.isAdmin||this.document.querySelector('script[type="application/ld+json"]')&&(this.data=[],this.render())}render(){let data=(0,lodash.cloneDeep)(this.data);data=data.map((item=>(delete item.place,item))),this.document.querySelector('script[type="application/ld+json"]').innerHTML=JSON.stringify(data)}static{this.ctorParameters=()=>[{type:core.RendererFactory2},{type:env_service._},{type:void 0,decorators:[{type:core.Inject,args:[common.DOCUMENT]}]}]}};OkraStructuredDataService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[core.RendererFactory2,env_service._,Object])],OkraStructuredDataService);let OkraMenuLoaderDirective=class OkraMenuLoaderDirective{constructor(el,menuService,structuredDataService){this.el=el,this.menuService=menuService,this.structuredDataService=structuredDataService,this.siteNavigation=!1,this.menu=new ReplaySubject.m(1),this.loading=!1,this.loaded=!1,this.unsubscriber$=new Subject.B}ngOnInit(){this.name?this.loadMenu():console.warn('There is unused OkraMenuLoaderDirective. Give it a "name" Input or remove it.')}loadMenu(){this.loading=!this.menuService.hasMenuCache(this.name),this.menuService.getMenu(this.name).pipe((0,takeUntil.Q)(this.unsubscriber$)).subscribe((_menu=>{this.loading=!1,this.loaded=!0,this.menu.next(_menu),this.siteNavigation&&this.structuredDataService.setData({"@context":"https://schema.org","@type":"ItemList",itemListElement:_menu.tree.map(((item,index)=>({"@type":"SiteNavigationElement",position:index+1,name:item.is_post?item.title:item.name_menu,url:item.url})))})}))}ngOnChanges(changes){changes.name.firstChange||this.name&&this.loadMenu()}ngOnDestroy(){this.unsubscriber$.next(),this.unsubscriber$.complete()}static{this.ctorParameters=()=>[{type:core.ElementRef},{type:OkraMenuService},{type:OkraStructuredDataService}]}static{this.propDecorators={name:[{type:core.Input}],siteNavigation:[{type:core.Input}]}}};OkraMenuLoaderDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraMenuLoader]",exportAs:"okraMenuLoader"}),(0,tslib_es6.Sn)("design:paramtypes",[core.ElementRef,OkraMenuService,OkraStructuredDataService])],OkraMenuLoaderDirective);var overlay=__webpack_require__("./node_modules/@angular/cdk/fesm2022/overlay.mjs"),portal=__webpack_require__("./node_modules/@angular/cdk/fesm2022/portal.mjs");let OkraModalDirective=class OkraModalDirective{constructor(el,overlay,vcRef,renderer,zone,cd){this.el=el,this.overlay=overlay,this.vcRef=vcRef,this.renderer=renderer,this.zone=zone,this.cd=cd,this.panelClass=[],this.closeButtonClass="okra-modal-close",this.hasBackdrop=!0,this.scrollStrategy="block",this.animateDuration=400,this.disabled=!1,this.disableClose=!1,this.openWhenClick=!0,this.closeOnNavigation=!0,this.isFullModal=!1,this.state=new core.EventEmitter,this.isOpened=!1,this.modalCloseSubject$=new Subject.B,this.unsubscriber$=new Subject.B}onClick(){!this.disabled&&this.openWhenClick&&this.openDialog()}ngOnInit(){if(!this.templateRef)return;const positionStrategy=this.overlay.position().global().centerHorizontally().centerVertically();let scrollStrategy;"block"===this.scrollStrategy?scrollStrategy=this.overlay.scrollStrategies.block():"reposition"===this.scrollStrategy?scrollStrategy=this.overlay.scrollStrategies.reposition():"close"===this.scrollStrategy?scrollStrategy=this.overlay.scrollStrategies.close():"noop"===this.scrollStrategy&&(scrollStrategy=this.overlay.scrollStrategies.noop());const panelClass=Array.isArray(this.panelClass)?this.panelClass:[this.panelClass].filter((v=>v));panelClass.push("okra-modal");const backdropClass=panelClass.map((c=>c+"-backdrop")),config=new overlay.rR({positionStrategy,scrollStrategy,panelClass,backdropClass,hasBackdrop:this.hasBackdrop});this.overlayRef=this.overlay.create(config),this.portal=new portal.VA(this.templateRef,this.vcRef)}ngOnChanges(){this.addFullModalClass()}ngOnDestroy(){this.modalCloseSubject$.complete(),this.unsubscriber$.next(),this.unsubscriber$.complete(),this.overlayRef?.dispose()}openDialog(){if(!this.isOpened&&this.overlayRef){if(this.portal?.isAttached)return this.isOpened=!0,void this.state.emit("open");this.portal?.attach(this.overlayRef),this.isOpened=!0,this.overlayRef.backdropClick().pipe((0,takeUntil.Q)(this.modalCloseSubject$),(0,takeUntil.Q)(this.unsubscriber$)).subscribe((_=>this.closeDialog())),this.zone.onStable.asObservable().pipe((0,take.s)(1),(0,delay.c)(0),(0,takeUntil.Q)(this.unsubscriber$)).subscribe((()=>{const closeButtonClass="string"==typeof this.closeButtonClass?`.${this.closeButtonClass},`:this.closeButtonClass.reduce(((acc,cur)=>acc+`.${cur},`),""),closeButtons=this.overlayRef.overlayElement.querySelectorAll(`${closeButtonClass}.okra-modal-cancel-button`);if(this.renderer.setAttribute(this.overlayRef.overlayElement,"role","dialog"),this.renderer.addClass(this.overlayRef.overlayElement,"okra-modal-is-shown"),this.hasBackdrop&&this.renderer.addClass(this.overlayRef.backdropElement,"okra-modal-is-shown"),this.listenAsObservable("document","keydown").pipe((0,filter.p)((event=>27===event.keyCode)),(0,takeUntil.Q)(this.modalCloseSubject$),(0,takeUntil.Q)(this.unsubscriber$)).subscribe((()=>{this.closeDialog()})),closeButtons.length>0)for(const closeButton of closeButtons)this.listenAsObservable(closeButton,"click").pipe((0,take.s)(1),(0,takeUntil.Q)(this.modalCloseSubject$),(0,takeUntil.Q)(this.unsubscriber$)).subscribe((event=>{event.stopPropagation(),event.preventDefault(),this.closeDialog()}));this.state.emit("open"),this.cd.detectChanges()}))}}closeDialog(){this.isOpened&&!this.disableClose&&this.overlayRef&&(this.isOpened=!1,this.modalCloseSubject$.next(),this.state.emit("close"),this.overlayRef.overlayElement&&(this.renderer.removeClass(this.overlayRef.overlayElement,"okra-modal-is-shown"),this.hasBackdrop&&this.renderer.removeClass(this.overlayRef.backdropElement,"okra-modal-is-shown"),(0,of.of)(null).pipe((0,delay.c)(this.animateDuration),(0,takeUntil.Q)(this.unsubscriber$)).subscribe((()=>{this.portal?.detach(),this.cd.detectChanges()}))))}addFullModalClass(){this.isFullModal&&this.renderer.addClass(this.overlayRef?.overlayElement,"-full-modal")}listenAsObservable(target,eventName){return new Observable.c((observer=>this.renderer.listen(target,eventName,(event=>observer.next(event)))))}static{this.ctorParameters=()=>[{type:core.ElementRef},{type:overlay.hJ},{type:core.ViewContainerRef},{type:core.Renderer2},{type:core.NgZone},{type:core.ChangeDetectorRef}]}static{this.propDecorators={templateRef:[{type:core.Input}],panelClass:[{type:core.Input}],closeButtonClass:[{type:core.Input}],hasBackdrop:[{type:core.Input}],scrollStrategy:[{type:core.Input}],animateDuration:[{type:core.Input}],disabled:[{type:core.Input}],disableClose:[{type:core.Input}],openWhenClick:[{type:core.Input}],closeOnNavigation:[{type:core.Input}],isFullModal:[{type:core.Input}],state:[{type:core.Output}],onClick:[{type:core.HostListener,args:["click"]}]}}};OkraModalDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraModal]",exportAs:"okraModal"}),(0,tslib_es6.Sn)("design:paramtypes",[core.ElementRef,overlay.hJ,core.ViewContainerRef,core.Renderer2,core.NgZone,core.ChangeDetectorRef])],OkraModalDirective);var combineLatest=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js"),fromEventPattern=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/fromEventPattern.js");let OkraMediaQueryListService=class OkraMediaQueryListService{constructor(zone,env,window){this.zone=zone,this.env=env,this.window=window,this.observables={},this.devices={}}installDevice(device,query){this.devices.hasOwnProperty(device)?console.warn(`Device "${device}" with query "${this.devices[device]}" is already installed.`):this.devices[device]=query}matchDevice(device,matchesOnSSR=!1){return this.devices.hasOwnProperty(device)?this.matches(this.devices[device],matchesOnSSR):(console.warn(`Device "${device}" not found.`),(0,of.of)(!0))}matchDevices(devices,matchesOnSSR=!1){return(0,combineLatest.z)(...devices.map((device=>this.matchDevice(device,matchesOnSSR))))}matches(query,matchesOnSSR=!1){let observable;if(this.env.isBrowser){const mql=this.window.matchMedia(query);mql&&(observable=(0,fromEventPattern.h)((listener=>{mql.addEventListener("change",(e=>this.zone.run((()=>listener(e)))))}),(listener=>{mql.removeEventListener("change",(e=>this.zone.run((()=>listener(e)))))})).pipe((0,map.T)((e=>mql.matches)),(0,startWith.Z)(mql.matches)))}else observable=(0,of.of)(matchesOnSSR);return this.observables[query]=observable,this.observables[query]}matchPwa(displayMode,matchesOnSSR=!1){const query="(display-mode: "+displayMode+")";if("browser"===displayMode||"fullscreen"===displayMode&&this.env.browser.pc)return(0,of.of)(!1);if(this.observables[query])return this.observables[query];let observable;if(this.env.isBrowser){const mql=this.window.matchMedia(query);observable=mql?(0,fromEventPattern.h)((listener=>{mql.addEventListener("change",(e=>this.zone.run((()=>listener(e)))))}),(listener=>{mql.removeEventListener("change",(e=>this.zone.run((()=>listener(e)))))})).pipe((0,map.T)((e=>mql.matches)),(0,startWith.Z)(mql.matches)):(0,of.of)({query:matchesOnSSR})}else observable=(0,of.of)({query:matchesOnSSR});return this.observables[query]=observable,this.observables[query]}static{this.ctorParameters=()=>[{type:core.NgZone},{type:env_service._},{type:void 0,decorators:[{type:core.Inject,args:[window_service.jf]}]}]}};OkraMediaQueryListService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[core.NgZone,env_service._,Object])],OkraMediaQueryListService);let OkraMqlDirective=class OkraMqlDirective{constructor(el,env,cd,mqlService){this.el=el,this.env=env,this.cd=cd,this.mqlService=mqlService,this.unsubscriber$=new Subject.B}matches(query,matchesOnSSR=!1){return this.mqlService.matches(query,matchesOnSSR).pipe((0,takeUntil.Q)(this.unsubscriber$))}matchDevice(device,matchesOnSSR=!1){return this.mqlService.matchDevice(device,matchesOnSSR).pipe((0,takeUntil.Q)(this.unsubscriber$))}mapByDevices(devices,values,matchesOnSSR=!1){(0,lodash.isString)(devices)&&(devices=devices.split("|").map((d=>d.trim()))),(0,lodash.isString)(values)&&(values=values.split("|").map((v=>{v=v.trim();try{return JSON.parse(v)}catch{return v}})));const minLength=Math.min(devices.length,values.length);return this.mqlService.matchDevices(devices,matchesOnSSR).pipe((0,map.T)((results=>{for(let i=0;i<minLength;i++)if(results[i])return values[i];return values[0]})),(0,takeUntil.Q)(this.unsubscriber$))}ngOnDestroy(){this.unsubscriber$.next(),this.unsubscriber$.complete()}static{this.ctorParameters=()=>[{type:core.ElementRef},{type:env_service._},{type:core.ChangeDetectorRef},{type:OkraMediaQueryListService}]}};OkraMqlDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraMql]",exportAs:"okraMql"}),(0,tslib_es6.Sn)("design:paramtypes",[core.ElementRef,env_service._,core.ChangeDetectorRef,OkraMediaQueryListService])],OkraMqlDirective);let OkraPaginatorDirective=class OkraPaginatorDirective{constructor(el,router,cd,activatedRoute,apiCache,categoryService,postService){this.el=el,this.router=router,this.cd=cd,this.activatedRoute=activatedRoute,this.apiCache=apiCache,this.categoryService=categoryService,this.postService=postService,this.id=null,this.category=null,this.page=null,this.loading=!1}resolveRequest(isNavigationEnd=!1){this.categoryService.getCategories().subscribe((categories=>{const request={},queryParams=this.activatedRoute.snapshot.queryParams;isNavigationEnd&&!queryParams[this.paginateUrlKey]||(null!==this.id&&(request.id=this.id),request.page=queryParams.hasOwnProperty(this.paginateUrlKey)?parseInt(queryParams[this.paginateUrlKey]):this.page||1,request.paginate=!0,null!==this.category&&((0,lodash.isArray)(this.category)?request.category=this.category:(0,lodash.isString)(this.category)?request.category=categories.filter((c=>c.name_url===this.category)).map((c=>c.id)):request.category=[this.category.id]),this.loading=!0,this.result=this.postService.getPagedPosts(request),this.resultSubscription=this.result.subscribe((res=>{this.loading=!1,this.cd.markForCheck()})))}))}ngOnInit(){this.urlSubscription=this.router.events.pipe((0,filter.p)((event=>event instanceof fesm2022_router.wF))).subscribe((event=>{this.resolveRequest(!0)})),this.resolveRequest()}ngOnDestroy(){this.urlSubscription.unsubscribe(),this.resultSubscription.unsubscribe()}static{this.ctorParameters=()=>[{type:core.ElementRef},{type:fesm2022_router.Ix},{type:core.ChangeDetectorRef},{type:fesm2022_router.nX},{type:OkraApiCacheService},{type:OkraCategoryService},{type:OkraPostService}]}static{this.propDecorators={id:[{type:core.Input}],category:[{type:core.Input}],paginateUrlKey:[{type:core.Input}],page:[{type:core.Input}]}}};OkraPaginatorDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraPaginator]",exportAs:"okraPaginator"}),(0,tslib_es6.Sn)("design:paramtypes",[core.ElementRef,fesm2022_router.Ix,core.ChangeDetectorRef,fesm2022_router.nX,OkraApiCacheService,OkraCategoryService,OkraPostService])],OkraPaginatorDirective);let OkraPostLoaderDirective=class OkraPostLoaderDirective{constructor(cd,postService,categoryService){this.cd=cd,this.postService=postService,this.categoryService=categoryService,this.id=null,this.slug=null,this.category=null,this.params={},this.isBlock=!1,this.isLoaded=!1,this.unsubscriber$=new Subject.B}ngOnInit(){this.post?(this.id?this.postContainer=this.postService.getPostById(this.id,{locale:this.post.locale_id}).pipe((0,takeUntil.Q)(this.unsubscriber$)):this.slug&&(this.postContainer=this.postService.getPostBySlug(this.slug,this.post.main_category_id,this.post.locale_id,{locale:this.post.locale_id}).pipe((0,takeUntil.Q)(this.unsubscriber$))),this.isLoaded=!1,this.postContainer.pipe((0,takeUntil.Q)(this.unsubscriber$)).subscribe((res=>{this.isLoaded=!0,this.cd.markForCheck()}))):this.resolveRequest()}ngOnChanges(changes){let hasFirstChange=!0;for(const key in changes)if(changes.hasOwnProperty(key)&&!changes[key].firstChange){hasFirstChange=!1;break}hasFirstChange||this.resolveRequest()}ngOnDestroy(){this.unsubscriber$.next(),this.unsubscriber$.complete()}resolveRequest(){this.postContainer=this.categoryService.getCategories().pipe((0,mergeMap.Z)((_categories=>{if(this.id&&this.slug&&console.warn("Duplicate inputs. Pleas specify either id or (slug + category)."),this.id){const params=this.isBlock?{...this.params,is_block:!0}:this.params;return this.postService.getPostById(this.id,params)}if(this.slug){let category_ids;if(this.isBlock){const params={...this.params,is_block:!0};return this.postService.getPostBySlug(this.slug,null,params)}return null===this.category?(console.error("When specifying Post using slug, it is also necessary to designate category's unique name at the same time."),never.t):(category_ids=(0,lodash.isString)(this.category)?_categories.filter((c=>(c.name_id||"").toLowerCase()===this.category.toLowerCase())).map((c=>c.id)):[this.category.id],category_ids.length<1?(console.error("There were no applicable category. Please specify the category instance or unique name of the category as the input of the category."),never.t):this.postService.getPostBySlug(this.slug,category_ids[0],this.params))}return console.error("To point out a post, you need to provide\n 1. id of the post or,\n 2. post's main category's id or unique name and the post's slug."),never.t}))),this.isLoaded=!1,this.postContainer.pipe((0,takeUntil.Q)(this.unsubscriber$)).subscribe((()=>{this.isLoaded=!0}))}static{this.ctorParameters=()=>[{type:core.ChangeDetectorRef},{type:OkraPostService},{type:OkraCategoryService}]}static{this.propDecorators={id:[{type:core.Input}],slug:[{type:core.Input}],category:[{type:core.Input}],params:[{type:core.Input}],post:[{type:core.Input}],isBlock:[{type:core.Input}]}}};OkraPostLoaderDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraPostLoader]",exportAs:"okraPostLoader"}),(0,tslib_es6.Sn)("design:paramtypes",[core.ChangeDetectorRef,OkraPostService,OkraCategoryService])],OkraPostLoaderDirective);let OkraPostsLoaderDirective=class OkraPostsLoaderDirective{get totalPages(){return this._totalPages}set totalPages(value){this._totalPages=value,this.cd.markForCheck()}get profileOutput(){return`  categories: ${this.categories}\n  params:\n`+Object.keys(this.params).map((key=>`    ${key}: ${this.params[key]}\n`)).join("")+`  paginate: ${this.paginate}`+`  page: ${this.page}`+`  unit: ${this.unit}`}get loading(){return this._loading}set loading(value){this._loading=value,this.cd.markForCheck()}constructor(cd,categoryService,postService,env){this.cd=cd,this.categoryService=categoryService,this.postService=postService,this.env=env,this.paginate=!1,this.page=1,this.unit=10,this.categoryOperator="or",this.excludeCategoryOperator="and",this.filterByCategory=!0,this.containContentProtection=!1,this.allowedNullParams=[],this._totalPages=1,this.requestSubject=new Subject.B,this.posts=new ReplaySubject.m(1),this.pages=new ReplaySubject.m(1),this.currentPage=new ReplaySubject.m(1),this.pagesLoaded=new ReplaySubject.m(1),this.paginationStatus=new ReplaySubject.m(1),this._loading=!1,this.unsubscriber$=new Subject.B,this.givenInputs=[],this.isFirstChangeFinished=!1,this.isCategoriesReady=!1,this.isExcludeCategoriesReady=!1}ngOnInit(){this.env.isServer}request(){const getCategories$=this.categoryService.getCategories(),nameIDs=this.toTagParamValue(this.categories);let getTags$;return getTags$=nameIDs?this.categoryService.getCategories({is_tag:"True",name_ids:nameIDs}):(0,of.of)([]),(0,zip.y)(getCategories$,getTags$).pipe((0,map.T)((([_categories,_tags])=>{const categoriesAndTags=[..._categories,..._tags];this.loading=!0;const isCategory=_category=>!!(0,lodash.isObject)(_category)&&_category.hasOwnProperty("id"),toCategoryId=_category=>{if((0,lodash.isNumber)(_category))return _category;if((0,lodash.isString)(_category)){const category=categoriesAndTags.find((c=>c.name_id.toLowerCase()===_category.toLowerCase()));return category?category.id:null}return isCategory(_category)?_category.id:null},toCategoryParamValue=_categoriesLike=>_categoriesLike?_categoriesLike.some((_categoryLike=>(0,lodash.isArray)(_categoryLike)))?_categoriesLike.map((_categoryLike=>{if((0,lodash.isNumber)(_categoryLike)||(0,lodash.isString)(_categoryLike)||isCategory(_categoryLike)){const categoryId=toCategoryId(_categoryLike);return categoryId?String(categoryId):null}return(0,lodash.isArray)(_categoryLike)?_categoryLike.map((c=>toCategoryId(c))).filter((c=>null!==c)).map((c=>String(c))).sort().join(","):null})).filter((c=>""!==c&&null!==c)).sort().join(":"):_categoriesLike.map((_categoryLike=>{const categoryId=toCategoryId(_categoryLike);return categoryId?String(categoryId):null})).filter((c=>""!==c&&null!==c)).sort().join(","):null,request={params:{...this.params,paginate:this.paginate,page:this.page,unit:this.unit}},categoriesQuery=toCategoryParamValue(this.categories),excludeCategoriesQuery=toCategoryParamValue(this.exclude_categories),outerOperator=this.filterByCategory?"":"or__",operatorSuffix="or"===this.categoryOperator?"":"__and",excludeOperatorSuffix="or"===this.excludeCategoryOperator?"":"__and";return categoriesQuery&&(request.params[`${outerOperator}category_id${operatorSuffix}`]=categoriesQuery),excludeCategoriesQuery&&(request.params[`${outerOperator}exclude__category_id${excludeOperatorSuffix}`]=excludeCategoriesQuery),this.requestSubject.next(request),request})),(0,first.$)(),(0,takeUntil.Q)(this.unsubscriber$))}init(){["and","or"].includes(this.categoryOperator)||(console.error('Use "and" or "or" to okraClientPostsLoader directive\'s \'operator\' value.'),this.categoryOperator="or"),this.paginate?this.requestSubject.pipe((0,scan.S)(((prev,next)=>(((_prev,_next)=>{const __prev=(0,lodash.cloneDeep)(_prev),__next=(0,lodash.cloneDeep)(_next);return __prev&&__prev.hasOwnProperty("page")&&delete __prev.page,__next&&__next.hasOwnProperty("page")&&delete __next.page,!(0,lodash.isEqual)(__prev,__next)})(prev.params||{},next.params||{})&&(this.page=prev.params?1:this.page,next.params&&(next.params.page=this.page),this.currentPage.next(null),next.reset=!0),(0,lodash.cloneDeep)(next))),{params:null}),(0,filter.p)((_=>!!this.categories)),(0,concatMap.H)((request=>this.containContentProtection?this.postService.getPagedContentProtectionPosts((0,lodash.cloneDeep)(request).params).pipe((0,map.T)((results=>[results,request.reset||!1]))):this.postService.getPagedPosts((0,lodash.cloneDeep)(request).params).pipe((0,map.T)((results=>[results,request.reset||!1]))))),(0,map.T)((([results,reset])=>(this.loading=!1,[[results],reset]))),(0,scan.S)((([results,_reset],[newResults,reset])=>{const _newResult=newResults[0];return this.totalPages=_newResult.paginationStatus?_newResult.paginationStatus.pages:1,this.paginationStatus.next(_newResult.paginationStatus||null),this.currentPage.next(_newResult),this.cd.detectChanges(),reset&&(results=[]),newResults.length>0&&newResults.forEach((__newResult=>{results.some((_oldResult=>(0,lodash.isEqual)(_oldResult,_newResult)))||results.push(_newResult)})),results.length>1&&results.sort(((r0,r1)=>r0.paginationStatus.page-r1.paginationStatus.page)),this.pagesLoaded.next(results.length>=this.totalPages),this.page=_newResult.paginationStatus?_newResult.paginationStatus.page:1,[results,!1]}),[[],!1]),(0,map.T)((([results,_])=>results)),(0,takeUntil.Q)(this.unsubscriber$)).subscribe((results=>{this.pages.next(results),this.cd.detectChanges()}),(err=>{this.pages.next([]),this.cd.detectChanges()})):this.requestSubject.pipe((0,filter.p)((_=>!!this.categories)),(0,concatMap.H)((request=>this.containContentProtection?this.postService.getContentProtectionPosts((0,lodash.cloneDeep)(request).params):this.postService.getPosts((0,lodash.cloneDeep)(request).params))),(0,map.T)((posts=>(this.loading=!1,posts))),(0,takeUntil.Q)(this.unsubscriber$)).subscribe((posts=>{this.posts.next(posts),this.cd.detectChanges()}),(err=>{this.posts.next([]),this.cd.detectChanges()}))}ngOnChanges(changes){if(this.isFirstChangeFinished)for(const key in changes)this.givenInputs.includes(key)||this.givenInputs.push(key);else for(const key in changes)["categories","params"].includes(key)||this.givenInputs.push(key);if("categories"in changes&&(this.isCategoriesReady=!!this.categories&&!this.categories.some((x=>[null,[null]].includes(x)))),(this.isCategoriesReady||!("categories"in this.givenInputs))&&("exclude_categories"in changes&&(this.isExcludeCategoriesReady=!!this.exclude_categories&&!this.exclude_categories.some((x=>[null,[null]].includes(x)))),this.isExcludeCategoriesReady||!("exclude_categories"in this.givenInputs))){for(const key in this.params)if(!this.params[key]&&!this.allowedNullParams.includes(key))return void console.error(`This is not an error but just to warn you that process cancelled this load because parameter "params['${key}']" is null.\nYou can force this by adding '${key}' to okraClientPostsLoader's [allowedNullParams] string array inputs.`+this.profileOutput);this.isFirstChangeFinished||(this.init(),this.isFirstChangeFinished=!0),this.request().pipe((0,first.$)(),(0,catchError.W)((err=>(0,of.of)()))).subscribe((_=>{}))}}loadMore(){this.loadPage(this.page+1)}loadPage(page){!this.paginate||this.loading||page<1||page>this.totalPages||(this.page=page,this.request().subscribe((_=>{})))}loadPrevPage(){1!==this.page&&this.loadPage(this.page-1)}loadNextPage(){this.page!==this.totalPages&&this.loadPage(this.page+1)}ngOnDestroy(){this.unsubscriber$.next(),this.unsubscriber$.complete()}isTag(_tag){return!!(0,lodash.isObject)(_tag)&&_tag.hasOwnProperty("id")}toTagNameId(_tag){return(0,lodash.isNumber)(_tag)?null:(0,lodash.isString)(_tag)?_tag:this.isTag(_tag)?_tag.name_id:null}toTagParamValue(_tagsLike){return _tagsLike?_tagsLike.some((_tagLike=>(0,lodash.isArray)(_tagLike)))?_tagsLike.map((_tagyLike=>{if((0,lodash.isNumber)(_tagyLike)||(0,lodash.isString)(_tagyLike)||this.isTag(_tagyLike)){const tagNameId=this.toTagNameId(_tagyLike);return tagNameId?String(tagNameId):null}return(0,lodash.isArray)(_tagyLike)?_tagyLike.map((c=>this.toTagNameId(c))).filter((c=>null!==c)).map((c=>String(c))).sort().join(","):null})).filter((c=>""!==c&&null!==c)).sort().join(":"):_tagsLike.map((_tagLike=>{const tagNameId=this.toTagNameId(_tagLike);return tagNameId?String(tagNameId):null})).filter((c=>""!==c&&null!==c)).sort().join(","):null}static{this.ctorParameters=()=>[{type:core.ChangeDetectorRef},{type:OkraCategoryService},{type:OkraPostService},{type:env_service._}]}static{this.propDecorators={categories:[{type:core.Input}],exclude_categories:[{type:core.Input}],params:[{type:core.Input}],paginate:[{type:core.Input}],page:[{type:core.Input}],unit:[{type:core.Input}],categoryOperator:[{type:core.Input}],excludeCategoryOperator:[{type:core.Input}],filterByCategory:[{type:core.Input}],containContentProtection:[{type:core.Input}],allowedNullParams:[{type:core.Input}]}}};OkraPostsLoaderDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraPostsLoader]",exportAs:"okraPostsLoader"}),(0,tslib_es6.Sn)("design:paramtypes",[core.ChangeDetectorRef,OkraCategoryService,OkraPostService,env_service._])],OkraPostsLoaderDirective);let OkraPwaService=class OkraPwaService{constructor(apiCache,mqlService,http){this.apiCache=apiCache,this.mqlService=mqlService,this.http=http,this.unsubscriber$=new Subject.B}getPwaSettings(){return this.apiCache.get("pwa/settings/")}getIsPwa(){return this.getPwaSettings().pipe((0,takeUntil.Q)(this.unsubscriber$),(0,mergeMap.Z)((settings=>this.mqlService.matchPwa(settings.display))))}getApiLastUpdate(){return this.http.get("last_update_check/")}isApiUpdate(){return this.getApiLastUpdate().pipe((0,map.T)((data=>{const previousCheckpoint=Date.parse(localStorage.getItem("apiLastUpdate")),latestCheckpoint=Date.parse(data.date);return!!(latestCheckpoint>previousCheckpoint||!previousCheckpoint&&latestCheckpoint||previousCheckpoint&&!latestCheckpoint)&&(latestCheckpoint&&localStorage.setItem("apiLastUpdate",data.date),!0)})))}static{this.ctorParameters=()=>[{type:OkraApiCacheService},{type:OkraMediaQueryListService},{type:OkraHttpService}]}};OkraPwaService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[OkraApiCacheService,OkraMediaQueryListService,OkraHttpService])],OkraPwaService);let OkraPwaDirective=class OkraPwaDirective{constructor(el,mqlService,pwaService){this.el=el,this.mqlService=mqlService,this.pwaService=pwaService,this.unsubscriber$=new Subject.B}matches(matchesOnSSR=!1){return this.pwaService.getPwaSettings().pipe((0,takeUntil.Q)(this.unsubscriber$),(0,mergeMap.Z)((settings=>this.mqlService.matchPwa(settings.display,matchesOnSSR))))}ngOnDestroy(){this.unsubscriber$.next(),this.unsubscriber$.complete()}static{this.ctorParameters=()=>[{type:core.ElementRef},{type:OkraMediaQueryListService},{type:OkraPwaService}]}};OkraPwaDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraPwa]",exportAs:"okraPwa"}),(0,tslib_es6.Sn)("design:paramtypes",[core.ElementRef,OkraMediaQueryListService,OkraPwaService])],OkraPwaDirective);var publishReplay=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/publishReplay.js"),refCount=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/refCount.js");let OkraStylerService=class OkraStylerService{constructor(env){this.env=env,this.initCollection=[],this.destroyCollection=[],this.enabled=this.env.isClient&&this.env.isBrowser,this.enabled&&(this.scrollStream=(0,fromEvent.R)(window,"scroll").pipe((0,publishReplay.H)(1),(0,refCount.B)()))}registerAfterInit(el){return this.enabled?(0,merge.h)((0,of.of)("init"),this.scrollStream).pipe((0,mergeMap.Z)((n=>"init"===n?(0,of.of)(n).pipe((0,delay.c)(700)):(0,of.of)(n))),(0,filter.p)((e=>el.nativeElement.getBoundingClientRect().top<window.innerHeight)),(0,take.s)(1)):never.t}static{this.ctorParameters=()=>[{type:env_service._}]}};OkraStylerService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[env_service._])],OkraStylerService);let OkraStyleOnDestroyDirective=class OkraStyleOnDestroyDirective{constructor(el,renderer,styler){this.el=el,this.renderer=renderer,this.styler=styler}ngOnInit(){}ngAfterViewInit(){}ngOnDestroy(){}static{this.ctorParameters=()=>[{type:core.ElementRef},{type:core.Renderer2},{type:OkraStylerService}]}};OkraStyleOnDestroyDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraStyleOnDestroy]",exportAs:"okraStyleOnDestroy"}),(0,tslib_es6.Sn)("design:paramtypes",[core.ElementRef,core.Renderer2,OkraStylerService])],OkraStyleOnDestroyDirective);let OkraStyleOnInitDirective=class OkraStyleOnInitDirective{constructor(zone,el,renderer,styler){this.zone=zone,this.el=el,this.renderer=renderer,this.styler=styler,this.okraStyleOnInit=!0,this.afterInitClass="okra-style-after-init",this.onScrollClass="okra-style-on-scroll",this.unsubscriber$=new Subject.B}ngAfterViewInit(){this.renderer.addClass(this.el.nativeElement,this.afterInitClass),this.zone.onStable.asObservable().pipe((0,take.s)(1)).subscribe((()=>{this.styler.registerAfterInit(this.el).pipe((0,takeUntil.Q)(this.unsubscriber$)).subscribe((()=>{this.renderer.addClass(this.el.nativeElement,this.onScrollClass)}))}))}ngOnDestroy(){this.unsubscriber$.next(),this.unsubscriber$.complete()}static{this.ctorParameters=()=>[{type:core.NgZone},{type:core.ElementRef},{type:core.Renderer2},{type:OkraStylerService}]}static{this.propDecorators={okraStyleOnInit:[{type:core.HostBinding,args:["class.okra-style-on-init"]}]}}};OkraStyleOnInitDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraStyleOnInit]",exportAs:"okraStyleOnInit"}),(0,tslib_es6.Sn)("design:paramtypes",[core.NgZone,core.ElementRef,core.Renderer2,OkraStylerService])],OkraStyleOnInitDirective);let OkraStyleToBottomDirective=class OkraStyleToBottomDirective{constructor(el,okraRouter,env,renderer,document,window){this.el=el,this.okraRouter=okraRouter,this.env=env,this.renderer=renderer,this.document=document,this.window=window,this.unsubscriber$=new Subject.B,this.el.nativeElement.style.visibility="hidden"}ngOnInit(){this.env.isServer||(this.okraRouter.routingResolved$.pipe((0,filter.p)((event=>event.changed)),(0,takeUntil.Q)(this.unsubscriber$)).subscribe((_=>{this.renderer.setStyle(this.el.nativeElement,"visibility","hidden")})),this.okraRouter.authInitGuard$.pipe((0,takeUntil.Q)(this.unsubscriber$)).subscribe((_=>{this.renderer.setStyle(this.el.nativeElement,"visibility","visible")})),this.okraRouter.transitionFinished$.pipe((0,filter.p)((event=>event.changed)),(0,takeUntil.Q)(this.unsubscriber$)).subscribe((_=>{this.renderer.setStyle(this.el.nativeElement,"visibility","visible")})))}ngOnDestroy(){this.unsubscriber$.next(),this.unsubscriber$.unsubscribe()}static{this.ctorParameters=()=>[{type:core.ElementRef},{type:OkraRouterService},{type:env_service._},{type:core.Renderer2},{type:Document,decorators:[{type:core.Inject,args:[common.DOCUMENT]}]},{type:Window,decorators:[{type:core.Inject,args:[window_service.jf]}]}]}};OkraStyleToBottomDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraStyleToBottom]",exportAs:"okraStyleToBottom"}),(0,tslib_es6.Sn)("design:paramtypes",[core.ElementRef,OkraRouterService,env_service._,core.Renderer2,Document,Window])],OkraStyleToBottomDirective);let OkraTranslationDirective=class OkraTranslationDirective{constructor(document,el,env,renderer,translationService,cd,zone,localeService){if(this.document=document,this.el=el,this.env=env,this.renderer=renderer,this.translationService=translationService,this.cd=cd,this.zone=zone,this.localeService=localeService,this.propValueAccesor="innerHTML",this.isOtherDragging=!1,this.unsubscriber$=new Subject.B,this.onChange=value=>{this.editedTranslation=value},this.onTouched=()=>{this.isActive=!1,this.el.nativeElement.blur(),this.cd.detectChanges(),this.editedTranslation&&this.editedTranslation!==this.translation&&this.translationService.updateTranslation(this.code,this.editedTranslation)},this.isActive=!1,this.env.isPreviewMode){this.translationService.update.subscribe((_=>{this.renderTranslation()}));const _style=this.el.nativeElement.getAttribute("style");!!_style&&_style.hasOwnProperty("text-decoration")&&"underline"===_style["text-decoration"]||this.translationService.editModeChange.subscribe((_editMode=>{_editMode?this.renderer.setStyle(this.el.nativeElement,"text-decoration","underline"):this.renderer.removeStyle(this.el.nativeElement,"text-decoration")}))}}get translation(){return this.translationService.translations.hasOwnProperty(this.code)?this.translationService.translations[this.code]:this.code}callOnChange(){"function"==typeof this.onChange&&this.onChange(this.el.nativeElement[this.propValueAccesor])}callOnTouched(){"function"==typeof this.onTouched&&this.onTouched()}onPaste(event){event.preventDefault();const html=event.clipboardData.getData("text/html");let text=event.clipboardData.getData("text/plain");if(html&&!/\n/.test(text)){const dummy=this.document.createElement("div");dummy.innerHTML=html;const style=dummy.querySelector("style"),script=dummy.querySelector("script");style&&dummy.removeChild(style),script&&dummy.removeChild(script),text=dummy.innerText.replace(/<!--[\s\S]*?-->/g,"").replace(/(\r\n){2,}|\r{2,}|\n{2,}/g,"\n").replace(/^\n|^\r|^\r\n/,"").replace(/\u200B|\u0323|\u2029|\u202A|\u0008/g,"")}text=text.replace(/\r?\n/g,"<br>");window.getSelection().getRangeAt(0);this.document.execCommand("insertHTML",!1,text)}writeValue(value){const VALUE=value||null;this.renderer.setProperty(this.el.nativeElement,this.propValueAccesor,VALUE)}setDisabledState(isDisabled){this.renderer.setProperty(this.el.nativeElement,"disabled",isDisabled)}renderTranslation(){this.el.nativeElement.textContent="",this.renderer.appendChild(this.el.nativeElement,this.renderer.createText(this.translation))}ngOnInit(){this.code=this.el.nativeElement.textContent.replace(/\s/g,""),this.renderTranslation(),this.eventListen()}ngAfterViewInit(){this.zone.runOutsideAngular((()=>{setTimeout((()=>{this.el.nativeElement.innerHTML=this.el.nativeElement.innerHTML.replace(/<(p|div)+.*?>([\s\S]*?)<\/(p|div)>/gi,"$2")}),0)}))}ngOnDestroy(){this.unsubscriber$.next(),this.unsubscriber$.complete()}onClick(){this.translationService.editMode&&!this.isActive&&(this.isActive=!0,this.cd.detectChanges(),this.el.nativeElement.focus(),setTimeout((()=>{if(0===String(window.getSelection()).length){const range=document.createRange(),first=this.el.nativeElement.childNodes[0];if(first){range.setStart(first,0),range.setEnd(first,0);const sel=window.getSelection();sel.removeAllRanges(),sel.addRange(range)}}}),0))}removeIllegalCode(){this.el.nativeElement.innerHTML=this.el.nativeElement.innerHTML.replace(/\u200B|\u0323|\u2029|\u202A|\u0008/g,""),"function"==typeof this.onChange&&this.onChange(this.el.nativeElement[this.propValueAccesor]),"function"==typeof this.onTouched&&this.onTouched()}eventListen(){this.zone.runOutsideAngular((()=>{this.listenAsObservable(this.el.nativeElement,"mouseenter").pipe((0,takeUntil.Q)(this.unsubscriber$)).subscribe((event=>{this.onMouseEnter()})),this.listenAsObservable(this.el.nativeElement,"click").pipe((0,takeUntil.Q)(this.unsubscriber$)).subscribe((event=>{event.shiftKey&&(event.preventDefault(),event.stopPropagation()),this.onClick()})),this.listenAsObservable(this.el.nativeElement,"keydown").pipe((0,takeUntil.Q)(this.unsubscriber$)).subscribe((event=>{this.onKeyDown(event)}))}))}onMouseEnter(){}onKeyDown(event){13===event.keyCode?(event.returnValue=!1,event.preventDefault()):8!==event.keyCode&&46!==event.keyCode||setTimeout((()=>{this.el.nativeElement.normalize(),""===this.el.nativeElement[this.propValueAccesor]&&this.document.execCommand("insertHTML",!1,this.code)}),0)}listenAsObservable(target,eventName){return new Observable.c((observer=>this.renderer.listen(target,eventName,(event=>observer.next(event)))))}static{this.ctorParameters=()=>[{type:void 0,decorators:[{type:core.Inject,args:[common.DOCUMENT]}]},{type:core.ElementRef},{type:env_service._},{type:core.Renderer2},{type:OkraTranslationService},{type:core.ChangeDetectorRef},{type:core.NgZone},{type:OkraLocaleService}]}static{this.propDecorators={isActive:[{type:core.HostBinding,args:["attr.contenteditable"]}],callOnChange:[{type:core.HostListener,args:["input"]}],callOnTouched:[{type:core.HostListener,args:["blur"]}],onPaste:[{type:core.HostListener,args:["paste",["$event"]]}]}}};OkraTranslationDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraTranslation]",providers:[{provide:fesm2022_forms.kq,useExisting:(0,core.forwardRef)((()=>OkraTranslationDirective)),multi:!0}],exportAs:"okraTranslation"}),(0,tslib_es6.Sn)("design:paramtypes",[Object,core.ElementRef,env_service._,core.Renderer2,OkraTranslationService,core.ChangeDetectorRef,core.NgZone,OkraLocaleService])],OkraTranslationDirective);var shaka_player_ui_debug=__webpack_require__("./node_modules/shaka-player/dist/shaka-player.ui.debug.js");const initStreamingPlayer=function(nativeElement,env,locale_slug){if(shaka_player_ui_debug.polyfill.installAll(),shaka_player_ui_debug.Player.isBrowserSupported())return initPlayer(nativeElement,env,locale_slug);console.error("This browser does not support Shaka player!")};function base64EncodeUint8Array(input){return btoa(function uInt8ArrayToString(array){return String.fromCharCode.apply(null,array)}(input))}function accessToken(){const accessToken=localStorage.getItem("access-token");return null!==accessToken?accessToken:""}function adminToken(){return null!==localStorage.getItem("admin-access-token")?localStorage.getItem("admin-access-token"):""}const initPlayer=function(){var _ref=(0,asyncToGenerator.A)((function*(nativeElement,env,locale_slug){const player=new shaka_player_ui_debug.Player(nativeElement);let USE_DRM;if(USE_DRM=!env.isLocal,USE_DRM&&(player.configure({drm:{servers:{"com.widevine.alpha":(0,functions.y0)("videos/drm_proxy",window),"com.apple.fps.1_0":(0,functions.y0)("videos/drm_proxy",window)}}}),(env?.browser?.chrome||env?.browser?.firefox||env?.browser?.edge)&&player.getNetworkingEngine().registerRequestFilter(((type,request)=>{type==shaka_player_ui_debug.net.NetworkingEngine.RequestType.LICENSE&&(request.headers["Content-Type"]="application/json",env?.isAdmin?request.headers.Authorization=`JWT ${adminToken()}`:accessToken()?.length>0&&(request.headers.Authorization=`Bearer ${accessToken()}`),request.body=JSON.stringify({data:base64EncodeUint8Array(new Uint8Array(request.body)),drm_type:"widevine"}))})),env?.browser?.safari)){let headers;env?.isAdmin?headers={headers:{Authorization:`JWT ${adminToken()}`}}:accessToken()?.length>0&&(headers={headers:{Authorization:`Bearer ${accessToken()}`}});const req=yield fetch((0,functions.y0)("videos/fps/getCertificate",window),headers),cert=yield req.arrayBuffer();player.configure({drm:{advanced:{"com.apple.fps.1_0":{serverCertificate:new Uint8Array(cert)}}}}),player.getNetworkingEngine().registerRequestFilter(((type,request)=>{type==shaka_player_ui_debug.net.NetworkingEngine.RequestType.LICENSE&&(request.headers["Content-Type"]="application/json",env?.isAdmin?request.headers.Authorization=`JWT ${adminToken()}`:accessToken()?.length>0&&(request.headers.Authorization=`Bearer ${accessToken()}`),request.body=JSON.stringify({data:{spc:base64EncodeUint8Array(new Uint8Array(request.body))},drm_type:"fairplay"}))})),player.getNetworkingEngine().registerResponseFilter(((type,response)=>{if(type!=shaka_player_ui_debug.net.NetworkingEngine.RequestType.LICENSE)return;let responseText=shaka_player_ui_debug.util.StringUtils.fromUTF8(response.data);responseText=responseText.trim();let responseObject=JSON.parse(responseText);response.data=function base64DecodeUint8Array(input){return Uint8Array.from(atob(input),(c=>c.charCodeAt(0)))}(responseObject.ckc)}))}return player.addEventListener("error",onErrorEvent),player}));return function initPlayer(_x,_x2,_x3){return _ref.apply(this,arguments)}}(),onErrorEvent=function(event){onError(event.detail)},onError=function(error){console.error("Error code",error.code,"object",error)},iconWrapStart='<span class="c-Icon -style-RoundStroke -style-Video">',selectionIconWrapStart='<span class="c-Icon -style-RoundStroke -style-Video -style-VideoSelection">',iconSVG={play:'\n  <div class="shaka-spinner">\n    <svg class="shaka-spinner-svg" viewBox="0 0 30 30" style="animation: unset;">\n      <circle class="shaka-spinner-path" cx="15" cy="15" r="14.5" fill="none" stroke-width="1" stroke-miterlimit="10" style="stroke: rgb(255, 255, 255); opacity: 0.6; animation: unset; stroke-dasharray: unset; stroke-width: 0.7px;"></circle>\n    </svg>\n  </div>\n  <div style="\n    border-bottom: 30px solid #FFFFFF;\n    border-right: 17px solid transparent;\n    border-left: 17px solid transparent;\n    transform: rotate(90deg);\n    position: absolute;\n    margin-left: 11px;\n    opacity: 0.7"\n    id="custom-shaka-play-button">\n  </div>',pause:'\n    <div class="shaka-spinner" style="display: flex; justify-content: center; align-items: center;">\n      <svg class="shaka-spinner-svg" viewBox="0 0 30 30" style="animation: unset;">\n        <circle class="shaka-spinner-path" cx="15" cy="15" r="14.5" fill="none" stroke-width="1" stroke-miterlimit="10" style="stroke: rgb(255, 255, 255); opacity: 0.6; animation: unset; stroke-dasharray: unset; stroke-width: 0.7px;"></circle>\n      </svg>\n      <div id="custom-shaka-pause-button-wrapper" style="display: flex; width: 29.68px; margin-left: 2px;">\n        <div style="background: rgb(255, 255, 255); width: 14.84px; height: 28.8px; opacity: 0.6; margin-right: 5px;" id="custom-shaka-pause-button"></div>\n        <div style="background: rgb(255, 255, 255); width: 14.84px; height: 28.8px; opacity: 0.6;" id="custom-shaka-pause-button"></div>\n      </div>\n    </div>',replay:`${iconWrapStart}<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M2.5 14C2.5 18.9706 6.75329 23 12 23C17.2467 23 21.5 18.9706 21.5 14C21.5 9.02944 17.2467 5 12 5L9.625 5" />\n  <path d="M12 1.5L8 5L12 8.5" />\n  </svg></span>`,skipForward:`${iconWrapStart}<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M22 12L12 18V6L22 12Z" class="fill"/>\n  <path d="M11 12L1 18V6L11 12Z" class="fill"/>\n  </svg></span>`,skipBackward:`${iconWrapStart}<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M2 12L12 6L12 18L2 12Z" class="fill"/>\n  <path d="M13 12L23 6V18L13 12Z" class="fill"/>\n  </svg></span>`,skipForwardLarge:`${iconWrapStart}<svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M38 20L20 31V9L38 20Z" class="fill"/>\n  <path d="M19 20L1 31V9L19 20Z" class="fill"/>\n  </svg></span>`,skipBackwardLarge:`${iconWrapStart}<svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M2 20L20 9L20 31L2 20Z" class="fill"/>\n  <path d="M21 20L39 9V31L21 20Z" class="fill"/>\n  </svg></span>`,unmuted:`${iconWrapStart}<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M13.9064 22C19.3645 16.4772 19.3645 7.52285 13.9064 2M9.95318 18C13.2281 14.6863 13.2281 9.31371 9.95318 6M6 14C7.09164 12.8954 7.09164 11.1046 6 10" />\n  </svg></span>`,muted:`${iconWrapStart}<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M13.9064 22C19.3645 16.4772 19.3645 7.52285 13.9064 2M9.95318 18C13.2281 14.6863 13.2281 9.31371 9.95318 6M6 14C7.09164 12.8954 7.09164 11.1046 6 10" />\n  <path d="M4 19L20 3" />\n  </svg></span>`,fullScreen:`${iconWrapStart}<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <g opacity="0.8">\n  <path d="M0 14V9H1.5V12.5H5V14H0ZM0 5V0H5V1.5H1.5V5H0ZM9 14V12.5H12.5V9H14V14H9ZM12.5 5V1.5H9V0H14V5H12.5Z" fill="white"/>\n  </g>\n  </svg></span>`,fullScreenExit:`${iconWrapStart}<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M3.5 14V10.5H0V9H2H5V12V14H3.5ZM0 5V3.5H3.5V0H5V2V5H2H0ZM9 14V12V9H12H14V10.5H10.5V14H9ZM12 5H9V2V0H10.5V3.5H14V5H12Z" fill="white"/>\n  </svg>\n  </span>`,menu:`${iconWrapStart}<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <circle class="fill" cx="12" cy="5" r="2" />\n  <circle class="fill" cx="12" cy="12" r="2" />\n  <circle class="fill" cx="12" cy="19" r="2" />\n  </svg></span>`,menuCaption:`${selectionIconWrapStart}<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M20.8 4H3.2C1.98497 4 1 5.02335 1 6.28571V17.7143C1 18.9767 1.98497 20 3.2 20H20.8C22.015 20 23 18.9767 23 17.7143V6.28571C23 5.02335 22.015 4 20.8 4Z" />\n  <path d="M5 16H19" />\n  </svg></span>`,menuResolution:`${selectionIconWrapStart}<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M3.68411 12.8617C3.65642 12.5783 3.64225 12.2909 3.64225 12C3.64225 11.7091 3.65642 11.4217 3.68411 11.1383L1.5 8.61695L3.88793 4.38305L7.11307 5.05864C7.56716 4.72305 8.05549 4.433 8.57168 4.19504L9.5 1H14.3879L15.4283 4.19504C15.9445 4.433 16.4328 4.72305 16.8869 5.05864L20.1121 4.38305L22.5 8.61695L20.3159 11.1383C20.3436 11.4217 20.3578 11.7091 20.3578 12C20.3578 12.2909 20.3436 12.5783 20.3159 12.8617L22.5 15.383L20.1121 19.6169L16.8869 18.9414C16.4328 19.2769 15.9445 19.567 15.4283 19.805L14.3879 23H9.61207L8.57168 19.805C8.05549 19.567 7.56716 19.2769 7.11307 18.9414L3.88793 19.6169L1.5 15.383L3.68411 12.8617Z" />\n  <path d="M12 14C13.1046 14 14 13.1046 14 12C14 10.8954 13.1046 10 12 10C10.8954 10 10 10.8954 10 12C10 13.1046 10.8954 14 12 14Z" />\n  </svg></span>`,menuLanguage:`${selectionIconWrapStart}<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" />\n  <path d="M12 21.5C14.6667 19.0758 16 16.2424 16 12C16 7.75758 14.6667 4.92424 12 2.5C9.33333 4.92424 8 7.75758 8 12C8 16.2424 9.33333 19.0758 12 21.5Z" />\n  <path d="M3 15H21M3 9H21H3Z" />\n  </svg></span>`,menuPip:`${selectionIconWrapStart}<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path class="fill" d="M19.1 11H11.9C11.4029 11 11 11.3838 11 11.8571V16.1429C11 16.6162 11.4029 17 11.9 17H19.1C19.5971 17 20 16.6162 20 16.1429V11.8571C20 11.3838 19.5971 11 19.1 11Z" />\n  <path d="M20.8 4H3.2C1.98497 4 1 5.02335 1 6.28571V17.7143C1 18.9767 1.98497 20 3.2 20H20.8C22.015 20 23 18.9767 23 17.7143V6.28571C23 5.02335 22.015 4 20.8 4Z" />\n  </svg></span>`,menuPipOff:`${selectionIconWrapStart}<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path fill-rule="evenodd" clip-rule="evenodd" class="fill" d="M3.2 4H20.8C22.015 4 23 5.02335 23 6.28571V17.7143C23 18.9767 22.015 20 20.8 20H3.2C1.98497 20 1 18.9767 1 17.7143V6.28571C1 5.02335 1.98497 4 3.2 4ZM11.9 11H19.1C19.5971 11 20 11.3838 20 11.8571V16.1429C20 16.6162 19.5971 17 19.1 17H11.9C11.4029 17 11 16.6162 11 16.1429V11.8571C11 11.3838 11.4029 11 11.9 11Z" />\n  </svg></span>`,menuPlaybackRate:`${selectionIconWrapStart}<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M13 3L22 12L13 21" />\n  <path d="M2 3L11 12L2 21" />\n  </svg></span>`,menuChosen:`${selectionIconWrapStart}<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M3 13.8571L8.4 19L21 7" />\n  </svg></span>`,backToOverflowButtons:`${selectionIconWrapStart}<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M9 5L2 12L9 19" />\n  <path d="M23 12H3" />\n  </svg></span>`},UI_COLORS={primary:[48,192,242],primary_on_dark:[48,192,242],secondary:[207,209,213],bg:[244,244,244],bg_accent:[255,255,255],bg_dark:[49,49,54],fg:[46,42,42],fg_on_primary:[255,255,255],fg_on_accent:[20,19,22],fg_on_dark:[212,224,224],fg_link:[0,163,251],success:[3,219,48],alert:[227,19,65],border_01:[46,42,42,.8],border_02:[46,42,42,.1],bg_table:[46,42,42,.06],border_form:[32,34,45,.08],bg_input:[32,34,45,.03],form_placeholder:[32,34,45,.6],form_focus:[22,23,22,.1],form_focus_alert:[227,19,65,.1],bg_form_shadow:[32,34,45,.07],form_label:[32,34,45,.8],bff_video_seek:[0,102,255]};function uiColor(name,opacity=null){return opacity?`rgba(${UI_COLORS[name].slice(0,3)}, ${opacity})`:`rgba(${UI_COLORS[name]})`}const initShakaUI=function(player,nativeElement,document_,shouldSetRadius){const nativeElement_=nativeElement.parentElement;createFullScreenButton(nativeElement_);const config={controlPanelElements:["time_and_duration","fullscreen"],overflowMenuButtons:["captions","language"],addSeekBar:!0,addBigPlayButton:!0,castReceiverAppId:"",clearBufferOnQualityChange:!0,showUnbufferedStart:!1,seekBarColors:{base:uiColor("bg_accent",.1),buffered:uiColor("bg_accent",.5),played:uiColor("bff_video_seek",.6),adBreaks:"rgb(255, 204, 0)"},volumeBarColors:{base:uiColor("fg_on_dark",.24),level:uiColor("fg_on_dark")},trackLabelFormat:shaka_player_ui_debug.ui.Overlay.TrackLabelFormat.LANGUAGE,fadeDelay:0,doubleClickForFullscreen:!0,enableKeyboardPlaybackControls:!0,enableFullscreenOnRotation:!0,forceLandscapeOnFullscreen:!0},ui=new shaka_player_ui_debug.ui.Overlay(player,nativeElement.parentNode,nativeElement);return ui.configure(config),customCurrentTime(nativeElement_),observeFullScreenButton(nativeElement_),customSeekBar(nativeElement_,shouldSetRadius),customLoading(nativeElement_),customVideoPlayer(nativeElement_,shouldSetRadius),ui},customVideoPlayer=function(element,shouldSetRadius){const shakaPlayButton=element.querySelector(".shaka-play-button");displayControlPlayButton(element,shakaPlayButton),shakaPlayButton.style.display="none",shakaPlayButton.style.justifyContent="center",shakaPlayButton.style.alignItems="center";element.querySelector(".shaka-controls-container[shown=true] .shaka-play-button").style.backgroundColor="transparent";element.querySelector(".shaka-play-button[icon=play]").style.backgroundImage="none";new MutationObserver((function(){var attribute=shakaPlayButton.getAttribute("icon"),shakaSpinnerContainer=element.querySelector(".shaka-spinner-container");"pause"===attribute?(shakaSpinnerContainer.innerHTML=iconSVG.pause,shakaSpinnerContainer.style.opacity="1",shakaSpinnerContainer.style.transition=".3s"):"play"===attribute&&(shakaSpinnerContainer.innerHTML=iconSVG.play,shakaSpinnerContainer.style.opacity="1"),shakaButtonResize(element)})).observe(shakaPlayButton,{attributes:!0}),controlTransparentColor(element);const videoDom=element.querySelector("video");shouldSetRadius&&(videoDom.style.borderRadius="5px");element.querySelector(".shaka-scrim-container").remove()},controlTransparentColor=function(element){const shakaServerSideAdContainer=element.querySelector(".shaka-server-side-ad-container"),shakaControlsContainer=element.querySelector(".shaka-controls-container"),seekBarContainer=element.querySelector(".shaka-bottom-controls > .shaka-seek-bar-container"),shakaButtonPanel=element.querySelector(".shaka-controls-button-panel");var shown=shakaControlsContainer.getAttribute("shown");if("true"===shown){shakaServerSideAdContainer.style.backgroundColor="#000",shakaServerSideAdContainer.style.opacity="0.11",shakaServerSideAdContainer.style.zIndex="0",shakaServerSideAdContainer.style.borderRadius="5px";element.querySelector("video").removeAttribute("controls")}else shakaServerSideAdContainer.style.backgroundColor="",shakaServerSideAdContainer.style.opacity="",shakaServerSideAdContainer.style.zIndex="";new MutationObserver((function(){shown=shakaControlsContainer.getAttribute("shown");var shakaSpinnerContainer=element.querySelector(".shaka-spinner-container");if("true"===shown){shakaServerSideAdContainer.style.backgroundColor="#000",shakaServerSideAdContainer.style.opacity="0.11",shakaServerSideAdContainer.style.transition=".5s",shakaServerSideAdContainer.style.zIndex="0",shakaServerSideAdContainer.style.borderRadius="5px",seekBarContainer.style.opacity="1",seekBarContainer.style.height=`${shakaButtonPanel.clientHeight}px`,shakaButtonPanel.style.display="flex",seekBarContainer.style.transition="",seekBarResize(element);element.querySelector("video").removeAttribute("controls")}else shakaServerSideAdContainer.style.opacity="0",shakaServerSideAdContainer.style.transition=".5s",shakaSpinnerContainer.style.opacity="0",shakaSpinnerContainer.style.transition=".5s",seekBarContainer.style.opacity="1",seekBarContainer.style.width=`${shakaServerSideAdContainer.clientWidth}px`,shakaButtonPanel.style.display="none",seekBarContainer.style.height="0px",setTimeout((()=>{seekBarContainer.style.height="10px",seekBarContainer.style.transition="height .5s linear .1s"}),0)})).observe(shakaControlsContainer,{attributes:!0,attributeFilter:["style","shown","icon"]});const shakaPlayButtonContainer=element.querySelector(".shaka-play-button-container");shakaPlayButtonContainer.style.zIndex="1",shakaPlayButtonContainer.style.display="none"},displayControlPlayButton=function(element,shakaPlayButton_){var shakaSpinnerContainer=element.querySelector(".shaka-spinner-container");shakaSpinnerContainer.style.opacity="0";new MutationObserver((function(){const className=(shakaSpinnerContainer=element.querySelector(".shaka-spinner-container")).className;if(-1!=className.indexOf("shaka-hidden")){shakaPlayButton_.style.display="flex",shakaSpinnerContainer.className=className.replace("shaka-hidden","");const shakaSpinner=element.querySelector(".shaka-spinner-path");shakaSpinner.style.stroke="#fff",shakaSpinner.style.opacity="0.6",shakaSpinner.style.animation="unset",shakaSpinner.style.strokeDasharray="unset",shakaSpinner.style.strokeWidth="0.7px",shakaSpinnerContainer.innerHTML=iconSVG.play}})).observe(shakaSpinnerContainer,{attributes:!0,attributeFilter:["class"]})},createFullScreenButton=function(element){const customFullScreenButton=class extends shaka_player_ui_debug.ui.FullscreenButton{constructor(parent,controls){super(parent,controls),this.button_.classList.add("-custom-full-screen-button"),this.button_.classList.add("c-Icon"),this.button_.classList.remove("material-icons-round"),this.button_.textContent="",this.updateIcon_()}updateIcon_(){this.button_.innerHTML=iconSVG.fullScreen;new MutationObserver((function(){const button=element.querySelector(".shaka-fullscreen-button"),attrValue=button.getAttribute("aria-label");button.innerHTML=""===attrValue?iconSVG.fullScreen:iconSVG.fullScreenExit})).observe(this.button_,{attributes:!0})}};customFullScreenButton.Factory=class{create(rootElement,controls){return new customFullScreenButton(rootElement,controls)}},shaka_player_ui_debug.ui.Controls.registerElement("fullscreen",new customFullScreenButton.Factory)},customSeekBar=function(element,shouldSetRadius){const shakaBottomControls=element.querySelector(".shaka-bottom-controls"),seekBarContainer=element.querySelector(".shaka-bottom-controls > .shaka-seek-bar-container"),seekButton=element.querySelector(".shaka-bottom-controls > .shaka-seek-bar-container > input"),seekBarInput=element.querySelector(".shaka-range-element"),shakaButtonPanel=element.querySelector(".shaka-controls-button-panel");shakaBottomControls.style.paddingBottom="0px",shakaBottomControls.style.width="100%",shakaBottomControls.style.merginBottom="2%",shakaBottomControls.style.display="flex",shakaBottomControls.style.flexDirection="row-reverse",shakaBottomControls.style.justifyContent="space-between",shouldSetRadius&&(shakaBottomControls.style.borderBottomLeftRadius="5px"),seekButton.style.height="100%",seekBarInput.style.top="0px",seekBarInput.style.opacity="0";const seekBarWidth=shakaBottomControls.clientWidth-48;seekBarContainer.style.width=`${seekBarWidth}px`,seekBarContainer.style.height=`${shakaButtonPanel.clientHeight}px`,seekBarContainer.style.margin="0px",seekBarContainer.style.borderRadius="inherit"},customLoading=function(element){const shakaSpinner=element.querySelector(".shaka-spinner-path");shakaSpinner.style.stroke="#fff",shakaSpinner.style.opacity="0.6"},customCurrentTime=function(element){const shakaCurrentTime=element.querySelector(".shaka-current-time");shakaCurrentTime.style.position="absolute",shakaCurrentTime.style.left="0",shakaCurrentTime.style.fontFamily="DM Mono, monospace",shakaCurrentTime.style.bottom="38px",shakaCurrentTime.style.fontSize="10px",shakaCurrentTime.style.height="20px",shakaCurrentTime.style.backgroundColor="#000",shakaCurrentTime.style.padding="6px"},observeFullScreenButton=function(element){const fullScreenButton=element.querySelector(".shaka-fullscreen-button"),className=fullScreenButton.className;if(-1!==className.indexOf("shaka-hidden")){const replaceName=className.replace("shaka-hidden","");fullScreenButton.className=replaceName}var observer=new MutationObserver((function(){const className=fullScreenButton.className;if(-1!==className.indexOf("shaka-hidden")){const replaceName=className.replace("shaka-hidden","");fullScreenButton.className=replaceName}}));observer.observe(fullScreenButton,{attributes:!0,childList:!0,subtree:!0})},seekBarResize=function(element){const shakaBottomControls=element.querySelector(".shaka-bottom-controls"),shakaButtonPanel=element.querySelector(".shaka-controls-button-panel"),seekBarContainer=element.querySelector(".shaka-bottom-controls > .shaka-seek-bar-container"),seekBarWidth=shakaBottomControls?.clientWidth-shakaButtonPanel?.clientWidth;seekBarContainer&&(seekBarContainer.style.width=`${seekBarWidth}px`)},shakaButtonResize=function(element){const shakaControlsContainer=element.querySelector(".shaka-controls-container"),shakaControlsContainerWidth=shakaControlsContainer?.clientWidth||0,bottomLength=.04*shakaControlsContainerWidth,shakaSpiner=element.querySelector(".shaka-spinner"),shakaSpinerHeight=shakaSpiner?.clientHeight||0,playMark=element.querySelector("#custom-shaka-play-button");if(playMark){const sideLength=.57*bottomLength;playMark.style.borderBottom=`${bottomLength}px solid #FFFFFF`,playMark.style.borderRight=`${sideLength}px solid transparent`,playMark.style.borderLeft=`${sideLength}px solid transparent`,playMark.style.marginLeft=.33*sideLength+"px"}const pauseMarkWrapper=element.querySelector("#custom-shaka-pause-button-wrapper"),pauseMarks=element.querySelectorAll("#custom-shaka-pause-button"),pauseWidth=.02*shakaControlsContainerWidth,pauseHeight=.3*shakaSpinerHeight,marginRight=shakaControlsContainerWidth*(5/742);pauseMarkWrapper&&pauseMarks&&(pauseMarkWrapper.style.width=`${bottomLength}px`,Array.prototype.forEach.call(pauseMarks,((element,i)=>{element.style.width=`${pauseWidth}px`,element.style.height=`${pauseHeight}px`,0===i&&(element.style.marginRight=`${marginRight}px`)})))};let OkraVideoStreamingDirective=class OkraVideoStreamingDirective{constructor(el,renderer,keyValueDiffers,env,localeService,document,window){this.el=el,this.renderer=renderer,this.keyValueDiffers=keyValueDiffers,this.env=env,this.localeService=localeService,this.document=document,this.window=window,this.startTime=0,this.shouldSetRadius=!0,this.unsubscriber$=new Subject.B,(0,fromEvent.R)(this.window,this.env.leaveEvent).pipe((0,takeUntil.Q)(this.unsubscriber$)).subscribe((_=>{this.saveCurrentTime()})),(0,fromEvent.R)(this.window,"resize").pipe((0,takeUntil.Q)(this.unsubscriber$)).subscribe((()=>{seekBarResize(this.el.nativeElement.parentElement),shakaButtonResize(this.el.nativeElement.parentElement)})),this.document.addEventListener("fullscreenchange",(()=>{seekBarResize(this.el.nativeElement.parentElement)}))}ngDoCheck(){if(!this.env.isBrowser)return;const changes=this.videoDiffer?.diff(this.video?this.video:{});if(changes)if(this.shakaPlayer){if(this.shakaPlayer.unload(),2===this.video?.transcode_status){let manifestFilePath;manifestFilePath=this.env.browser.safari?this.video.s3_manifest_file_path+"/hls_.m3u8":(this.env.browser.chrome||this.env.browser.firefox||this.env.browser.edge,this.video.s3_manifest_file_path+"/dash_.mpd"),this.shakaPlayer.load(manifestFilePath,this.startTime)}}else if(2===this.video?.transcode_status){initStreamingPlayer(this.el.nativeElement,this.env,this.localeService.currentLocale?.slug).then((shakaPlayer=>{let manifestFilePath;this.shakaPlayer=shakaPlayer,this.useUI&&(this.shakaUI=initShakaUI(this.shakaPlayer,this.el.nativeElement,document,this.shouldSetRadius)),manifestFilePath=this.env.browser.safari?this.video.s3_manifest_file_path+"/hls_.m3u8":(this.env.browser.chrome||this.env.browser.firefox||this.env.browser.edge,this.video.s3_manifest_file_path+"/dash_.mpd"),this.shakaPlayer.load(manifestFilePath,this.startTime)}))}}ngOnInit(){if(!this.env.isBrowser)return;const _playingList=localStorage.getItem("okra-video-playing-list");if(_playingList){const target=JSON.parse(_playingList).find((_data=>_data.id===this.video.id));this.startTime=target?target.currentTime:0}const video=this.video?this.video:{};this.videoDiffer=this.keyValueDiffers.find(video).create();this.videoDiffer.diff(video);if(2===this.video?.transcode_status){initStreamingPlayer(this.el.nativeElement,this.env,this.localeService.currentLocale?.slug).then((shakaPlayer=>{let manifestFilePath;this.shakaPlayer=shakaPlayer,this.useUI&&(this.shakaUI=initShakaUI(this.shakaPlayer,this.el.nativeElement,document,this.shouldSetRadius)),manifestFilePath=this.env.browser.safari?this.video.s3_manifest_file_path+"/hls_.m3u8":(this.env.browser.chrome||this.env.browser.firefox||this.env.browser.edge,this.video.s3_manifest_file_path+"/dash_.mpd"),this.shakaPlayer.load(manifestFilePath,this.startTime)}))}this.env.isBrowser&&!this.env.isAdmin&&(this.el.nativeElement.addEventListener("pause",(()=>this.saveCurrentTime())),this.el.nativeElement.addEventListener("ended",(()=>this.saveCurrentTime())))}ngOnDestroy(){this.saveCurrentTime(),this.shakaPlayer&&this.shakaPlayer.destroy(),this.shakaUI&&this.shakaUI.destroy(),this.unsubscriber$.next(),this.unsubscriber$.unsubscribe()}pause(){2===this.video?.transcode_status&&this.el.nativeElement.pause()}saveCurrentTime(){if(!this.env.isBrowser||this.env.isAdmin)return;const currentTime=this.el.nativeElement.currentTime;if(this.video?.duration-currentTime<1){const _playingList=localStorage.getItem("okra-video-playing-list");if(_playingList){const playingList=JSON.parse(_playingList).filter((_data=>_data.id!==this.video.id));localStorage.setItem("okra-video-playing-list",JSON.stringify(playingList))}}else if(currentTime>0){const data={id:this.video.id,currentTime};let playingList;const _playingList=localStorage.getItem("okra-video-playing-list");_playingList?(playingList=JSON.parse(_playingList).filter((_data=>_data.id!==this.video.id)),playingList.push(data)):playingList=[data],localStorage.setItem("okra-video-playing-list",JSON.stringify(playingList))}}static{this.ctorParameters=()=>[{type:core.ElementRef},{type:core.Renderer2},{type:core.KeyValueDiffers},{type:env_service._},{type:OkraLocaleService},{type:void 0,decorators:[{type:core.Inject,args:[common.DOCUMENT]}]},{type:void 0,decorators:[{type:core.Inject,args:[window_service.jf]}]}]}static{this.propDecorators={useUI:[{type:core.Input}],video:[{type:core.Input,args:["okraVideoStreaming"]}],shouldSetRadius:[{type:core.Input}]}}};OkraVideoStreamingDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraVideoStreaming]",exportAs:"okraVideoStreaming"}),(0,tslib_es6.Sn)("design:paramtypes",[core.ElementRef,core.Renderer2,core.KeyValueDiffers,env_service._,OkraLocaleService,Object,Object])],OkraVideoStreamingDirective);let OkraScriptInjectorService=class OkraScriptInjectorService{constructor(rendererFactory,document,env){this.rendererFactory=rendererFactory,this.document=document,this.env=env,this.injectedScripts=[],this.renderer=rendererFactory.createRenderer(null,null)}injectStruturedData(data){}hasConflict(script,key){return!!script.hasOwnProperty(key)&&this.injectedScripts.some((injected=>!!injected.hasOwnProperty(key)&&injected[key]===script[key]))}inject(script){return(0,from.H)(new Promise((resolve=>{setTimeout((()=>{const hasSrcConflict=this.hasConflict(script,"src"),hasIdConflict=this.hasConflict(script,"id");if(hasSrcConflict)resolve();else{if(hasIdConflict){const oldScriptElement=this.document.querySelector(`#${script.id}`);this.document.removeChild(oldScriptElement)}const scriptElement=this.renderer.createElement("script");Object.keys(script).forEach((attr=>{this.renderer.setAttribute(scriptElement,attr,script[attr])})),this.renderer.appendChild(this.document.head,scriptElement),this.injectedScripts.push(script),resolve()}}),0)})))}remove(script){const hasSrcConflict=this.hasConflict(script,"src"),src=script.src;if(src&&hasSrcConflict){const element=this.document.querySelector(`[src="${src}"]`);this.renderer.removeChild(this.document.head,element),this.injectedScripts=this.injectedScripts.filter((s=>s.src!==src))}}static{this.ctorParameters=()=>[{type:core.RendererFactory2},{type:void 0,decorators:[{type:core.Inject,args:[common.DOCUMENT]}]},{type:env_service._}]}};OkraScriptInjectorService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[core.RendererFactory2,Object,env_service._])],OkraScriptInjectorService);let OkraVimeoPlayerService=class OkraVimeoPlayerService{constructor(zone,scriptInjector,env,window){this.zone=zone,this.scriptInjector=scriptInjector,this.env=env,this.window=window,this.isReady=!1,this.timer=null,this.counter=0,this.ready$=new ReplaySubject.m(1)}loadApi(){return this.env.isServer||this.zone.runOutsideAngular((()=>{this.scriptInjector.inject({src:"//player.vimeo.com/api/player.js",type:"text/javascript"}),this.isReady?this.ready$.next():this.timer=this.window.setInterval((()=>{++this.counter,window.Vimeo?(null!==this.timer&&clearInterval(this.timer),this.timer=null,this.isReady=!0,this.ready$.next()):this.counter>=1200&&(null!==this.timer&&clearInterval(this.timer),this.timer=null)}),50)})),this.ready$.asObservable()}static{this.ctorParameters=()=>[{type:core.NgZone},{type:OkraScriptInjectorService},{type:env_service._},{type:Window,decorators:[{type:core.Inject,args:[window_service.jf]}]}]}};OkraVimeoPlayerService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[core.NgZone,OkraScriptInjectorService,env_service._,Window])],OkraVimeoPlayerService);let OkraVimeoPlayerDirective=class OkraVimeoPlayerDirective{constructor(el,cd,http,vimeoPlayer,env,document,window){this.el=el,this.cd=cd,this.http=http,this.vimeoPlayer=vimeoPlayer,this.env=env,this.document=document,this.window=window,this.hasThumbnail=!1,this.playerState=new core.EventEmitter,this.isCreated=!1,this.isInit=!0,this.unsubscriber$=new Subject.B,this.loadApiUnsubscriber$=new Subject.B}ngDoCheck(){this.isInit||(0,lodash.isEqual)(this._data,JSON.parse(JSON.stringify(this.data)))||(this.timer&&(clearTimeout(this.timer),this.timer=null),this.isCreated?(this.player.destroy(),this.isCreated=!1,this.createData(),this.data?.id&&(this.timer=setTimeout((()=>{this.timer=null,this.loadApi()}),0))):this.data?.id&&(this.createData(),this.timer=setTimeout((()=>{this.timer=null,this.loadApi()}),0)))}ngOnInit(){this.env.isServer||(this.isInit=!1,this.createData())}ngAfterViewInit(){this.loadApi(),this.createData()}ngOnDestroy(){this.player&&this.player.destroy().then((()=>{})),this.unsubscriber$.next(!0),this.unsubscriber$.unsubscribe(),this.loadApiUnsubscriber$.next(),this.loadApiUnsubscriber$.unsubscribe()}loadApi(){this.loadApiUnsubscriber$.next(),this.data?.id&&!this.env.isServer&&this.vimeoPlayer.loadApi().pipe((0,take.s)(1),(0,takeUntil.Q)(this.unsubscriber$),(0,takeUntil.Q)(this.loadApiUnsubscriber$)).subscribe((()=>{setTimeout((()=>{this.createPlayer()}),0)}))}createData(){this.env.isServer||(this._data=JSON.parse(JSON.stringify(this.data)),this.elementId=this.data?.id+String(Math.random().toString(36).slice(-8)),this.data?.id&&(this.getThumbnail(),this.cd.detectChanges()))}createPlayer(){const Vimeo=this.window.Vimeo;!this.env.isServer&&this.elementId&&this.document.getElementById(this.elementId)&&Vimeo&&(this.player=new Vimeo.Player(this.elementId,{id:this.data?.id,autoplay:!!this.data?.autoplay,loop:!!this.data?.loop,byline:!1,portrait:!1,title:!1,autopause:!0}),this.player.ready().then((()=>{this.isReady=!0,this.data?.isError&&delete this.data.isError,this.stateChange()})).catch((()=>{this.data&&(this.data.isError=!0),this.cd.detectChanges()})),this.isCreated=!0)}play(){this.isReady&&this.player.play()}stateChange(){this.player.on("play",(()=>{this.isPlaying=!0})),this.player.on("pause",(()=>{this.isPlaying=!1})),this.player.on("ended",(()=>{this.isPlaying=!1})),this.cd.detectChanges()}getThumbnail(){this.hasThumbnail&&this.http.get(`https://vimeo.com/api/oembed.json?url=https%3A//vimeo.com/${this.data?.id}`).pipe((0,takeUntil.Q)(this.unsubscriber$)).subscribe((data=>{this.thumbUrl=data.thumbnail_url,this.cd.detectChanges()}))}static{this.ctorParameters=()=>[{type:core.ElementRef},{type:core.ChangeDetectorRef},{type:OkraHttpService},{type:OkraVimeoPlayerService},{type:env_service._},{type:Document,decorators:[{type:core.Inject,args:[common.DOCUMENT]}]},{type:Window,decorators:[{type:core.Inject,args:[window_service.jf]}]}]}static{this.propDecorators={data:[{type:core.Input}],hasThumbnail:[{type:core.Input}],playerState:[{type:core.Output}]}}};OkraVimeoPlayerDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraVimeoPlayer]",exportAs:"okraVimeoPlayer"}),(0,tslib_es6.Sn)("design:paramtypes",[core.ElementRef,core.ChangeDetectorRef,OkraHttpService,OkraVimeoPlayerService,env_service._,Document,Window])],OkraVimeoPlayerDirective);let OkraYoutubePlayerService=class OkraYoutubePlayerService{constructor(zone,scriptInjector,env){this.zone=zone,this.scriptInjector=scriptInjector,this.env=env,this.isReady=!1,this.ready$=new ReplaySubject.m(1)}loadApi(){return this.env.isServer||this.zone.runOutsideAngular((()=>{this.scriptInjector.inject({src:"//www.youtube.com/iframe_api",type:"text/javascript"}),this.isReady?this.ready$.next():window.onYouTubeIframeAPIReady=()=>{this.isReady=!0,this.ready$.next()}})),this.ready$.asObservable()}createPlayer(config){return new window.YT.Player(config.elementId,{videoId:config.videoId,playerVars:config.playerVars,events:config.events})}static{this.ctorParameters=()=>[{type:core.NgZone},{type:OkraScriptInjectorService},{type:env_service._}]}};OkraYoutubePlayerService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"}),(0,tslib_es6.Sn)("design:paramtypes",[core.NgZone,OkraScriptInjectorService,env_service._])],OkraYoutubePlayerService);let OkraYoutubePlayerDirective=class OkraYoutubePlayerDirective{constructor(zone,el,renderer,cd,youtubePlayer,okraRouter,env){this.zone=zone,this.el=el,this.renderer=renderer,this.cd=cd,this.youtubePlayer=youtubePlayer,this.okraRouter=okraRouter,this.env=env,this.hasThumbnail=!1,this.playerState=new core.EventEmitter,this.isCreated=!1,this.isInit=!0,this.unsubscriber$=new Subject.B,this.loadApiUnsubscriber$=new Subject.B,this.loadedApi$=new ReplaySubject.m(1)}ngDoCheck(){this.isInit||(0,lodash.isEqual)(this._data,JSON.parse(JSON.stringify(this.data)))||(this.isCreated?(this.isCreated=!1,this.player.destroy(),this.createData()):this.createData(),this.data.id&&setTimeout((()=>{this.loadApi()}),0))}ngOnInit(){this.isInit=!1,this.createData(),this.youtubePlayer.loadApi().pipe((0,takeUntil.Q)(this.unsubscriber$)).subscribe((_=>{this.loadedApi$.next(!0)}))}ngAfterViewInit(){this.loadApi()}ngOnDestroy(){this.unsubscriber$.next(!0),this.unsubscriber$.unsubscribe(),this.loadApiUnsubscriber$.next(),this.loadApiUnsubscriber$.unsubscribe()}createData(){this._data=JSON.parse(JSON.stringify(this.data)),this.elementId=this.data.id+String(Math.random().toString(36).slice(-8)),this.thumbUrl=`https://i.ytimg.com/vi/${this.data.id}/maxresdefault.jpg`,this.data.id&&(this.checkThumbnail("maxresdefault"),this.cd.markForCheck())}loadApi(){this.data.id&&this.loadedApi$.pipe((0,takeUntil.Q)(this.unsubscriber$),(0,takeUntil.Q)(this.loadApiUnsubscriber$),(0,filter.p)((_=>!!_))).subscribe((_=>{setTimeout((()=>{this.createPlayer(),this.loadApiUnsubscriber$.next()}),0)}))}createPlayer(){this.player=this.youtubePlayer.createPlayer({elementId:this.elementId,videoId:this.data.id,playerVars:{autoplay:void 0!==this.data.autoplay&&this.data.autoplay?1:0,controls:void 0!==this.data.controls&&this.data.controls?0:2,loop:void 0!==this.data.loop&&this.data.loop?1:0,playlist:void 0!==this.data.loop&&this.data.loop?this.data.id:null,rel:0},events:{onReady:event=>{this.isReady=!0,this.data.mute&&event.target.mute()},onStateChange:state=>{this.stateChange(state),this.playerState.emit(state)}}}),this.isCreated=!0,this.env.isClient&&this.okraRouter.routingResolved$.pipe((0,filter.p)((event=>this.player.getPlayerState()===window.YT.PlayerState.PLAYING)),(0,takeUntil.Q)(this.unsubscriber$)).subscribe((event=>{this.player.pauseVideo()}))}play(){this.isReady&&this.player.playVideo()}stateChange(state){state.data===window.YT.PlayerState.PLAYING?this.isPlaying=!0:state.data!==window.YT.PlayerState.PAUSED&&state.data!==window.YT.PlayerState.ENDED||(this.isPlaying=!1),this.cd.detectChanges()}checkThumbnail(size){!this.env.isServer&&this.hasThumbnail&&this.zone.runOutsideAngular((()=>{const IMG=new Image;IMG.src=`https://i.ytimg.com/vi/${this.data.id}/${size}.jpg`,this.listenAsObservable(IMG,"load").pipe((0,takeUntil.Q)(this.unsubscriber$)).subscribe((event=>{if(IMG.width<=120&&"default"!==size)switch(size){case"maxresdefault":this.checkThumbnail("sddefault");break;case"sddefault":this.checkThumbnail("hqdefault");break;case"hqdefault":this.checkThumbnail("mqdefault");break;case"mqdefault":this.checkThumbnail("default")}else this.thumbUrl=`https://i.ytimg.com/vi/${this.data.id}/${size}.jpg`;this.cd.detectChanges()}))}))}listenAsObservable(target,eventName){return new Observable.c((observer=>this.renderer.listen(target,eventName,(event=>observer.next(event)))))}static{this.ctorParameters=()=>[{type:core.NgZone},{type:core.ElementRef},{type:core.Renderer2},{type:core.ChangeDetectorRef},{type:OkraYoutubePlayerService},{type:OkraRouterService},{type:env_service._}]}static{this.propDecorators={data:[{type:core.Input}],hasThumbnail:[{type:core.Input}],playerState:[{type:core.Output}]}}};OkraYoutubePlayerDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraYoutubePlayer]",exportAs:"okraYoutubePlayer"}),(0,tslib_es6.Sn)("design:paramtypes",[core.NgZone,core.ElementRef,core.Renderer2,core.ChangeDetectorRef,OkraYoutubePlayerService,OkraRouterService,env_service._])],OkraYoutubePlayerDirective);let okraRemoveInFeedDirective=class okraRemoveInFeedDirective{constructor(window){this.window=window,this.requestFromFeed=!1}isFromFeed(){return(0,functions.Us)(window)}static{this.ctorParameters=()=>[{type:void 0,decorators:[{type:core.Inject,args:[window_service.jf]}]}]}};okraRemoveInFeedDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[okraRemoveInFeed]",exportAs:"okraRemoveInFeed"}),(0,tslib_es6.Sn)("design:paramtypes",[Object])],okraRemoveInFeedDirective);const OKRA_DIRECTIVE_PROVIDERS=[OkraBindCheckerDirective,OkraBreadcrumbsDirective,OkraCarouselDirective,OkraCmsUsersLoaderDirective,OkraElasticSearchDirective,OkraElementEraserDirective,OkraFormPostLoaderDirective,OkraFragmentDirective,OkraGuestDirective,OkraImageDirective,OkraLocaleLoaderDirective,OkraMenuLoaderDirective,OkraModalDirective,OkraMqlDirective,OkraPaginatorDirective,OkraPostLoaderDirective,OkraPostsLoaderDirective,OkraPwaDirective,okraRemoveInFeedDirective,OkraStyleOnDestroyDirective,OkraStyleOnInitDirective,OkraStyleToBottomDirective,OkraTranslationDirective,OkraVideoStreamingDirective,OkraVimeoPlayerDirective,OkraYoutubePlayerDirective];var ui=__webpack_require__("./.src/storybook/storybook_admin/lib/modules/ui/index.ts");let StorybookSharedModule=class StorybookSharedModule{constructor(platformId,appId,ngModuleRef){this.platformId=platformId,this.appId=appId,this.ngModuleRef=ngModuleRef}static{this.ctorParameters=()=>[{type:Object,decorators:[{type:core.Inject,args:[core.PLATFORM_ID]}]},{type:String,decorators:[{type:core.Inject,args:[core.APP_ID]}]},{type:core.NgModuleRef}]}};StorybookSharedModule=(0,tslib_es6.Cg)([(0,core.NgModule)({imports:[ui.r],declarations:[...OKRA_DIRECTIVE_PROVIDERS],exports:[...OKRA_DIRECTIVE_PROVIDERS],providers:[...window_service.GG,{provide:common.APP_BASE_HREF,useValue:document?.location.pathname.startsWith((0,functions.uJ)("/",environment_settings.E.PREVIEW_PATH))?`/${environment_settings.E.PREVIEW_PATH}/`:environment_settings.E.APP_BASE_HREF?environment_settings.E.APP_BASE_HREF:"/"}],schemas:[core.NO_ERRORS_SCHEMA]}),(0,tslib_es6.Sn)("design:paramtypes",[Object,String,core.NgModuleRef])],StorybookSharedModule)},"./.src/storybook/storybook_admin/lib/utils/functions.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{BM:()=>apiImageUrl,D9:()=>getCurrencyCode,Kh:()=>parseCookie,RU:()=>enableLogs,TZ:()=>asOperator,Us:()=>requestFromFeed,_A:()=>parseParameters,aG:()=>logHooksOp,ew:()=>isReservedFormUrl,jD:()=>safeJsonParse,lL:()=>mergeOptions,mS:()=>checkSupportWebp,nG:()=>logHooks,of:()=>waitAsync,ok:()=>authApiUrl,q:()=>isInternalLink,sX:()=>jsonStringify,uJ:()=>joinPath,uT:()=>itemToAlignedQuery,y0:()=>apiUrl,z3:()=>isBlank});var _Users_yoyam_repos_akari_BicycleFilmFestival_core_view_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_environment_settings__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./.src/storybook/storybook_admin/environment/settings.ts"),lodash__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/lodash/lodash.js"),rxjs__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Observable.js"),rxjs__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subscription.js"),rxjs_operators__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/tap.js");const joinPath=(...parts)=>parts.join("////").replace(/\/{4,}/g,"/"),requestFromFeed=_window=>!!_window.requestFromFeed,isLocalDevelopment=()=>["dev","local","storybook"].includes(_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.TARGET_ENV),isLocalKube=_window=>_window.location.hostname.endsWith(".local"),reservedFormUrls=(new Set([":","/","?","#","[","]","@","!","$","&","'","(",")","*","+",",",";","=","."]),(()=>{const paths=[_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.API_PATH,_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.AUTH_API_PATH,_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.AMP_PATH,_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.EMAIL_PATH];_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.TAG_PATH&&paths.push(_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.TAG_PATH),_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.USE_PERSON_PAGE&&paths.push(_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.PERSON_PAGE_PATH),_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.USE_GENERAL_USER&&paths.push(_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.MYPAGE_PATH?_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.MYPAGE_PATH:"mypage")})(),["login","signup","forgot-password","reset-password","reset-password-success","withdraw","withdraw-success","signup-email-sent","signup-activate-success","signup-activate-failure","forgot-password-email-sent","invitation","invitation-success","change-email-verification","orders","subscriptions","ticket-bills"]),isReservedFormUrl=path=>reservedFormUrls.includes(path),apiUrl=(endpoint,_window,isEmailApi=!1)=>{const origin=_window.origin?_window.origin:_window.location.origin;let apiPath=_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.API_PATH+(isEmailApi?"/"+_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.EMAIL_PATH:"");const isRequestFromPuppeteer=(_window=>Boolean(_window.document&&_window.document.isPuppeteer))(_window),_isLocalKube=isLocalKube(_window);if(isRequestFromPuppeteer){if(_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.IS_KUBE_ENV&&!isLocalDevelopment())return(_window=>Boolean(_window.document&&_window.document.isLambda))(_window)?joinPath(`http://${_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.API_HOST}`,apiPath,endpoint):joinPath(`http://${_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.API_HOST}:${_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.API_PORT}`,apiPath,endpoint);if(_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.API_HOST?.startsWith("host.docker.internal"))return joinPath(`http://${_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.API_HOST}`,apiPath,endpoint)}if((_window=>!!_window.needCacheUpdate)(_window)||requestFromFeed(_window)||_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.IS_EMAIL||isRequestFromPuppeteer)return joinPath(`http://localhost:${_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.API_PORT}`,apiPath,endpoint);if(isLocalDevelopment()&&!_isLocalKube){const hostname=origin.replace(/^(https?:)?\/\//,"").split(":")[0];return joinPath(`http://${hostname}:${_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.API_PORT}`,apiPath,endpoint)}return apiPath=(_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.APP_BASE_HREF&&"/"!==_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.APP_BASE_HREF&&"local"!==_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.ENV?_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.APP_BASE_HREF+"/":"")+_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.API_PATH+(isEmailApi?"/"+_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.EMAIL_PATH:""),joinPath(origin,apiPath,endpoint)},authApiUrl=(endpoint,isAdmin)=>isAdmin?joinPath(apiUrl("/",window),_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.AUTH_API_PATH,"tn",endpoint):joinPath(apiUrl("/",window),_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.AUTH_API_PATH,endpoint),_getPicturePath=(picture,size,isAdmin,isPwaIcons=!1)=>{console.log("picture",picture);const pictureWidth=picture.width||1600;let picSize=size;isPwaIcons?picSize=size:(picSize>0&&picSize>pictureWidth||0===picSize)&&(picSize=pictureWidth);let endpoint=`${picture.file_path}/${picSize}/${encodeURIComponent(picture.file_name||"")}`;if(!picture.is_public&&isAdmin){endpoint+=`?token=${null!==localStorage.getItem("admin-access-token")?localStorage.getItem("admin-access-token"):""}`}return endpoint},apiImageUrl=(picture,size,isAdmin,_window,isPwaIcons=!1)=>{if(!picture)return"";const origin=_window.origin?_window.origin:_window.location.origin,endpoint=_getPicturePath(picture,size,isAdmin,isPwaIcons);if(isLocalDevelopment()&&!isLocalKube(_window)){const hostname=origin.replace(/^(https?:)?\/\//,"").split(":")[0];return joinPath(`http://${hostname}:${_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.API_PORT}`,_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.API_PATH,isAdmin?`${_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.PREVIEW_PATH}/image`:"image",`${endpoint}`)}return joinPath(_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.ASSET_UPLOAD_URL,isAdmin?`${_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.PREVIEW_PATH}/image`:"image",`${endpoint}`)},alignArrayByValue=a=>{const b=[];return a.sort().forEach((val=>{["string","number","boolean"].includes(typeof val)?b.push(val):val instanceof Array?b.push(alignArrayByValue(val)):val instanceof Object&&b.push(alignObjectByKeys(val))})),b},alignObjectByKeys=a=>{const b={};return Object.keys(a).sort().forEach((key=>{const val=a[key];["string","number","boolean"].includes(typeof val)?b[key]=val:val instanceof Array?b[key]=alignArrayByValue(val):val instanceof Object&&(b[key]=alignObjectByKeys(val))})),b},alignItem=a=>a instanceof Array?alignArrayByValue(a):a instanceof Object?alignObjectByKeys(a):a,itemToAlignedQuery=a=>Object.keys(alignItem(a)).map((key=>{const val=a[key];return(0,lodash__WEBPACK_IMPORTED_MODULE_1__.isArray)(val)?val.map((element=>`${encodeURIComponent(key)}=${encodeURIComponent(element)}`)).join("&"):`${encodeURIComponent(key)}=${encodeURIComponent(val)}`})).join("&"),isInternalLink=url=>{if(new RegExp("^(?!http)(/|[A-Za-z0-9])").test(url))return!0;return new RegExp(`^${window.origin}`).test(url)},safeDecodeURIComponent=str=>{try{return decodeURIComponent(str)}catch(e){return str}},safeJsonParse=str=>{try{return JSON.parse(str)}catch(e){return str}},jsonStringify=obj=>JSON.stringify(obj,((k,v)=>v instanceof Map?{dataType:"Map",value:[...v]}:v)),isBlank=obj=>null==obj||""===obj,isPresent=obj=>null!=obj,mergeOptions=(oldOptions,newOptions)=>newOptions?{path:isPresent(newOptions.path)?newOptions.path:oldOptions.path,domain:isPresent(newOptions.domain)?newOptions.domain:oldOptions.domain,expires:isPresent(newOptions.expires)?newOptions.expires:oldOptions.expires,secure:isPresent(newOptions.secure)?newOptions.secure:oldOptions.secure,storeUnencoded:isPresent(newOptions.storeUnencoded)?newOptions.storeUnencoded:oldOptions.storeUnencoded}:oldOptions,parseCookie=cookieString=>{let cookieArray,index,name,lastCookies={},lastCookieString="";cookieString=cookieString||"";return cookieString!==lastCookieString&&(lastCookieString=cookieString,cookieArray=lastCookieString.split("; "),lastCookies={},cookieArray.forEach((cookie=>{index=cookie.indexOf("="),index>0&&(name=safeDecodeURIComponent(cookie.substring(0,index)),isBlank(lastCookies[name])&&(lastCookies[name]=safeDecodeURIComponent(cookie.substring(index+1))))}))),lastCookies};console.log;const enableLogs=()=>{_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.SHOW_HOOKS=!0},logHooks=(...args)=>{_environment_settings__WEBPACK_IMPORTED_MODULE_0__.E.SHOW_HOOKS&&console.log(...args)},parseParameters=params=>params.split("&").reduce(((obj,v)=>{const pair=v.split("=");return pair[0]&&(obj[pair[0]]=pair[1]),obj}),{});function asOperator(...pipes){return source=>new rxjs__WEBPACK_IMPORTED_MODULE_2__.c((subscriber=>{const subscription=new rxjs__WEBPACK_IMPORTED_MODULE_3__.yU;return subscription.add(pipes.reduce(((obs,op)=>obs.pipe(op)),source).subscribe(subscriber)),subscription}))}const logHooksOp=(...args)=>asOperator((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_4__.M)((item=>logHooks(...args,item))));function waitAsync(_x){return _waitAsync.apply(this,arguments)}function _waitAsync(){return(_waitAsync=(0,_Users_yoyam_repos_akari_BicycleFilmFestival_core_view_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_5__.A)((function*(millisec){return new Promise((resolve=>{setTimeout((()=>{resolve()}),millisec)}))}))).apply(this,arguments)}const checkSupportWebp=function(){var _ref=(0,_Users_yoyam_repos_akari_BicycleFilmFestival_core_view_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_5__.A)((function*(){if(!self.createImageBitmap)return!1;const blob=yield fetch("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=").then((r=>r.blob()));return createImageBitmap(blob).then((()=>!0),(()=>!1))}));return function checkSupportWebp(){return _ref.apply(this,arguments)}}(),getCurrencyCode=locale=>{if(locale&&locale.country){const country_code=locale.country.code;return"jp"==country_code?"JPY":"USD"}return"USD"}},"../ts-utils/dist/electron.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var process=__webpack_require__("./node_modules/process/browser.js");exports.IO=exports.Q2=void 0;let _isElectron=!1;try{_isElectron=!!process.versions.electron}catch(err){}exports.Q2=class IpcCommand{static WINDOW_RELOAD="window_reload";static INIT="init";static SET_CLIENT_TOKEN="set_client_token";static REVOKE_CLIENT_TOKEN="revoke_client_token";static REFRESH_CLIENT_TOKEN="refresh_client_token";static SET_ADMIN_TOKEN="set_admin_token";static REVOKE_ADMIN_TOKEN="revoke_admin_token";static REFRESH_ADMIN_TOKEN="refresh_admin_token";static TOO_MANY_DEVICE_DETECTED="too_many_device_detected";static TEST="test";static TEST2="test2";static TEST3="test3";static LS="ls";static SUDO_LS="sudo_ls";static SELECT_FILE="select_file";static FFMPEG="ffmpeg";static FFPROBE="ffprobe";static FFMPEG_IMAGE2="ffmpeg_image2";static FFMPEG_SAMPLE_AUDIO="ffmpeg_sample_audio";static DCP_MOVIE_INFO="dcp_movie_info";static DCP_INIT_TASK="dcp_init_task";static DCP_VIDEO_TASK="dcp_video_task";static UPLOAD_AUDIO_CHANNEL="upload_audio_channel";static UPLOAD_VIDEO_CHUNK="upload_video_chunk";static TEST_API="test_api";static TOKEN_REFRESH="token_refresh"};exports.IO=(windowId,channel,requestId)=>{if(channel.indexOf(".")>=0)throw Error(`Channel "${channel}" cannot contain "."`);return`${windowId}.${channel}.${requestId}`}},"../ts-utils/dist/errors.js":(__unused_webpack_module,exports)=>{"use strict";function formatErrorMessage(err){return err instanceof AppError?`${err.timestamp}\nCODE: ${err.code}\nMESSAGE: ${err.message}\nSTACK: ${err.stack}\n`:`NAME: ${err.name}\nMESSAGE: ${err.message}\nSTACK: ${err.stack}\n`}exports.cy=exports.uV=exports.xX=exports.O4=void 0,function(ErrorCode){ErrorCode.NOT_LOGGED_IN="NOT_LOGGED_IN",ErrorCode.FORBIDDEN="FORBIDDEN",ErrorCode.REFRESH_TOKEN_FAILED="REFRESH_TOKEN_FAILED",ErrorCode.MAKE_DIRECTORY_FAILED="MAKE_DIRECTORY_FAILED",ErrorCode.VIDEO_FRAME_DOES_NOT_MATCH="VIDEO_FRAME_DOES_NOT_MATCH",ErrorCode.VIDEO_KEYFRAME_NOT_FOUND="VIDEO_KEYFRAME_NOT_FOUND",ErrorCode.VIDEO_KEYFRAME_FIND_ERROR="VIDEO_KEYFRAME_FIND_ERROR",ErrorCode.INVALID_VIDEO_INDEX="INVALID_VIDEO_INDEX",ErrorCode.INVALID_AUDIO_CHANNEL_COUNT="INVALID_AUDIO_CHANNEL_COUNT",ErrorCode.FFPROBE_FPS_NOT_AVAILABLE="FFPROBE_FPS_NOT_AVAILABLE",ErrorCode.FFPROBE_FPS_NOT_ADJUSTED="FFPROBE_FPS_NOT_ADJUSTED",ErrorCode.FFPROBE_DURATION_NOT_AVAILABLE="FFPROBE_DURATION_NOT_AVAILABLE",ErrorCode.FFPROBE_TOTAL_FRAME_NOT_AVAILABLE="FFPROBE_TOTAL_FRAME_NOT_AVAILABLE",ErrorCode.FFPROBE_AUDIO_DURATION_NOT_AVAILABLE="FFPROBE_AUDIO_DURATION_NOT_AVAILABLE",ErrorCode.FAILED_TO_SLICE_VIDEO="FAILED_TO_SLICE_VIDEO",ErrorCode.AUDIO_EXTRACT_STREAM_ERROR="AUDIO_EXTRACT_STREAM_ERROR",ErrorCode.AUDIO_EXTRACT_CHANNEL_ERROR="AUDIO_EXTRACT_CHANNEL_ERROR",ErrorCode.VIDEO_EXTRACT_ERROR="VIDEO_EXTRACT_ERROR",ErrorCode.FILE_INFO_ERROR="FILE_INFO_ERROR",ErrorCode.FAILED_TO_REQUEST_PRESIGNED_URL="FAILED_TO_REQUEST_PRESIGNED_URL",ErrorCode.FAILED_TO_FETCH_PRESIGNED_URL="FAILED_TO_FETCH_PRESIGNED_URL",ErrorCode.FAILED_TO_UPLOAD_WITH_PRESIGNED_URL="FAILED_TO_UPLOAD_WITH_PRESIGNED_URL",ErrorCode.FAILED_TO_UPDATE_FILE_TASK="FAILED_TO_UPDATE_FILE_TASK",ErrorCode.AUTH_LOGOUT="AUTH_LOGOUT",ErrorCode.INCORRECT_USER="INCORRECT_USER",ErrorCode.AUTH_INVALID_LOGIN="AUTH_INVALID_LOGIN",ErrorCode.AUTH_MAX_DEVICE_EXCEEDED="AUTH_MAX_DEVICE_EXCEEDED",ErrorCode.AUTH_409="AUTH_409",ErrorCode.AUTH_TOKEN_INVALID_OR_EXPIRED="AUTH_TOKEN_INVALID_OR_EXPIRED",ErrorCode.AUTH_INCORRECT_PASSWORD="AUTH_INCORRECT_PASSWORD",ErrorCode.CERTIFICATION_CODE_REQUIRED="CERTIFICATION_CODE_REQUIRED",ErrorCode.CERTIFICATION_CODE_INVALID="CERTIFICATION_CODE_INVALID",ErrorCode.CERTIFICATION_CODE_EXPIRED="CERTIFICATION_CODE_EXPIRED",ErrorCode.PASSWORD_IS_REQUIRED_FOR_PASSWORD_RESET="PASSWORD_IS_REQUIRED_FOR_PASSWORD_RESET",ErrorCode.AUTH_PASSWORD_NOT_STRONG="AUTH_PASSWORD_NOT_STRONG",ErrorCode.AUTH_EMAIL_ALREADY_EXISTS="AUTH_EMAIL_ALREADY_EXISTS",ErrorCode.ACTIVATION_CODE_REQUIRED="ACTIVATION_CODE_REQUIRED",ErrorCode.ACTIVATION_CODE_INVALID="ACTIVATION_CODE_INVALID",ErrorCode.ACTIVATION_CODE_EXPIRED="ACTIVATION_CODE_EXPIRED",ErrorCode.COLLABORATOR_NOT_FOUND="COLLABORATOR_NOT_FOUND",ErrorCode.PAYMENT_LOGOUT="PAYMENT_LOGOUT",ErrorCode.STRIPE_RATE_LIMIT="STRIPE_RATE_LIMIT",ErrorCode.INVALID_STRIPE_API_PARAM="INVALID_STRIPE_API_PARAM",ErrorCode.INVALID_STRIPE_API_KEY="INVALID_STRIPE_API_KEY",ErrorCode.STRIPE_API_CONNECTION_FAILED="STRIPE_API_CONNECTION_FAILED",ErrorCode.REGISTER_FAILED_WITH_CARD_EXPIRATION="REGISTER_FAILED_WITH_CARD_EXPIRATION",ErrorCode.REGISTER_FAILED_WITH_INVALID_CARD="REGISTER_FAILED_WITH_INVALID_CARD",ErrorCode.PAYMENT_FAILED_WITH_USER_REASON="PAYMENT_FAILED_WITH_USER_REASON",ErrorCode.PAYMENT_FAILED_WITH_CARD_EXPIRATION="PAYMENT_FAILED_WITH_CARD_EXPIRATION",ErrorCode.PAYMENT_FAILED_WITH_WRONG_CVC="PAYMENT_FAILED_WITH_WRONG_CVC",ErrorCode.PAYMENT_FAILED_WITH_SYSTEM_ERROR="PAYMENT_FAILED_WITH_SYSTEM_ERROR",ErrorCode.PAYMENT_FAILED_WITH_3DSECURE_ERROR="PAYMENT_FAILED_WITH_3DSECURE_ERROR",ErrorCode.OTHER_CARD_ERROR="OTHER_CARD_ERROR",ErrorCode.GENERAL_STRIPE_ERROR="GENERAL_STRIPE_ERROR",ErrorCode.PAYMENT_NOT_IN_SALES="PAYMENT_NOT_IN_SALES",ErrorCode.PAYMENT_LOCALE_DOES_NOT_MATCH="PAYMENT_LOCALE_DOES_NOT_MATCH",ErrorCode.PAYMENT_ORDERED="PAYMENT_ORDERED",ErrorCode.FEED_SETTINGS_NOT_SET="FEED_SETTINGS_NOT_SET",ErrorCode.UNKNOWN_ERROR="UNKNOWN_ERROR"}(exports.O4||(exports.O4={})),exports.xX=function stackError(oldError,newError){return newError.descents=oldError instanceof AppError?[oldError,...oldError.descents]:[oldError],newError};class AppError extends Error{timestamp=new Date;code;descents=[];hints={};_message;constructor(code,message,hints={}){super(message+"\n"+(Object.entries(hints).map((([key,value])=>`${key}:\n${JSON.stringify(value,null,2)}`)).join("\n")||"")),this._message=message,this.hints=hints,this.code=code,this.timestamp=new Date,Object.setPrototypeOf(this,new.target.prototype)}addHints(hints){const newHints={...this.hints,...hints};return new AppError(this.code,this._message,newHints)}formatReport(){return this.descents.map((e=>formatErrorMessage(e))).join("\n---------stack----------\n")+"\n---------stack----------\n"+formatErrorMessage(this)}}exports.uV=AppError;const serializeGeneralError=error=>JSON.stringify({name:error.name,message:error.message,stack:error.stack}),serializeAppError=error=>JSON.stringify({code:error.code,message:error.message,_message:error._message,stack:error.stack,hints:error.hints,descents:error.descents.map((e=>e instanceof AppError?serializeAppError(e):serializeGeneralError(e)))});exports.cy=error=>{const deserialized=JSON.parse(error);if(deserialized.hasOwnProperty("_message")){const appError=new AppError(deserialized.code,deserialized._message,deserialized.hints);for(const e of deserialized.descents)e.hasOwnProperty("_message")?appError.descents.push((0,exports.cy)(JSON.stringify(e))):appError.descents.push(new Error(e.message));return appError}return new Error(deserialized.message)}},"./node_modules/moment/locale sync recursive ^\\.\\/.*$":(module,__unused_webpack_exports,__webpack_require__)=>{var map={"./af":"./node_modules/moment/locale/af.js","./af.js":"./node_modules/moment/locale/af.js","./ar":"./node_modules/moment/locale/ar.js","./ar-dz":"./node_modules/moment/locale/ar-dz.js","./ar-dz.js":"./node_modules/moment/locale/ar-dz.js","./ar-kw":"./node_modules/moment/locale/ar-kw.js","./ar-kw.js":"./node_modules/moment/locale/ar-kw.js","./ar-ly":"./node_modules/moment/locale/ar-ly.js","./ar-ly.js":"./node_modules/moment/locale/ar-ly.js","./ar-ma":"./node_modules/moment/locale/ar-ma.js","./ar-ma.js":"./node_modules/moment/locale/ar-ma.js","./ar-sa":"./node_modules/moment/locale/ar-sa.js","./ar-sa.js":"./node_modules/moment/locale/ar-sa.js","./ar-tn":"./node_modules/moment/locale/ar-tn.js","./ar-tn.js":"./node_modules/moment/locale/ar-tn.js","./ar.js":"./node_modules/moment/locale/ar.js","./az":"./node_modules/moment/locale/az.js","./az.js":"./node_modules/moment/locale/az.js","./be":"./node_modules/moment/locale/be.js","./be.js":"./node_modules/moment/locale/be.js","./bg":"./node_modules/moment/locale/bg.js","./bg.js":"./node_modules/moment/locale/bg.js","./bm":"./node_modules/moment/locale/bm.js","./bm.js":"./node_modules/moment/locale/bm.js","./bn":"./node_modules/moment/locale/bn.js","./bn-bd":"./node_modules/moment/locale/bn-bd.js","./bn-bd.js":"./node_modules/moment/locale/bn-bd.js","./bn.js":"./node_modules/moment/locale/bn.js","./bo":"./node_modules/moment/locale/bo.js","./bo.js":"./node_modules/moment/locale/bo.js","./br":"./node_modules/moment/locale/br.js","./br.js":"./node_modules/moment/locale/br.js","./bs":"./node_modules/moment/locale/bs.js","./bs.js":"./node_modules/moment/locale/bs.js","./ca":"./node_modules/moment/locale/ca.js","./ca.js":"./node_modules/moment/locale/ca.js","./cs":"./node_modules/moment/locale/cs.js","./cs.js":"./node_modules/moment/locale/cs.js","./cv":"./node_modules/moment/locale/cv.js","./cv.js":"./node_modules/moment/locale/cv.js","./cy":"./node_modules/moment/locale/cy.js","./cy.js":"./node_modules/moment/locale/cy.js","./da":"./node_modules/moment/locale/da.js","./da.js":"./node_modules/moment/locale/da.js","./de":"./node_modules/moment/locale/de.js","./de-at":"./node_modules/moment/locale/de-at.js","./de-at.js":"./node_modules/moment/locale/de-at.js","./de-ch":"./node_modules/moment/locale/de-ch.js","./de-ch.js":"./node_modules/moment/locale/de-ch.js","./de.js":"./node_modules/moment/locale/de.js","./dv":"./node_modules/moment/locale/dv.js","./dv.js":"./node_modules/moment/locale/dv.js","./el":"./node_modules/moment/locale/el.js","./el.js":"./node_modules/moment/locale/el.js","./en-au":"./node_modules/moment/locale/en-au.js","./en-au.js":"./node_modules/moment/locale/en-au.js","./en-ca":"./node_modules/moment/locale/en-ca.js","./en-ca.js":"./node_modules/moment/locale/en-ca.js","./en-gb":"./node_modules/moment/locale/en-gb.js","./en-gb.js":"./node_modules/moment/locale/en-gb.js","./en-ie":"./node_modules/moment/locale/en-ie.js","./en-ie.js":"./node_modules/moment/locale/en-ie.js","./en-il":"./node_modules/moment/locale/en-il.js","./en-il.js":"./node_modules/moment/locale/en-il.js","./en-in":"./node_modules/moment/locale/en-in.js","./en-in.js":"./node_modules/moment/locale/en-in.js","./en-nz":"./node_modules/moment/locale/en-nz.js","./en-nz.js":"./node_modules/moment/locale/en-nz.js","./en-sg":"./node_modules/moment/locale/en-sg.js","./en-sg.js":"./node_modules/moment/locale/en-sg.js","./eo":"./node_modules/moment/locale/eo.js","./eo.js":"./node_modules/moment/locale/eo.js","./es":"./node_modules/moment/locale/es.js","./es-do":"./node_modules/moment/locale/es-do.js","./es-do.js":"./node_modules/moment/locale/es-do.js","./es-mx":"./node_modules/moment/locale/es-mx.js","./es-mx.js":"./node_modules/moment/locale/es-mx.js","./es-us":"./node_modules/moment/locale/es-us.js","./es-us.js":"./node_modules/moment/locale/es-us.js","./es.js":"./node_modules/moment/locale/es.js","./et":"./node_modules/moment/locale/et.js","./et.js":"./node_modules/moment/locale/et.js","./eu":"./node_modules/moment/locale/eu.js","./eu.js":"./node_modules/moment/locale/eu.js","./fa":"./node_modules/moment/locale/fa.js","./fa.js":"./node_modules/moment/locale/fa.js","./fi":"./node_modules/moment/locale/fi.js","./fi.js":"./node_modules/moment/locale/fi.js","./fil":"./node_modules/moment/locale/fil.js","./fil.js":"./node_modules/moment/locale/fil.js","./fo":"./node_modules/moment/locale/fo.js","./fo.js":"./node_modules/moment/locale/fo.js","./fr":"./node_modules/moment/locale/fr.js","./fr-ca":"./node_modules/moment/locale/fr-ca.js","./fr-ca.js":"./node_modules/moment/locale/fr-ca.js","./fr-ch":"./node_modules/moment/locale/fr-ch.js","./fr-ch.js":"./node_modules/moment/locale/fr-ch.js","./fr.js":"./node_modules/moment/locale/fr.js","./fy":"./node_modules/moment/locale/fy.js","./fy.js":"./node_modules/moment/locale/fy.js","./ga":"./node_modules/moment/locale/ga.js","./ga.js":"./node_modules/moment/locale/ga.js","./gd":"./node_modules/moment/locale/gd.js","./gd.js":"./node_modules/moment/locale/gd.js","./gl":"./node_modules/moment/locale/gl.js","./gl.js":"./node_modules/moment/locale/gl.js","./gom-deva":"./node_modules/moment/locale/gom-deva.js","./gom-deva.js":"./node_modules/moment/locale/gom-deva.js","./gom-latn":"./node_modules/moment/locale/gom-latn.js","./gom-latn.js":"./node_modules/moment/locale/gom-latn.js","./gu":"./node_modules/moment/locale/gu.js","./gu.js":"./node_modules/moment/locale/gu.js","./he":"./node_modules/moment/locale/he.js","./he.js":"./node_modules/moment/locale/he.js","./hi":"./node_modules/moment/locale/hi.js","./hi.js":"./node_modules/moment/locale/hi.js","./hr":"./node_modules/moment/locale/hr.js","./hr.js":"./node_modules/moment/locale/hr.js","./hu":"./node_modules/moment/locale/hu.js","./hu.js":"./node_modules/moment/locale/hu.js","./hy-am":"./node_modules/moment/locale/hy-am.js","./hy-am.js":"./node_modules/moment/locale/hy-am.js","./id":"./node_modules/moment/locale/id.js","./id.js":"./node_modules/moment/locale/id.js","./is":"./node_modules/moment/locale/is.js","./is.js":"./node_modules/moment/locale/is.js","./it":"./node_modules/moment/locale/it.js","./it-ch":"./node_modules/moment/locale/it-ch.js","./it-ch.js":"./node_modules/moment/locale/it-ch.js","./it.js":"./node_modules/moment/locale/it.js","./ja":"./node_modules/moment/locale/ja.js","./ja.js":"./node_modules/moment/locale/ja.js","./jv":"./node_modules/moment/locale/jv.js","./jv.js":"./node_modules/moment/locale/jv.js","./ka":"./node_modules/moment/locale/ka.js","./ka.js":"./node_modules/moment/locale/ka.js","./kk":"./node_modules/moment/locale/kk.js","./kk.js":"./node_modules/moment/locale/kk.js","./km":"./node_modules/moment/locale/km.js","./km.js":"./node_modules/moment/locale/km.js","./kn":"./node_modules/moment/locale/kn.js","./kn.js":"./node_modules/moment/locale/kn.js","./ko":"./node_modules/moment/locale/ko.js","./ko.js":"./node_modules/moment/locale/ko.js","./ku":"./node_modules/moment/locale/ku.js","./ku.js":"./node_modules/moment/locale/ku.js","./ky":"./node_modules/moment/locale/ky.js","./ky.js":"./node_modules/moment/locale/ky.js","./lb":"./node_modules/moment/locale/lb.js","./lb.js":"./node_modules/moment/locale/lb.js","./lo":"./node_modules/moment/locale/lo.js","./lo.js":"./node_modules/moment/locale/lo.js","./lt":"./node_modules/moment/locale/lt.js","./lt.js":"./node_modules/moment/locale/lt.js","./lv":"./node_modules/moment/locale/lv.js","./lv.js":"./node_modules/moment/locale/lv.js","./me":"./node_modules/moment/locale/me.js","./me.js":"./node_modules/moment/locale/me.js","./mi":"./node_modules/moment/locale/mi.js","./mi.js":"./node_modules/moment/locale/mi.js","./mk":"./node_modules/moment/locale/mk.js","./mk.js":"./node_modules/moment/locale/mk.js","./ml":"./node_modules/moment/locale/ml.js","./ml.js":"./node_modules/moment/locale/ml.js","./mn":"./node_modules/moment/locale/mn.js","./mn.js":"./node_modules/moment/locale/mn.js","./mr":"./node_modules/moment/locale/mr.js","./mr.js":"./node_modules/moment/locale/mr.js","./ms":"./node_modules/moment/locale/ms.js","./ms-my":"./node_modules/moment/locale/ms-my.js","./ms-my.js":"./node_modules/moment/locale/ms-my.js","./ms.js":"./node_modules/moment/locale/ms.js","./mt":"./node_modules/moment/locale/mt.js","./mt.js":"./node_modules/moment/locale/mt.js","./my":"./node_modules/moment/locale/my.js","./my.js":"./node_modules/moment/locale/my.js","./nb":"./node_modules/moment/locale/nb.js","./nb.js":"./node_modules/moment/locale/nb.js","./ne":"./node_modules/moment/locale/ne.js","./ne.js":"./node_modules/moment/locale/ne.js","./nl":"./node_modules/moment/locale/nl.js","./nl-be":"./node_modules/moment/locale/nl-be.js","./nl-be.js":"./node_modules/moment/locale/nl-be.js","./nl.js":"./node_modules/moment/locale/nl.js","./nn":"./node_modules/moment/locale/nn.js","./nn.js":"./node_modules/moment/locale/nn.js","./oc-lnc":"./node_modules/moment/locale/oc-lnc.js","./oc-lnc.js":"./node_modules/moment/locale/oc-lnc.js","./pa-in":"./node_modules/moment/locale/pa-in.js","./pa-in.js":"./node_modules/moment/locale/pa-in.js","./pl":"./node_modules/moment/locale/pl.js","./pl.js":"./node_modules/moment/locale/pl.js","./pt":"./node_modules/moment/locale/pt.js","./pt-br":"./node_modules/moment/locale/pt-br.js","./pt-br.js":"./node_modules/moment/locale/pt-br.js","./pt.js":"./node_modules/moment/locale/pt.js","./ro":"./node_modules/moment/locale/ro.js","./ro.js":"./node_modules/moment/locale/ro.js","./ru":"./node_modules/moment/locale/ru.js","./ru.js":"./node_modules/moment/locale/ru.js","./sd":"./node_modules/moment/locale/sd.js","./sd.js":"./node_modules/moment/locale/sd.js","./se":"./node_modules/moment/locale/se.js","./se.js":"./node_modules/moment/locale/se.js","./si":"./node_modules/moment/locale/si.js","./si.js":"./node_modules/moment/locale/si.js","./sk":"./node_modules/moment/locale/sk.js","./sk.js":"./node_modules/moment/locale/sk.js","./sl":"./node_modules/moment/locale/sl.js","./sl.js":"./node_modules/moment/locale/sl.js","./sq":"./node_modules/moment/locale/sq.js","./sq.js":"./node_modules/moment/locale/sq.js","./sr":"./node_modules/moment/locale/sr.js","./sr-cyrl":"./node_modules/moment/locale/sr-cyrl.js","./sr-cyrl.js":"./node_modules/moment/locale/sr-cyrl.js","./sr.js":"./node_modules/moment/locale/sr.js","./ss":"./node_modules/moment/locale/ss.js","./ss.js":"./node_modules/moment/locale/ss.js","./sv":"./node_modules/moment/locale/sv.js","./sv.js":"./node_modules/moment/locale/sv.js","./sw":"./node_modules/moment/locale/sw.js","./sw.js":"./node_modules/moment/locale/sw.js","./ta":"./node_modules/moment/locale/ta.js","./ta.js":"./node_modules/moment/locale/ta.js","./te":"./node_modules/moment/locale/te.js","./te.js":"./node_modules/moment/locale/te.js","./tet":"./node_modules/moment/locale/tet.js","./tet.js":"./node_modules/moment/locale/tet.js","./tg":"./node_modules/moment/locale/tg.js","./tg.js":"./node_modules/moment/locale/tg.js","./th":"./node_modules/moment/locale/th.js","./th.js":"./node_modules/moment/locale/th.js","./tk":"./node_modules/moment/locale/tk.js","./tk.js":"./node_modules/moment/locale/tk.js","./tl-ph":"./node_modules/moment/locale/tl-ph.js","./tl-ph.js":"./node_modules/moment/locale/tl-ph.js","./tlh":"./node_modules/moment/locale/tlh.js","./tlh.js":"./node_modules/moment/locale/tlh.js","./tr":"./node_modules/moment/locale/tr.js","./tr.js":"./node_modules/moment/locale/tr.js","./tzl":"./node_modules/moment/locale/tzl.js","./tzl.js":"./node_modules/moment/locale/tzl.js","./tzm":"./node_modules/moment/locale/tzm.js","./tzm-latn":"./node_modules/moment/locale/tzm-latn.js","./tzm-latn.js":"./node_modules/moment/locale/tzm-latn.js","./tzm.js":"./node_modules/moment/locale/tzm.js","./ug-cn":"./node_modules/moment/locale/ug-cn.js","./ug-cn.js":"./node_modules/moment/locale/ug-cn.js","./uk":"./node_modules/moment/locale/uk.js","./uk.js":"./node_modules/moment/locale/uk.js","./ur":"./node_modules/moment/locale/ur.js","./ur.js":"./node_modules/moment/locale/ur.js","./uz":"./node_modules/moment/locale/uz.js","./uz-latn":"./node_modules/moment/locale/uz-latn.js","./uz-latn.js":"./node_modules/moment/locale/uz-latn.js","./uz.js":"./node_modules/moment/locale/uz.js","./vi":"./node_modules/moment/locale/vi.js","./vi.js":"./node_modules/moment/locale/vi.js","./x-pseudo":"./node_modules/moment/locale/x-pseudo.js","./x-pseudo.js":"./node_modules/moment/locale/x-pseudo.js","./yo":"./node_modules/moment/locale/yo.js","./yo.js":"./node_modules/moment/locale/yo.js","./zh-cn":"./node_modules/moment/locale/zh-cn.js","./zh-cn.js":"./node_modules/moment/locale/zh-cn.js","./zh-hk":"./node_modules/moment/locale/zh-hk.js","./zh-hk.js":"./node_modules/moment/locale/zh-hk.js","./zh-mo":"./node_modules/moment/locale/zh-mo.js","./zh-mo.js":"./node_modules/moment/locale/zh-mo.js","./zh-tw":"./node_modules/moment/locale/zh-tw.js","./zh-tw.js":"./node_modules/moment/locale/zh-tw.js"};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id="./node_modules/moment/locale sync recursive ^\\.\\/.*$"},"./node_modules/object-hash/dist sync recursive":module=>{function webpackEmptyContext(req){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}webpackEmptyContext.keys=()=>[],webpackEmptyContext.resolve=webpackEmptyContext,webpackEmptyContext.id="./node_modules/object-hash/dist sync recursive",module.exports=webpackEmptyContext}}]);